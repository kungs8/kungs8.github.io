<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Author: yanpengGong &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Email:yanpenggong@163.com    目录  [TOC] 前言Docker 是个伟大的项目，它彻底释放了虚拟化的威力，极大降低了云计算资源供应的成本，同时让应用的分发、测试、部署和分发都变得前所未有的高效和轻松！ 本书既适用于具备基础 L">
<meta property="og:type" content="article">
<meta property="og:title" content="docker从入门到实践">
<meta property="og:url" content="http://example.com/2023/01/19/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="yanpenggong 大数据实验室">
<meta property="og:description" content="Author: yanpengGong &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Email:yanpenggong@163.com    目录  [TOC] 前言Docker 是个伟大的项目，它彻底释放了虚拟化的威力，极大降低了云计算资源供应的成本，同时让应用的分发、测试、部署和分发都变得前所未有的高效和轻松！ 本书既适用于具备基础 L">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_2.3.1%20%E6%9F%A5%E7%9C%8B%20WEB%20%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_7.4.8_deploy_mode.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_8.1%20%E7%AE%80%E4%BB%8B.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_8.1%20%E7%AE%80%E4%BB%8B01.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_9.2%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.1%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84%20Ubuntu%20%E7%89%88%E6%9C%AC.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.2CentOS.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.3NGINX.png">
<meta property="og:image" content="http://example.com/DockerLearning/md_imgs/10.3NGINXweb.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.4node.png">
<meta property="article:published_time" content="2023-01-19T03:35:18.000Z">
<meta property="article:modified_time" content="2023-01-19T03:39:15.960Z">
<meta property="article:author" content="yanpenggong">
<meta property="article:tag" content="服务端">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_2.3.1%20%E6%9F%A5%E7%9C%8B%20WEB%20%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8.png">

<link rel="canonical" href="http://example.com/2023/01/19/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>docker从入门到实践 | yanpenggong 大数据实验室</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="yanpenggong 大数据实验室" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yanpenggong 大数据实验室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个专注于科研前线的大数据团队，致力于打造更好更牛的大数据平台</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/kungs8/kungs8.github.io" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/01/19/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat.jpg">
      <meta itemprop="name" content="yanpenggong">
      <meta itemprop="description" content="涉猎的主要编程语言为 Python、C++、Matlab、R，领域涵盖爬虫、数据挖掘、深度学习、良率分析、目标检测、工业异常检测、服务研发和对象存储等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yanpenggong 大数据实验室">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker从入门到实践
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-01-19 11:35:18 / 修改时间：11:39:15" itemprop="dateCreated datePublished" datetime="2023-01-19T11:35:18+08:00">2023-01-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">服务端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div align="center">
  <font size='3'><B>Author:</B> yanpengGong &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>Email:</B>yanpenggong@163.com</font>
</div>


<p>目录</p>
<hr>
<p>[TOC]</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a target="_blank" rel="noopener" href="http://www.docker.com/">Docker</a> 是个伟大的项目，它彻底释放了虚拟化的威力，极大降低了云计算资源供应的成本，同时让应用的分发、测试、部署和分发都变得前所未有的高效和轻松！</p>
<p>本书既适用于具备基础 Linux 知识的 Docker 初学者，也希望可供理解原理和实现的高级用户参考。同时，书中给出的实践案例，可供在进行实际部署时借鉴。前六章为基础内容，供用户理解 Docker 的基本概念和操作；7 ~ 9 章介绍一些高级操作；第 10 章给出典型的应用场景和实践案例；11 ~ 13 章介绍关于 Docker 实现的相关技术。14 ~ 17章介绍相关的一些开源项目。</p>
<h1 id="一、-Docker-简介"><a href="#一、-Docker-简介" class="headerlink" title="一、 Docker 简介"></a>一、 Docker 简介</h1><h2 id="1-Docker是什么"><a href="#1-Docker是什么" class="headerlink" title="1. Docker是什么"></a>1. Docker是什么</h2><p>Docker 是一个开源项目，诞生于 2013 年初，最初是 dotCloud 公司内部的一个业余项目。它基于 Google 公司推出的 Go 语言实现。 项目后来加入了 Linux 基金会，遵从了 Apache 2.0 协议，项目代码在 <a target="_blank" rel="noopener" href="https://github.com/docker/docker">GitHub</a> 上进行维护。</p>
<p>Docker 自开源后受到广泛的关注和讨论，以至于 dotCloud 公司后来都改名为 Docker Inc。Redhat 已经在其 RHEL6.5 中集中支持 Docker；Google 也在其 PaaS 产品中广泛应用。</p>
<p>Docker 项目的目标是实现轻量级的操作系统虚拟化解决方案。 Docker 的基础是 Linux 容器（LXC）等技术。</p>
<p>在 LXC 的基础上 Docker 进行了进一步的封装，让用户不需要去关心容器的管理，使得操作更为简便。用户操作 Docker 的容器就像操作一个快速轻量级的虚拟机一样简单。</p>
<p>容器是在操作系统层面上实现虚拟化，直接复用本地主机的操作系统，而传统方式则是在硬件层面实现。</p>
<h2 id="2-使用Docker的理由"><a href="#2-使用Docker的理由" class="headerlink" title="2. 使用Docker的理由"></a>2. 使用Docker的理由</h2><p>作为一种虚拟化方式，Docker 跟传统的虚拟化方式相比具有众多的优势。</p>
<p>首先，Docker 容器的启动可以在秒级实现，这相比传统的虚拟机方式要快得多。 其次，Docker 对系统资源的利用率很高，一台主机上可以同时运行数千个 Docker 容器。</p>
<p>容器除了运行其中应用外，基本不消耗额外的系统资源，使得应用的性能很高，同时系统的开销尽量小。传统虚拟机方式运行 10 个不同的应用就要起 10 个虚拟机，而Docker 只需要启动 10 个隔离的应用即可。</p>
<p>具体说来，Docker 在如下几个方面具有较大的优势。</p>
<ol>
<li><p><strong>更快速的交付和部署</strong></p>
<p>对开发和运维（devop）人员来说，最希望的就是一次创建或配置，可以在任意地方正常运行。</p>
<p>开发者可以使用一个标准的镜像来构建一套开发容器，开发完成之后，运维人员可以直接使用这个容器来部署代码。 Docker 可以快速创建容器，快速迭代应用程序，并让整个过程全程可见，使团队中的其他成员更容易理解应用程序是如何创建和工作的。 Docker 容器很轻很快！容器的启动时间是秒级的，大量地节约开发、测试、部署的时间。</p>
</li>
<li><p><strong>更高效的虚拟化</strong></p>
<p>Docker 容器的运行不需要额外的 hypervisor 支持，它是内核级的虚拟化，因此可以实现更高的性能和效率。</p>
</li>
<li><p><strong>更轻松的迁移和扩展</strong></p>
<p>Docker 容器几乎可以在任意的平台上运行，包括物理机、虚拟机、公有云、私有云、个人电脑、服务器等。 这种兼容性可以让用户把一个应用程序从一个平台直接迁移到另外一个。</p>
</li>
<li><p><strong>更简单的管理</strong></p>
<p>使用 Docker，只需要小小的修改，就可以替代以往大量的更新工作。所有的修改都以增量的方式被分发和更新，从而实现自动化并且高效的管理。</p>
</li>
<li><h3 id="对比传统虚拟机总结"><a href="#对比传统虚拟机总结" class="headerlink" title="对比传统虚拟机总结"></a>对比传统虚拟机总结</h3><p>| 特性       | 容器               | 虚拟机     |<br>| :————- | :————————- | :————- |<br>| 启动       | 秒级               | 分钟级     |<br>| 硬盘使用   | 一般为 MB          | 一般为 GB  |<br>| 性能       | 接近原生           | 弱于       |<br>| 系统支持量 | 单机支持上千个容器 | 一般几十个 |</p>
</li>
</ol>
<h1 id="二、Docker-基本概念"><a href="#二、Docker-基本概念" class="headerlink" title="二、Docker 基本概念"></a>二、Docker 基本概念</h1><h2 id="1-Docker-镜像"><a href="#1-Docker-镜像" class="headerlink" title="1. Docker 镜像"></a>1. Docker 镜像</h2><p>Docker 镜像就是一个只读的模板。</p>
<p>例如：一个镜像可以包含一个完整的 ubuntu 操作系统环境，里面仅安装了 Apache 或用户需要的其它应用程序。</p>
<p>镜像可以用来创建 Docker 容器。</p>
<p>Docker 提供了一个很简单的机制来创建镜像或者更新现有的镜像，用户甚至可以直接从其他人那里下载一个已经做好的镜像来直接使用。</p>
<h2 id="2-Docker容器的运用"><a href="#2-Docker容器的运用" class="headerlink" title="2. Docker容器的运用"></a>2. Docker容器的运用</h2><p>2018-08-04 17:51 更新</p>
<p>Docker 利用容器来运行应用。</p>
<p>容器是从镜像创建的运行实例。它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。</p>
<p>可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
<blockquote>
<p>注：镜像是只读的，容器在启动的时候创建一层可写层作为最上层。</p>
</blockquote>
<h2 id="3-Docker仓库"><a href="#3-Docker仓库" class="headerlink" title="3. Docker仓库"></a>3. Docker仓库</h2><p>仓库是集中存放镜像文件的场所。有时候会把仓库和仓库注册服务器（Registry）混为一谈，并不严格区分。实际上，仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。</p>
<p>仓库分为公开仓库（Public）和私有仓库（Private）两种形式。</p>
<p>最大的公开仓库是 <a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a>，存放了数量庞大的镜像供用户下载。 国内的公开仓库包括 <a target="_blank" rel="noopener" href="https://promotion.aliyun.com/ntms/act/kubernetes.html">Docker Pool</a> 等，可以提供大陆用户更稳定快速的访问。</p>
<p>当然，用户也可以在本地网络内创建一个私有仓库。</p>
<p>当用户创建了自己的镜像之后就可以使用 <code>push</code> 命令将它上传到公有或者私有仓库，这样下次在另外一台机器上使用这个镜像时候，只需要从仓库上 <code>pull</code> 下来就可以了。</p>
<blockquote>
<p>注：Docker 仓库的概念跟 <a target="_blank" rel="noopener" href="http://git-scm.com/">Git</a> 类似，注册服务器可以理解为 GitHub 这样的托管服务。</p>
</blockquote>
<h1 id="三、Docker安装指南"><a href="#三、Docker安装指南" class="headerlink" title="三、Docker安装指南"></a>三、Docker安装指南</h1><p>官方网站上有各种环境下的 <a target="_blank" rel="noopener" href="https://docs.docker.com/get-docker/">安装指南</a>，这里主要介绍下CentOS系列的安装。</p>
<h2 id="1-使用官方安装脚本自动安装"><a href="#1-使用官方安装脚本自动安装" class="headerlink" title="1. 使用官方安装脚本自动安装"></a>1. 使用官方安装脚本自动安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Executing docker install script, commit: b2e29ef7a9a89840d2333637f7d1900a83e7153f</span></span><br><span class="line">+ sh -c &#x27;yum install -y -q yum-utils&#x27;</span><br><span class="line">Package yum-utils-1.1.31-54.el7_8.noarch already installed and latest version</span><br><span class="line">+ sh -c &#x27;yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo&#x27;</span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">adding repo from: https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">grabbing file https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">+ &#x27;[&#x27; stable &#x27;!=&#x27; stable &#x27;]&#x27;</span><br><span class="line">+ sh -c &#x27;yum makecache&#x27;</span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: ftp.sjtu.edu.cn</span><br><span class="line"> * extras: mirrors.bfsu.edu.cn</span><br><span class="line"> * updates: ftp.sjtu.edu.cn</span><br><span class="line">base                                                                                                                                                                           | 3.6 kB  00:00:00     </span><br><span class="line">docker-ce-stable                                                                                                                                                               | 3.5 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                                                         | 2.9 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                                                        | 2.9 kB  00:00:00     </span><br><span class="line">Metadata Cache Created</span><br><span class="line">+ sh -c &#x27;yum install -y -q docker-ce docker-ce-cli containerd.io docker-scan-plugin docker-compose-plugin docker-ce-rootless-extras&#x27;</span><br><span class="line">warning: /var/cache/yum/x86_64/7/docker-ce-stable/packages/docker-ce-20.10.17-3.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEY</span><br><span class="line">Public key for docker-ce-20.10.17-3.el7.x86_64.rpm is not installed</span><br><span class="line"></span><br><span class="line">Importing GPG key 0x621E9F35:</span><br><span class="line"> Userid     : &quot;Docker Release (CE rpm) &lt;docker@docker.com&gt;&quot;</span><br><span class="line"> Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35</span><br><span class="line"> From       : https://mirrors.aliyun.com/docker-ce/linux/centos/gpg</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">To run Docker as a non-privileged user, consider setting up the</span><br><span class="line">Docker daemon in rootless mode for your user:</span><br><span class="line"></span><br><span class="line">    dockerd-rootless-setuptool.sh install</span><br><span class="line"></span><br><span class="line">Visit https://docs.docker.com/go/rootless/ to learn about rootless mode.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To run the Docker daemon as a fully privileged service, but granting non-root</span><br><span class="line">users access, refer to https://docs.docker.com/go/daemon-access/</span><br><span class="line"></span><br><span class="line">WARNING: Access to the remote API on a privileged Docker daemon is equivalent</span><br><span class="line">         to root access on the host. Refer to the &#x27;Docker daemon attack surface&#x27;</span><br><span class="line">         documentation for details: https://docs.docker.com/go/attack-surface/</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
<p>也可以使用国内 daocloud 一键安装命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>
<h2 id="2-手动安装"><a href="#2-手动安装" class="headerlink" title="2. 手动安装"></a>2. 手动安装</h2><h3 id="2-1-卸载旧版本"><a href="#2-1-卸载旧版本" class="headerlink" title="2.1 卸载旧版本"></a>2.1 卸载旧版本</h3><p>较旧的 Docker 版本称为 docker 或 docker-engine 。如果已安装这些程序，请卸载它们以及相关的依赖项。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum remove docker \</span></span><br><span class="line">&gt;                   docker<span class="literal">-client</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-client-latest</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-common</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-latest</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-latest-logrotate</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-logrotate</span> \</span><br><span class="line">&gt;                   docker<span class="literal">-engine</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, <span class="built_in">search-disabled</span><span class="literal">-repos</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker</span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-client</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-client-latest</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-common</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-latest</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-latest-logrotate</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-logrotate</span></span><br><span class="line">No Match <span class="keyword">for</span> argument: docker<span class="literal">-engine</span></span><br><span class="line">No Packages marked <span class="keyword">for</span> removal</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-安装-Docker-Engine-Community"><a href="#2-2-安装-Docker-Engine-Community" class="headerlink" title="2.2 安装 Docker Engine-Community"></a>2.2 安装 Docker Engine-Community</h3><p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库。之后，您可以从仓库安装和更新 Docker。</p>
<h4 id="2-2-1-设置仓库"><a href="#2-2-1-设置仓库" class="headerlink" title="2.2.1 设置仓库"></a>2.2.1 <strong>设置仓库</strong></h4><p>安装所需的软件包。<code>yum-utils</code> 提供了 <code>yum-config-manager</code> ，并且 <code>device mapper</code> 存储驱动程序需要 <code>device-mapper-persistent-data</code> 和 <code>lvm2</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, <span class="built_in">search-disabled</span><span class="literal">-repos</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: ftp.sjtu.edu.cn</span><br><span class="line"> * extras: mirrors.bfsu.edu.cn</span><br><span class="line"> * updates: ftp.sjtu.edu.cn</span><br><span class="line">Package yum<span class="literal">-utils-1</span>.<span class="number">1.31</span><span class="literal">-54</span>.el7_8.noarch already installed and latest version</span><br><span class="line">Package device<span class="literal">-mapper-persistent-data-0</span>.<span class="number">8.5</span><span class="literal">-3</span>.el7_9.<span class="number">2</span>.x86_64 already installed and latest version</span><br><span class="line">Package <span class="number">7</span>:lvm2<span class="literal">-2</span>.<span class="number">02.187</span><span class="literal">-6</span>.el7_9.<span class="number">5</span>.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>设置稳定的仓库:</strong></p>
<ul>
<li><p>使用官方源地址（比较慢）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">adding repo from: https://download.docker.com/linux/centos/docker<span class="literal">-ce</span>.repo</span><br><span class="line">grabbing file https://download.docker.com/linux/centos/docker<span class="literal">-ce</span>.repo to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>选择国内的 <code>阿里云</code> 源地址：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">adding repo from: http://mirrors.aliyun.com/docker<span class="literal">-ce</span>/linux/centos/docker<span class="literal">-ce</span>.repo</span><br><span class="line">grabbing file http://mirrors.aliyun.com/docker<span class="literal">-ce</span>/linux/centos/docker<span class="literal">-ce</span>.repo to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>选择国内的 <code>清华大学</code> 源地址：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">adding repo from: https://mirrors.tuna.tsinghua.edu.cn/docker<span class="literal">-ce</span>/linux/centos/docker<span class="literal">-ce</span>.repo</span><br><span class="line">grabbing file https://mirrors.tuna.tsinghua.edu.cn/docker<span class="literal">-ce</span>/linux/centos/docker<span class="literal">-ce</span>.repo to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker<span class="literal">-ce</span>.repo</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-2-安装-Docker-Engine-Community"><a href="#2-2-2-安装-Docker-Engine-Community" class="headerlink" title="2.2.2 安装 Docker Engine-Community"></a>2.2.2 <strong>安装 Docker Engine-Community</strong></h4><ul>
<li><p>安装最新版本的 <code>Docker Engine-Community</code> 和 <code>containerd</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum install docker-ce docker-ce-cli containerd.io</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, <span class="built_in">search-disabled</span><span class="literal">-repos</span>, subscription<span class="literal">-manager</span></span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line"></span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: ftp.sjtu.edu.cn</span><br><span class="line"> * extras: mirrors.bfsu.edu.cn</span><br><span class="line"> * updates: ftp.sjtu.edu.cn</span><br><span class="line">docker<span class="literal">-ce-stable</span>                                                                                 | <span class="number">3.5</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">Package <span class="number">1</span>:docker<span class="literal">-ce-cli-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64 already installed and latest version</span><br><span class="line">Package containerd.io<span class="literal">-1</span>.<span class="number">6.7</span><span class="literal">-3</span>.<span class="number">1</span>.el7.x86_64 already installed and latest version</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="literal">--</span>&gt; Running transaction check</span><br><span class="line"><span class="literal">---</span>&gt; Package docker<span class="literal">-ce</span>.x86_64 <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7 will be installed</span><br><span class="line"><span class="literal">--</span>&gt; Processing Dependency: docker<span class="literal">-ce-rootless-extras</span> <span class="keyword">for</span> package: <span class="number">3</span>:docker<span class="literal">-ce-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64</span><br><span class="line"><span class="literal">--</span>&gt; Running transaction check</span><br><span class="line"><span class="literal">---</span>&gt; Package docker<span class="literal">-ce-rootless-extras</span>.x86_64 <span class="number">0</span>:<span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7 will be installed</span><br><span class="line"><span class="literal">--</span>&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">========================================================================================================================</span><br><span class="line"> Package                              Arch              Version                       Repository                   Size</span><br><span class="line">========================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> docker<span class="literal">-ce</span>                            x86_64            <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7              docker<span class="literal">-ce-stable</span>             <span class="number">22</span> M</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> docker<span class="literal">-ce-rootless-extras</span>            x86_64            <span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7                docker<span class="literal">-ce-stable</span>            <span class="number">8.2</span> M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">========================================================================================================================</span><br><span class="line">Install  <span class="number">1</span> Package (+<span class="number">1</span> Dependent package)</span><br><span class="line"></span><br><span class="line">Total download size: <span class="number">31</span> M</span><br><span class="line">Installed size: <span class="number">115</span> M</span><br><span class="line">Is this ok [<span class="type">y</span>/<span class="type">d</span>/<span class="type">N</span>]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">(<span class="number">1</span>/<span class="number">2</span>): docker<span class="literal">-ce-rootless-extras-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64.rpm                                       | <span class="number">8.2</span> MB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">28</span>     </span><br><span class="line">(<span class="number">2</span>/<span class="number">2</span>): docker<span class="literal">-ce-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64.rpm                                                       |  <span class="number">22</span> MB  <span class="number">00</span>:<span class="number">01</span>:<span class="number">18</span>     </span><br><span class="line"><span class="literal">------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">Total                                                                                   <span class="number">400</span> kB/s |  <span class="number">31</span> MB  <span class="number">00</span>:<span class="number">01</span>:<span class="number">18</span>     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : <span class="number">3</span>:docker<span class="literal">-ce-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64                                                                    <span class="number">1</span>/<span class="number">2</span> </span><br><span class="line">  Installing : docker<span class="literal">-ce-rootless-extras-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64                                                      <span class="number">2</span>/<span class="number">2</span> </span><br><span class="line">  Verifying  : docker<span class="literal">-ce-rootless-extras-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64                                                      <span class="number">1</span>/<span class="number">2</span> </span><br><span class="line">  Verifying  : <span class="number">3</span>:docker<span class="literal">-ce-20</span>.<span class="number">10.17</span><span class="literal">-3</span>.el7.x86_64                                                                    <span class="number">2</span>/<span class="number">2</span> </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  docker<span class="literal">-ce</span>.x86_64 <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7                                                                                     </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  docker<span class="literal">-ce-rootless-extras</span>.x86_64 <span class="number">0</span>:<span class="number">20.10</span>.<span class="number">17</span><span class="literal">-3</span>.el7                                                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>如果提示您接受 GPG 密钥，请选是。</p>
<blockquote>
<p><strong>有多个 Docker 仓库吗？</strong></p>
<p>如果启用了多个 Docker 仓库，则在 <code>yum install</code> 或 <code>yum update</code> 命令中指定版本的情况下，进行的安装或更新将始终安装最高版本，这可能不适合您的稳定性需求。</p>
</blockquote>
<p>Docker 安装完默认未启动。并且已经创建好 docker 用户组，但该用户组下没有用户。</p>
</li>
<li><p>安装特定版本：</p>
<p><strong>安装特定版本的 Docker Engine-Community，请在存储库中列出可用版本，然后选择并安装。</strong></p>
<ul>
<li><p>列出并排序您存储库中可用的版本。此示例按版本号（从高到低）对结果进行排序。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum list docker-ce --showduplicates | sort -r</span></span><br><span class="line"> * updates: ftp.sjtu.edu.cn</span><br><span class="line">This system is not registered with an entitlement server. You can use subscription<span class="literal">-manager</span> to register.</span><br><span class="line">              : subscription<span class="literal">-manager</span></span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product<span class="literal">-id</span>, <span class="built_in">search-disabled</span><span class="literal">-repos</span>,</span><br><span class="line">Installed Packages</span><br><span class="line"> * extras: mirrors.bfsu.edu.cn</span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">9</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">8</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">20.10</span>.<span class="number">7</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">...</span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">18.09</span>.<span class="number">2</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">18.09</span>.<span class="number">1</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">3</span>:<span class="number">18.09</span>.<span class="number">0</span><span class="literal">-3</span>.el7                    docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">18.06</span>.<span class="number">3</span>.ce<span class="literal">-3</span>.el7                   docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">18.06</span>.<span class="number">2</span>.ce<span class="literal">-3</span>.el7                   docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">18.06</span>.<span class="number">1</span>.ce<span class="literal">-3</span>.el7                   docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">18.06</span>.<span class="number">0</span>.ce<span class="literal">-3</span>.el7                   docker<span class="literal">-ce-stable</span> </span><br><span class="line">docker<span class="literal">-ce</span>.x86_64            <span class="number">18.03</span>.<span class="number">1</span>.ce<span class="literal">-1</span>.el7.centos            docker<span class="literal">-ce-stable</span> </span><br><span class="line">...</span><br><span class="line"> * base: ftp.sjtu.edu.cn</span><br><span class="line">Available Packages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>通过其完整的软件包名称安装特定版本，该软件包名称是软件包名称（<code>docker-ce</code>）加上版本字符串（第二列），从第一个冒号（:）一直到第一个连字符，并用连字符（-）分隔。例如：<code>docker-ce-18.09.1</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-Docker启动"><a href="#3-Docker启动" class="headerlink" title="3. Docker启动"></a>3. Docker启动</h2><p>启动 Docker：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# sudo systemctl start docker</span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
<p>通过运行 hello-world 镜像来验证是否正确安装了 Docker Engine-Community 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">2db29710123e: Pull complete </span><br><span class="line">Digest: sha256:7d246653d0511db2a6b2e0436cfd0e52ac8c066000264b3ce63331ac66dca625</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br><span class="line"></span><br><span class="line">[root@localhost software]# chkconfig docker on</span><br><span class="line">Note: Forwarding request to &#x27;systemctl enable docker.service&#x27;.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
<h2 id="4-Docker卸载"><a href="#4-Docker卸载" class="headerlink" title="4. Docker卸载"></a>4. Docker卸载</h2><ol>
<li><p><strong>首先搜索已经安装的docker 安装包 </strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# yum list installed|grep docker</span><br><span class="line">containerd.io.x86_64                    1.6.7-3.1.el7                  @docker-ce-stable</span><br><span class="line">docker-ce.x86_64                        3:20.10.17-3.el7               @docker-ce-stable</span><br><span class="line">docker-ce-cli.x86_64                    1:20.10.17-3.el7               @docker-ce-stable</span><br><span class="line">docker-ce-rootless-extras.x86_64        20.10.17-3.el7                 @docker-ce-stable</span><br><span class="line">docker-compose-plugin.x86_64            2.6.0-3.el7                    @docker-ce-stable</span><br><span class="line">docker-scan-plugin.x86_64               0.17.0-3.el7                   @docker-ce-stable</span><br><span class="line">[root@localhost software]#</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>分别删除安装包</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# yum -y remove docker-ce.x86_64 </span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package docker-ce.x86_64 3:20.10.17-3.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: docker-ce <span class="keyword">for</span> package: docker-ce-rootless-extras-20.10.17-3.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package docker-ce-rootless-extras.x86_64 0:20.10.17-3.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">========================================================================================================================</span><br><span class="line"> Package                              Arch              Version                      Repository                    Size</span><br><span class="line">========================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> docker-ce                            x86_64            3:20.10.17-3.el7             @docker-ce-stable             96 M</span><br><span class="line">Removing for dependencies:</span><br><span class="line"> docker-ce-rootless-extras            x86_64            20.10.17-3.el7               @docker-ce-stable             19 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">========================================================================================================================</span><br><span class="line">Remove  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Installed size: 115 M</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Erasing    : 3:docker-ce-20.10.17-3.el7.x86_64                                                                    1/2 </span><br><span class="line">  Erasing    : docker-ce-rootless-extras-20.10.17-3.el7.x86_64                                                      2/2 </span><br><span class="line">  Verifying  : docker-ce-rootless-extras-20.10.17-3.el7.x86_64                                                      1/2 </span><br><span class="line">  Verifying  : 3:docker-ce-20.10.17-3.el7.x86_64                                                                    2/2 </span><br><span class="line"></span><br><span class="line">Removed:</span><br><span class="line">  docker-ce.x86_64 3:20.10.17-3.el7                                                                                     </span><br><span class="line"></span><br><span class="line">Dependency Removed:</span><br><span class="line">  docker-ce-rootless-extras.x86_64 0:20.10.17-3.el7                                                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost software]# yum -y remove docker-ce-cli.x86_64 </span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package docker-ce-cli.x86_64 1:20.10.17-3.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: docker-ce-cli <span class="keyword">for</span> package: docker-scan-plugin-0.17.0-3.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package docker-scan-plugin.x86_64 0:0.17.0-3.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">========================================================================================================================</span><br><span class="line"> Package                         Arch                Version                       Repository                      Size</span><br><span class="line">========================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> docker-ce-cli                   x86_64              1:20.10.17-3.el7              @docker-ce-stable              140 M</span><br><span class="line">Removing for dependencies:</span><br><span class="line"> docker-scan-plugin              x86_64              0.17.0-3.el7                  @docker-ce-stable               13 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">========================================================================================================================</span><br><span class="line">Remove  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Installed size: 153 M</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Erasing    : 1:docker-ce-cli-20.10.17-3.el7.x86_64                                                                1/2 </span><br><span class="line">  Erasing    : docker-scan-plugin-0.17.0-3.el7.x86_64                                                               2/2 </span><br><span class="line">  Verifying  : docker-scan-plugin-0.17.0-3.el7.x86_64                                                               1/2 </span><br><span class="line">  Verifying  : 1:docker-ce-cli-20.10.17-3.el7.x86_64                                                                2/2 </span><br><span class="line"></span><br><span class="line">Removed:</span><br><span class="line">  docker-ce-cli.x86_64 1:20.10.17-3.el7                                                                                 </span><br><span class="line"></span><br><span class="line">Dependency Removed:</span><br><span class="line">  docker-scan-plugin.x86_64 0:0.17.0-3.el7                                                                              </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@localhost software]# yum -y remove docker-compose-plugin.x86_64 </span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package docker-compose-plugin.x86_64 0:2.6.0-3.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">========================================================================================================================</span><br><span class="line"> Package                            Arch                Version                    Repository                      Size</span><br><span class="line">========================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> docker-compose-plugin              x86_64              2.6.0-3.el7                @docker-ce-stable               25 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">========================================================================================================================</span><br><span class="line">Remove  1 Package</span><br><span class="line"></span><br><span class="line">Installed size: 25 M</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Erasing    : docker-compose-plugin-2.6.0-3.el7.x86_64                                                             1/1 </span><br><span class="line">  Verifying  : docker-compose-plugin-2.6.0-3.el7.x86_64                                                             1/1 </span><br><span class="line"></span><br><span class="line">Removed:</span><br><span class="line">  docker-compose-plugin.x86_64 0:2.6.0-3.el7                                                                            </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@localhost software]# yum -y remove containerd.io.x86_64 </span><br><span class="line">Loaded plugins: fastestmirror, langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package containerd.io.x86_64 0:1.6.7-3.1.el7 will be erased</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">========================================================================================================================</span><br><span class="line"> Package                      Arch                  Version                      Repository                        Size</span><br><span class="line">========================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> containerd.io                x86_64                1.6.7-3.1.el7                @docker-ce-stable                125 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">========================================================================================================================</span><br><span class="line">Remove  1 Package</span><br><span class="line"></span><br><span class="line">Installed size: 125 M</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Erasing    : containerd.io-1.6.7-3.1.el7.x86_64                                                                   1/1 </span><br><span class="line">  Verifying  : containerd.io-1.6.7-3.1.el7.x86_64                                                                   1/1 </span><br><span class="line"></span><br><span class="line">Removed:</span><br><span class="line">  containerd.io.x86_64 0:1.6.7-3.1.el7                                                                                  </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除docker 镜像 </strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# rm -rf /var/lib/docker</span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>再次check docker是否已经卸载成功 </strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# yum list installed|grep docker </span><br><span class="line">[root@localhost software]# </span><br></pre></td></tr></table></figure>
<p>如果没有，就表示卸载成功。</p>
</li>
</ol>
<h1 id="四、Docker使用"><a href="#四、Docker使用" class="headerlink" title="四、Docker使用"></a>四、Docker使用</h1><h2 id="1-Docker-Hello-World"><a href="#1-Docker-Hello-World" class="headerlink" title="1. Docker Hello World"></a>1. Docker Hello World</h2><p>Docker 允许你在容器内运行应用程序， 使用 <strong>docker run</strong> 命令来在容器内运行一个应用程序。输出<code>Hello world</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run ubuntu:15.10 /bin/echo &quot;Hello world&quot;</span></span><br><span class="line">Hello world</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>各个参数解析：</p>
<ul>
<li><strong>docker:</strong> Docker 的二进制执行文件。</li>
<li><strong>run:</strong> 与前面的 docker 组合来运行一个容器。</li>
<li><strong>ubuntu:15.10</strong> 指定要运行的镜像，Docker 首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li>
<li><strong>/bin/echo “Hello world”:</strong> 在启动的容器里执行的命令</li>
</ul>
<p>以上命令完整的意思可以解释为：Docker 以 <code>ubuntu15.10</code> 镜像创建一个新容器，然后在容器里执行 bin/echo “Hello world”，然后输出结果。</p>
<h3 id="1-1-运行交互式的容器"><a href="#1-1-运行交互式的容器" class="headerlink" title="1.1 运行交互式的容器"></a>1.1 运行交互式的容器</h3><p>通过 docker 的两个参数 -i -t，让 docker 运行的容器实现<strong>“对话”</strong>的能力：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -i -t ubuntu:15.10 /bin/bash</span></span><br><span class="line">root@ed4a85705ff3:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>各个参数解析：</p>
<ul>
<li><strong>-t:</strong> 在新容器内指定一个伪终端或终端。</li>
<li><strong>-i:</strong> 允许你对容器内的标准输入 (STDIN) 进行交互。</li>
</ul>
<p>注意第二行 <code>root@ed4a85705ff3:/#</code>，此时我们已进入一个 ubuntu15.10 系统的容器</p>
<p>我们尝试在容器中运行命令 <code>cat /proc/version</code> 和 <code>ls</code>分别查看当前系统的版本信息和当前目录下的文件列表</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ed4a85705ff3:/<span class="comment"># cat /proc/version</span></span><br><span class="line">Linux version <span class="number">3.10</span>.<span class="number">0</span><span class="literal">-862</span>.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version <span class="number">4.8</span>.<span class="number">5</span> <span class="number">20150623</span> (Red Hat <span class="number">4.8</span>.<span class="number">5</span><span class="literal">-28</span>) (GCC) ) <span class="comment">#1 SMP Fri Apr 20 16:44:24 UTC 2018</span></span><br><span class="line">root@ed4a85705ff3:/<span class="comment"># ls</span></span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@ed4a85705ff3:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>可以通过运行 exit 命令或者使用 CTRL+D 来退出容器。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ed4a85705ff3:/<span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>注意第三行中 <code>[root@localhost software]#</code> 表明我们已经退出了当前的容器，返回到当前的主机中。</p>
<h3 id="1-2-启动容器（后台模式）"><a href="#1-2-启动容器（后台模式）" class="headerlink" title="1.2 启动容器（后台模式）"></a>1.2 启动容器（后台模式）</h3><p>创建一个以进程方式运行的容器:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -d ubuntu:15.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br><span class="line">f8f69699ea5ee423c804656040a2512541dc1503320a19c573c5bf9a29bfb0a0</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>在输出中，我们没有看到期望的 <code>hello world</code>，而是一串长字符</p>
<p><code>f8f69699ea5ee423c804656040a2512541dc1503320a19c573c5bf9a29bfb0a0</code></p>
<p>这个长字符串叫做<code>容器 ID</code>，对每个容器来说都是唯一的，我们可以通过容器 ID 来查看对应的容器发生了什么。</p>
<p>首先，我们需要确认容器有在运行，可以通过 <strong>docker ps</strong> 来查看：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">f8f69699ea5e   ubuntu:<span class="number">15.10</span>   <span class="string">&quot;/bin/sh -c &#x27;while t…&quot;</span>   <span class="number">59</span> seconds ago   Up <span class="number">58</span> seconds             reverent_rubin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>输出详情介绍：</p>
<ul>
<li><p><strong>CONTAINER ID:</strong> 容器 ID。</p>
</li>
<li><p><strong>IMAGE:</strong> 使用的镜像。</p>
</li>
<li><p><strong>COMMAND:</strong> 启动容器时运行的命令。</p>
</li>
<li><p><strong>CREATED:</strong> 容器的创建时间。</p>
</li>
<li><p><strong>STATUS:</strong> 容器状态。状态有7种：</p>
<ul>
<li><p>created（已创建）</p>
</li>
<li><p>restarting（重启中）</p>
</li>
<li><p>running 或 Up（运行中）</p>
</li>
<li><p>removing（迁移中）</p>
</li>
<li><p>paused（暂停）</p>
</li>
<li><p>exited（停止）</p>
</li>
<li><p>dead（死亡）</p>
</li>
</ul>
</li>
<li><p><strong>PORTS:</strong> 容器的端口信息和使用的连接类型（tcp\udp）。</p>
</li>
<li><p><strong>NAMES:</strong> 自动分配的容器名称。</p>
</li>
</ul>
<p>在宿主主机内使用 <strong>docker logs</strong> 命令，查看容器内的标准输出：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker logs f8f69699ea5e</span></span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="1-3-停止容器"><a href="#1-3-停止容器" class="headerlink" title="1.3 停止容器"></a>1.3 停止容器</h3><p>使用 <strong>docker stop</strong> 命令来停止容器:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker stop f8f69699ea5e</span></span><br><span class="line">f8f69699ea5e</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>通过 <strong>docker ps</strong> 查看，容器已经停止工作:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>可以看到容器已经不在了。</p>
<p>也可以用下面的命令来停止:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker stop reverent_rubin</span></span><br><span class="line">reverent_rubin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h2 id="2-Docker容器使用"><a href="#2-Docker容器使用" class="headerlink" title="2. Docker容器使用"></a>2. Docker容器使用</h2><h3 id="2-1-Docker-客户端"><a href="#2-1-Docker-客户端" class="headerlink" title="2.1 Docker 客户端"></a>2.1 Docker 客户端</h3><p>docker 客户端非常简单 ,我们可以直接输入 docker 命令来查看到 Docker 客户端的所有命令选项。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker</span></span><br><span class="line"></span><br><span class="line">Usage:  docker [<span class="type">OPTIONS</span>] COMMAND</span><br><span class="line"></span><br><span class="line">A self<span class="literal">-sufficient</span> runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      <span class="literal">--config</span> string      Location of client config files (default <span class="string">&quot;/root/.docker&quot;</span>)</span><br><span class="line">  <span class="literal">-c</span>, <span class="literal">--context</span> string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and</span><br><span class="line">                           default context <span class="built_in">set</span> with <span class="string">&quot;docker context use&quot;</span>)</span><br><span class="line">  <span class="literal">-D</span>, <span class="literal">--debug</span>              Enable debug mode</span><br><span class="line">  <span class="literal">-H</span>, <span class="literal">--host</span> list          Daemon socket(s) to connect to</span><br><span class="line">  <span class="literal">-l</span>, <span class="literal">--log-level</span> string   <span class="built_in">Set</span> the logging level (<span class="string">&quot;debug&quot;</span>|<span class="string">&quot;info&quot;</span>|<span class="string">&quot;warn&quot;</span>|<span class="string">&quot;error&quot;</span>|<span class="string">&quot;fatal&quot;</span>) (default <span class="string">&quot;info&quot;</span>)</span><br><span class="line">      <span class="literal">--tls</span>                Use TLS; implied by <span class="literal">--tlsverify</span></span><br><span class="line">      <span class="literal">--tlscacert</span> string   Trust certs signed only by this CA (default <span class="string">&quot;/root/.docker/ca.pem&quot;</span>)</span><br><span class="line">      <span class="literal">--tlscert</span> string     Path to TLS certificate file (default <span class="string">&quot;/root/.docker/cert.pem&quot;</span>)</span><br><span class="line">      <span class="literal">--tlskey</span> string      Path to TLS key file (default <span class="string">&quot;/root/.docker/key.pem&quot;</span>)</span><br><span class="line">      <span class="literal">--tlsverify</span>          Use TLS and verify the remote</span><br><span class="line">  <span class="literal">-v</span>, <span class="literal">--version</span>            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  app*        Docker App (Docker Inc., v0.<span class="number">9.1</span><span class="literal">-beta3</span>)</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  buildx*     Docker Buildx (Docker Inc., v0.<span class="number">8.2</span><span class="literal">-docker</span>)</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  image       Manage images</span><br><span class="line">  manifest    Manage Docker image manifests and manifest lists</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  scan*       Docker Scan (Docker Inc., v0.<span class="number">17.0</span>)</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">&#x27;s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container&#x27;</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command <span class="keyword">in</span> a running container</span><br><span class="line">  export      Export a container<span class="string">&#x27;s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run &#x27;</span>docker COMMAND <span class="literal">--help</span><span class="string">&#x27; for more information on a command.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To get more help with docker, check out our guides at https://docs.docker.com/go/guides/</span></span><br><span class="line"><span class="string">[root@localhost software]# </span></span><br></pre></td></tr></table></figure>
<p>可以通过命令<code>docker command --help</code> 更深入的了解指定的 Docker 命令使用方法。</p>
<p>例如我们要查看 <code>docker stats</code> 指令的具体使用方法：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker stats --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker stats [<span class="type">OPTIONS</span>] [<span class="type">CONTAINER...</span>]</span><br><span class="line"></span><br><span class="line">Display a live stream of container(s) resource usage statistics</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  <span class="literal">-a</span>, <span class="literal">--all</span>             Show all containers (default shows just running)</span><br><span class="line">      <span class="literal">--format</span> string   Pretty<span class="literal">-print</span> images <span class="keyword">using</span> a Go template</span><br><span class="line">      <span class="literal">--no-stream</span>       Disable streaming stats and only pull the first result</span><br><span class="line">      <span class="literal">--no-trunc</span>        <span class="keyword">Do</span> not truncate output</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-容器使用"><a href="#2-2-容器使用" class="headerlink" title="2.2 容器使用"></a>2.2 容器使用</h3><h4 id="2-2-1-获取镜像"><a href="#2-2-1-获取镜像" class="headerlink" title="2.2.1 获取镜像"></a>2.2.1 获取镜像</h4><p>如果本地没有 ubuntu 镜像，可以使用 <code>docker pull</code> 命令来载入 ubuntu 镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker pull ubuntu</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line">d19f32bd9e41: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">34</span>fea4f31bf187bc915536831fd0afc9d214755bf700b5cdb1336c82516d154e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:latest</span><br><span class="line">docker.io/library/ubuntu:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-启动容器"><a href="#2-2-2-启动容器" class="headerlink" title="2.2.2 启动容器"></a>2.2.2 启动容器</h4><p>以下命令使用 ubuntu 镜像启动一个容器，参数为以命令行模式进入该容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -it ubuntu /bin/bash</span></span><br><span class="line">root@<span class="number">5358</span>c9601c75:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>ubuntu</strong>: ubuntu 镜像。</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li>
</ul>
<p>要退出终端，直接输入 <code>exit</code>:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">5358</span>c9601c75:/<span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-启动已停止运行的容器"><a href="#2-2-3-启动已停止运行的容器" class="headerlink" title="2.2.3 启动已停止运行的容器"></a>2.2.3 启动已停止运行的容器</h4><p>查看所有的容器命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS                          PORTS     NAMES</span><br><span class="line"><span class="number">5358</span>c9601c75   ubuntu         <span class="string">&quot;/bin/bash&quot;</span>              About a minute ago   Exited (<span class="number">0</span>) About a minute ago   </span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>使用 docker start 启动一个已停止的容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker start 5358c9601c75</span></span><br><span class="line"><span class="number">5358</span>c9601c75</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-后台运行"><a href="#2-2-4-后台运行" class="headerlink" title="2.2.4 后台运行"></a>2.2.4 后台运行</h4><p>在大部分的场景下，希望 docker 的服务是在后台运行的，可以过 <code>-d</code> 指定容器的运行模式。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -itd --name ubuntu-test ubuntu /bin/bash</span></span><br><span class="line">c293ba3fecac5d8f833bec90aca18670ba253fa0af7f7697990c9b8933902c23</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS              PORTS     NAMES</span><br><span class="line">c293ba3fecac   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">23</span> seconds ago   Up <span class="number">22</span> seconds                 ubuntu<span class="literal">-test</span></span><br><span class="line"><span class="number">5358</span>c9601c75   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">4</span> minutes ago    Up About a minute             lucid_austin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong>加了 <code>-d</code> 参数默认不会进入容器，想要进入容器需要使用指令 <code>docker exec</code>（下面会介绍到）。</p>
<h4 id="2-2-5-停止一个容器"><a href="#2-2-5-停止一个容器" class="headerlink" title="2.2.5 停止一个容器"></a>2.2.5 停止一个容器</h4><p>停止容器的命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker stop c293ba3fecac</span></span><br><span class="line">c293ba3fecac</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>停止的容器可以通过 docker restart 重启：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker restart c293ba3fecac</span></span><br><span class="line">c293ba3fecac</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-6-进入容器"><a href="#2-2-6-进入容器" class="headerlink" title="2.2.6 进入容器"></a>2.2.6 进入容器</h4><p>在使用 <code>-d</code> 参数时，容器启动后会进入后台。此时想要进入容器，可以通过以下指令进入：</p>
<ul>
<li><p><strong>docker attach</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS        PORTS     NAMES</span><br><span class="line">c293ba3fecac   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">5</span> minutes ago   Up <span class="number">1</span> second             ubuntu<span class="literal">-test</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker attach c293ba3fecac</span></span><br><span class="line">root@c293ba3fecac:/<span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong> 如果从这个容器退出，会导致容器的停止。</p>
</blockquote>
</li>
<li><p><strong>docker exec</strong>：推荐大家使用 docker exec 命令，因为此命令会退出容器终端，但不会导致容器的停止。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">c293ba3fecac   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">6</span> minutes ago   Up <span class="number">3</span> seconds             ubuntu<span class="literal">-test</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker exec -it c293ba3fecac /bin/bash</span></span><br><span class="line">root@c293ba3fecac:/<span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS          PORTS     NAMES</span><br><span class="line">c293ba3fecac   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">6</span> minutes ago   Up <span class="number">18</span> seconds             ubuntu<span class="literal">-test</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong> 如果从这个容器退出，容器不会停止，这就是为什么推荐大家使用 <strong>docker exec</strong> 的原因。</p>
<p>更多参数说明请使用 <strong>docker exec —help</strong> 命令查看。</p>
</blockquote>
</li>
</ul>
<h4 id="2-2-7-导出、导入容器和删除容器"><a href="#2-2-7-导出、导入容器和删除容器" class="headerlink" title="2.2.7 导出、导入容器和删除容器"></a>2.2.7 导出、导入容器和删除容器</h4><ol>
<li><p><strong>导出容器</strong></p>
<p>如果要导出本地某个容器，可以使用 <strong>docker export</strong> 命令。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># cd DDocker/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker export c293ba3fecac &gt; ./ubuntu.tar</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>导出容器 <code>c293ba3fecac</code> 快照到本地文件 ubuntu.tar。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># ll ./</span></span><br><span class="line">total <span class="number">78476</span></span><br><span class="line"><span class="literal">-rw-r--r--</span>. <span class="number">1</span> root root <span class="number">80356864</span> Aug <span class="number">15</span> <span class="number">03</span>:<span class="number">15</span> ubuntu.tar</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>这样将导出容器快照到本地文件。</p>
</li>
<li><p><strong>导入容器快照</strong></p>
<p>可以使用 docker import 从容器快照文件中再导入为镜像，以下实例将快照文件 ubuntu.tar 导入到镜像 test/ubuntu:v1:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># cat ./ubuntu.tar | docker import - test/ubuntu:v1</span></span><br><span class="line">sha256:c46e9fe3434edee953f9dd9fe8d1a2351dba59c0abd6e4510055e3b39995b9aa</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">test/ubuntu   v1        c46e9fe3434e   <span class="number">5</span> seconds ago   <span class="number">77.8</span>MB</span><br><span class="line">ubuntu        latest    df5de72bdb3b   <span class="number">2</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">ubuntu        <span class="number">15.10</span>     <span class="number">9</span>b9cb95443b5   <span class="number">6</span> years ago     <span class="number">137</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>此外，也可以通过指定 URL 或者某个目录来导入，例如：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import 链接地址 example/imagerepo</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除容器</strong></p>
<p>删除容器使用 <strong>docker rm</strong> 命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED      STATUS      PORTS     NAMES</span><br><span class="line">c293ba3fecac   ubuntu    <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">3</span> days ago   Up <span class="number">3</span> days             ubuntu<span class="literal">-test</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker rm -f c293ba3fecac</span></span><br><span class="line">c293ba3fecac</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>清理掉所有处于终止状态的容器</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker container prune</span></span><br><span class="line">WARNING! This will remove all stopped containers.</span><br><span class="line">Are you sure you want to <span class="keyword">continue</span>? [<span class="type">y</span>/<span class="type">N</span>] y</span><br><span class="line">Deleted Containers:</span><br><span class="line"><span class="number">5358</span>c9601c75ab8b25844441696287320cad518773d558e5ba506274e8e933c0</span><br><span class="line">f8f69699ea5ee423c804656040a2512541dc1503320a19c573c5bf9a29bfb0a0</span><br><span class="line">ed4a85705ff3bdc89fae2c8464033dcc3e6d712a3bcdeec9a206a934f7b9e566</span><br><span class="line">c19a6c0f44d983b5fc42999acc8e344669e4e5cd5a3e95a288a76f2a9c3e716f</span><br><span class="line"><span class="number">09</span>a8c4e0a0ee2301d3b783fd326a9819ca39b94c6d891738ce1a760d4a1ca3<span class="built_in">fc</span></span><br><span class="line">ef0d5fdfe2791b92c8352e46d7e4c3bf226c555b097abc9f6ccdeec56bc59cbb</span><br><span class="line"></span><br><span class="line">Total reclaimed space: <span class="number">31</span>B</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-3-Docker-简单Web实例"><a href="#2-3-Docker-简单Web实例" class="headerlink" title="2.3 Docker 简单Web实例"></a>2.3 Docker 简单Web实例</h3><h4 id="2-3-1-运行一个-web-应用"><a href="#2-3-1-运行一个-web-应用" class="headerlink" title="2.3.1 运行一个 web 应用"></a>2.3.1 运行一个 web 应用</h4><p>前面运行的容器并没有一些什么特别的用处。</p>
<p>接下来让尝试使用 docker 构建一个 web 应用程序。在docker容器中运行一个 Python Flask 应用来运行一个web应用。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker pull training/webapp  # 载入镜像</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from training/webapp</span><br><span class="line">Image docker.io/training/webapp:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image <span class="keyword">for</span> better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated<span class="literal">-schema-v1</span>/</span><br><span class="line">e190868d63f8: Pull complete </span><br><span class="line"><span class="number">909</span>cd34c6fd7: Pull complete </span><br><span class="line"><span class="number">0</span>b9bfabab7c1: Pull complete </span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line"><span class="number">10</span>bbbc0fc0ff: Pull complete </span><br><span class="line">fca59b508e9f: Pull complete </span><br><span class="line">e7ae2541b15b: Pull complete </span><br><span class="line"><span class="number">9</span>dd97ef58ce9: Pull complete </span><br><span class="line">a4c1b0cb7af7: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">06</span>e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> training/webapp:latest</span><br><span class="line">docker.io/training/webapp:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -P training/webapp python app.py</span></span><br><span class="line"><span class="number">5</span>d69665d500ef470659f02a6fa4a5c36707b67ec552a6797b3efbf79d82797b3</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明:</p>
<ul>
<li><strong>-d:</strong>让容器在后台运行。</li>
<li><strong>-P:</strong>将容器内部使用的网络端口随机映射到我们使用的主机上。</li>
</ul>
<h4 id="2-3-2-查看-WEB-应用容器"><a href="#2-3-2-查看-WEB-应用容器" class="headerlink" title="2.3.2 查看 WEB 应用容器"></a>2.3.2 查看 WEB 应用容器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line"><span class="number">5</span>d69665d500e   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">2</span> minutes ago   Up <span class="number">2</span> minutes   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   jovial_kilby</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>这里多了端口信息 <code>0.0.0.0:49153-&gt;5000/tcp, :::49153-&gt;5000/tcp</code>。</p>
<p>Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 49153上。</p>
<p>这时我们可以通过浏览器访问WEB应用</p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_2.3.1%20%E6%9F%A5%E7%9C%8B%20WEB%20%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8.png" style="zoom:50%;" /></p>
<p>也可以通过 -p 参数来设置不一样的端口：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -p 5000:5000 training/webapp python app.py</span></span><br><span class="line"><span class="number">0</span>a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                                         NAMES</span><br><span class="line"><span class="number">0</span>a217a11c448   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">12</span> seconds ago   Up <span class="number">11</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp     awesome_tharp</span><br><span class="line"><span class="number">5</span>d69665d500e   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">23</span> hours ago     Up <span class="number">23</span> hours     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   jovial_kilby</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-3-网络端口的快捷方式"><a href="#2-3-3-网络端口的快捷方式" class="headerlink" title="2.3.3 网络端口的快捷方式"></a>2.3.3 网络端口的快捷方式</h4><p>通过 <code>docker ps</code> 命令可以查看到容器的端口映射，<strong>docker</strong> 还提供了另一个快捷方式 <code>docker port</code>，使用 <code>docker port</code> 可以查看指定 （ID 或者名字）容器的某个确定端口映射到宿主机的端口号。</p>
<p>上面创建的 web 应用容器 ID 为 <code>0a217a11c448</code> 名字为 <code>awesome_tharp</code>。</p>
<p>我可以使用 <code>docker port 0a217a11c448</code> 或 <code>docker port awesome_tharp</code> 来查看容器端口的映射情况。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker port 0a217a11c448</span></span><br><span class="line"><span class="number">5000</span>/tcp -&gt; <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span></span><br><span class="line"><span class="number">5000</span>/tcp -&gt; :::<span class="number">5000</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker port awesome_tharp</span></span><br><span class="line"><span class="number">5000</span>/tcp -&gt; <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span></span><br><span class="line"><span class="number">5000</span>/tcp -&gt; :::<span class="number">5000</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-4-查看Web应用程序日志"><a href="#2-3-4-查看Web应用程序日志" class="headerlink" title="2.3.4 查看Web应用程序日志"></a>2.3.4 查看Web应用程序日志</h4><p><code>docker logs [ID或者名字]</code> 可以查看容器内部的标准输出。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker logs -f 0a217a11c448</span></span><br><span class="line"> * Running on http://<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>/ (Press CTRL+C to quit)</span><br><span class="line"><span class="number">192.168</span>.<span class="number">48.1</span> - - [<span class="number">19</span>/<span class="type">Aug</span>/<span class="number">2022</span> <span class="number">08</span>:<span class="number">54</span>:<span class="number">01</span>] <span class="string">&quot;GET / HTTP/1.1&quot;</span> <span class="number">200</span> -</span><br><span class="line"><span class="number">192.168</span>.<span class="number">48.1</span> - - [<span class="number">19</span>/<span class="type">Aug</span>/<span class="number">2022</span> <span class="number">08</span>:<span class="number">54</span>:<span class="number">01</span>] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span class="number">404</span> -</span><br><span class="line"><span class="number">192.168</span>.<span class="number">48.1</span> - - [<span class="number">19</span>/<span class="type">Aug</span>/<span class="number">2022</span> <span class="number">08</span>:<span class="number">54</span>:<span class="number">03</span>] <span class="string">&quot;GET / HTTP/1.1&quot;</span> <span class="number">200</span> -</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>-f:</strong> 让 <strong>docker logs</strong> 像使用 <strong>tail -f</strong> 一样来输出容器内部的标准输出。</li>
</ul>
<p>从上面，可以看到应用程序使用的是 5000 端口并且能够查看到应用程序的访问日志。</p>
<h4 id="2-3-5-查看Web应用程序容器的进程"><a href="#2-3-5-查看Web应用程序容器的进程" class="headerlink" title="2.3.5 查看Web应用程序容器的进程"></a>2.3.5 查看Web应用程序容器的进程</h4><p>使用 docker top 来查看容器内部运行的进程：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker top awesome_tharp</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">12634</span>               <span class="number">12612</span>               <span class="number">0</span>                   <span class="number">01</span>:<span class="number">52</span>               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            python app.py</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-6-检查Web应用程序"><a href="#2-3-6-检查Web应用程序" class="headerlink" title="2.3.6 检查Web应用程序"></a>2.3.6 检查Web应用程序</h4><p>使用 <code>docker inspect</code> 来查看 Docker 的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker inspect awesome_tharp </span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2022-08-19T08:52:59.445311998Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;app.py&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="type">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: <span class="number">12634</span>,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2022-08-19T08:53:00.035220635Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:6fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89/0a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/awesome_tharp&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: <span class="type">null</span>,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;5000/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;5000&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;CgroupnsMode&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: <span class="number">67108864</span>,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/b297f5b6a2089c75af5d4a466b7d28760a309fd8d8038868d1c37552acf62393-init/diff:/var/lib/docker/overlay2/7154389c17280fdf4962246ab3dd248579bb536c13b07fe327bd8ec65ff36add/diff:/var/lib/docker/overlay2/711961c1287a9e045b7caa18fa4cf6d21e186a0fa80126905d2e832f27573bf5/diff:/var/lib/docker/overlay2/a57c52470deecd88547bc5d03c7418e7b88add1a22c61e49c62595219d46e368/diff:/var/lib/docker/overlay2/e4a2c8c9702b9cd21534ee77f134332c54a575036e3f6eb7d7d12e38f211d4a5/diff:/var/lib/docker/overlay2/f5eeb64487fcce01056ae15c28c4e1637d12fb6b518bcfa8c3e87452ab746939/diff:/var/lib/docker/overlay2/1f4882c84fd6fceab9f1063362906839f858f5ed07237f34e2fde4dea7d3b9ed/diff:/var/lib/docker/overlay2/e8b89880d7223d3a9ba8a4cc46d4b887b6ec33f4653bd0472d69516c6fac471b/diff:/var/lib/docker/overlay2/6e1d3528d9bb72efa226ba8631eab7ff7405d92c5f8d13825aec7de0a9c4b7a4/diff:/var/lib/docker/overlay2/d9b6e6af59f120800c9f332210dfe279ceeeb66bb6056496538d8e269470ad3b/diff:/var/lib/docker/overlay2/5861193f780069a9c6f8230a7d667941e5721b07f2c5313e320766288367913d/diff:/var/lib/docker/overlay2/306fcd234e922e52fdd1ce6aa7afc5013d430041f60a9451c3982be7b3251018/diff:/var/lib/docker/overlay2/d7e5fb7ae7525868dca45d5b61405e2f4008d88979c70c8f59ce8c117d77e42d/diff:/var/lib/docker/overlay2/574a21f740852a28afd807db044d9049e524be22450475138cb598a720038cbb/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/b297f5b6a2089c75af5d4a466b7d28760a309fd8d8038868d1c37552acf62393/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/b297f5b6a2089c75af5d4a466b7d28760a309fd8d8038868d1c37552acf62393/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/b297f5b6a2089c75af5d4a466b7d28760a309fd8d8038868d1c37552acf62393/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;0a217a11c448&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;5000/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;python&quot;</span>,</span><br><span class="line">                <span class="string">&quot;app.py&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;training/webapp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/opt/webapp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;6489190fa50b7e3fbe25a49a039250da0042155719bf3e455038399ab6e61f3a&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;5000/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;5000&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;::&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;5000&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/6489190fa50b&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;adbdf001a02ad9946a1b5df84a5e0d8bc2ec9e6dea316dc62ebaa714954bd423&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: <span class="type">null</span>,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: <span class="type">null</span>,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: <span class="type">null</span>,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;1df9775fe6801665441fb8dcde4fe10916578f316c83e1d3fa234ac473a433a6&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;adbdf001a02ad9946a1b5df84a5e0d8bc2ec9e6dea316dc62ebaa714954bd423&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.3&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: <span class="type">null</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-7-停止Web应用程序"><a href="#2-3-7-停止Web应用程序" class="headerlink" title="2.3.7 停止Web应用程序"></a>2.3.7 停止Web应用程序</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker stop awesome_tharp </span></span><br><span class="line">awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-8-重启Web应用容器"><a href="#2-3-8-重启Web应用容器" class="headerlink" title="2.3.8 重启Web应用容器"></a>2.3.8 重启Web应用容器</h4><p>已经停止的容器，可以使用命令 docker start 来启动。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker start awesome_tharp </span></span><br><span class="line">awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><code>docker ps -l</code> 查询最后一次创建的容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED             STATUS          PORTS                                       NAMES</span><br><span class="line"><span class="number">0</span>a217a11c448   training/webapp   <span class="string">&quot;python app.py&quot;</span>   About an hour ago   Up <span class="number">45</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp   awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>正在运行的容器，我们可以使用 <code>docker restart</code> 命令来重启。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker restart awesome_tharp </span></span><br><span class="line">awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-9-移除Web应用容器"><a href="#2-3-9-移除Web应用容器" class="headerlink" title="2.3.9 移除Web应用容器"></a>2.3.9 移除Web应用容器</h4><p>使用 docker rm 命令来删除不需要的容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker stop awesome_tharp</span></span><br><span class="line">awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker rm awesome_tharp</span></span><br><span class="line">awesome_tharp</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>除容器时，容器必须是停止状态，否则会报如下错误：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker rm awesome_tharp</span></span><br><span class="line">Error response from daemon: You cannot remove a running container <span class="number">0</span>a217a11c448cbe6e2223ddbe6dd09aeb883ad9614ce8050f12cb040c1399e89. Stop the container before attempting removal or force remove</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h2 id="3-Docker镜像使用"><a href="#3-Docker镜像使用" class="headerlink" title="3. Docker镜像使用"></a>3. Docker镜像使用</h2><p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p>
<h3 id="3-1-列出镜像列表"><a href="#3-1-列出镜像列表" class="headerlink" title="3.1 列出镜像列表"></a>3.1 列出镜像列表</h3><p>使用 <strong>docker images</strong> 来列出本地主机上的镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">test/ubuntu       v1        c46e9fe3434e   <span class="number">3</span> days ago    <span class="number">77.8</span>MB</span><br><span class="line">ubuntu            latest    df5de72bdb3b   <span class="number">2</span> weeks ago   <span class="number">77.8</span>MB</span><br><span class="line">ubuntu            <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">2</span> weeks ago   <span class="number">63.1</span>MB</span><br><span class="line">ubuntu            <span class="number">15.10</span>     <span class="number">9</span>b9cb95443b5   <span class="number">6</span> years ago   <span class="number">137</span>MB</span><br><span class="line">training/webapp   latest    <span class="number">6</span>fae60ef3446   <span class="number">7</span> years ago   <span class="number">349</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>各个选项说明:</p>
<ul>
<li><strong>REPOSITORY：</strong>表示镜像的仓库源</li>
<li><strong>TAG：</strong>镜像的标签</li>
<li><strong>IMAGE ID：</strong>镜像ID</li>
<li><strong>CREATED：</strong>镜像创建时间</li>
<li><strong>SIZE：</strong>镜像大小</li>
</ul>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 <code>15.10</code>、<code>18.04</code> 等多个不同的版本，我们使用 <code>REPOSITORY:TAG</code> 来定义不同的镜像。</p>
<p>所以，如果要使用版本为<code>15.10</code>的<code>ubuntu</code>系统镜像来运行容器时，命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -t -i ubuntu:15.10 /bin/bash</span></span><br><span class="line">root@<span class="number">4494</span>c4d76bef:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>ubuntu:15.10</strong>: 这是指用 ubuntu 15.10 版本镜像为基础来启动容器。</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li>
</ul>
<p>如果要使用版本为 18.04 的 ubuntu 系统镜像来运行容器时，命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -t -i ubuntu:18.04 /bin/bash</span></span><br><span class="line">root@d25c29d78f45:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>如果不指定一个镜像的版本标签，例如只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p>
<h3 id="3-2-获取一个新的镜像"><a href="#3-2-获取一个新的镜像" class="headerlink" title="3.2 获取一个新的镜像"></a>3.2 获取一个新的镜像</h3><p>当在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果想预先下载这个镜像，可以使用 docker pull 命令来下载它。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker pull ubuntu:13.10</span></span><br><span class="line"><span class="number">13.10</span>: Pulling from library/ubuntu</span><br><span class="line">Image docker.io/library/ubuntu:<span class="number">13.10</span> uses outdated schema1 manifest format. Please upgrade to a schema2 image <span class="keyword">for</span> better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated<span class="literal">-schema-v1</span>/</span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line"><span class="number">0</span>d8710fc57fd: Pull complete </span><br><span class="line"><span class="number">5037</span>c5cd623d: Pull complete </span><br><span class="line"><span class="number">83</span>b53423b49f: Pull complete </span><br><span class="line">e9e8bd3b94ab: Pull complete </span><br><span class="line"><span class="number">7</span>db00e6b6e5e: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">403105</span>e61e2d540187da20d837b6a6e92efc3eb4337da9c04c191fb5e28c44dc</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:<span class="number">13.10</span></span><br><span class="line">docker.io/library/ubuntu:<span class="number">13.10</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>下载完成后，可以直接使用这个镜像来运行容器。</p>
<h3 id="3-3-查找镜像"><a href="#3-3-查找镜像" class="headerlink" title="3.3 查找镜像"></a>3.3 查找镜像</h3><p>可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <strong><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></strong></p>
<p>也可以使用 <code>docker search</code> 命令来搜索镜像。比如需要一个 httpd 的镜像来作为web 服务。可以通过 <code>docker search</code> 命令搜索 httpd 来寻找适合我们的镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker search httpd</span></span><br><span class="line">NAME                                 DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">httpd                                The Apache HTTP Server Project                  <span class="number">4121</span>      [<span class="type">OK</span>]       </span><br><span class="line">centos/httpd<span class="literal">-24-centos7</span>              Platform <span class="keyword">for</span> running Apache httpd <span class="number">2.4</span> or bui…   <span class="number">44</span>                   </span><br><span class="line">centos/httpd                                                                         <span class="number">35</span>                   [<span class="type">OK</span>]</span><br><span class="line">hypoport/httpd<span class="literal">-cgi</span>                   httpd<span class="literal">-cgi</span>                                       <span class="number">2</span>                    [<span class="type">OK</span>]</span><br><span class="line">clearlinux/httpd                     httpd HyperText Transfer Protocol (HTTP) ser…   <span class="number">2</span>                    </span><br><span class="line">solsson/httpd<span class="literal">-openidc</span>                mod_auth_openidc on official httpd image, ve…   <span class="number">2</span>                    [<span class="type">OK</span>]</span><br><span class="line">nnasaki/httpd<span class="literal">-ssi</span>                    SSI enabled Apache <span class="number">2.4</span> on Alpine Linux          <span class="number">1</span>                    </span><br><span class="line">dockerpinata/httpd                                                                   <span class="number">1</span>                    </span><br><span class="line">centos/httpd<span class="literal">-24-centos8</span>                                                              <span class="number">1</span>                    </span><br><span class="line">lead4good/httpd<span class="literal">-fpm</span>                  httpd server which connects via fcgi proxy <span class="built_in">h</span>…   <span class="number">1</span>                    [<span class="type">OK</span>]</span><br><span class="line">inanimate/httpd<span class="literal">-ssl</span>                  A play container with httpd, ssl enabled, an…   <span class="number">1</span>                    [<span class="type">OK</span>]</span><br><span class="line">dariko/httpd<span class="literal">-rproxy-ldap</span>             Apache httpd reverse proxy with LDAP authent…   <span class="number">1</span>                    [<span class="type">OK</span>]</span><br><span class="line">manageiq/httpd                       Container with httpd, built on CentOS <span class="keyword">for</span> Ma…   <span class="number">1</span>                    [<span class="type">OK</span>]</span><br><span class="line">publici/httpd                        httpd:latest                                    <span class="number">1</span>                    [<span class="type">OK</span>]</span><br><span class="line">httpdocker/kubia                                                                     <span class="number">0</span>                    </span><br><span class="line">patrickha/httpd<span class="literal">-err</span>                                                                  <span class="number">0</span>                    </span><br><span class="line">manageiq/httpd_configmap_generator   Httpd Configmap Generator                       <span class="number">0</span>                    [<span class="type">OK</span>]</span><br><span class="line">amd64/httpd                          The Apache HTTP Server Project                  <span class="number">0</span>                    </span><br><span class="line">manasip/httpd                                                                        <span class="number">0</span>                    </span><br><span class="line">httpdss/archerysec                   ArcherySec repository                           <span class="number">0</span>                    [<span class="type">OK</span>]</span><br><span class="line">e2eteam/httpd                                                                        <span class="number">0</span>                    </span><br><span class="line">sandeep1988/httpd<span class="literal">-new</span>                httpd<span class="literal">-new</span>                                       <span class="number">0</span>                    </span><br><span class="line">paketobuildpacks/httpd                                                               <span class="number">0</span>                    </span><br><span class="line"><span class="number">19022021</span>/httpd<span class="literal">-connection_test</span>       This httpd image will test the connectivity …   <span class="number">0</span>                    </span><br><span class="line">sherazahmedvaival/httpd<span class="literal">-php-fpm74</span>                                                    <span class="number">0</span>                    </span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><p><strong>NAME:</strong> 镜像仓库源的名称</p>
</li>
<li><p><strong>DESCRIPTION:</strong> 镜像的描述</p>
</li>
<li><p><strong>OFFICIAL:</strong> 是否 docker 官方发布</p>
</li>
<li><p><strong>stars:</strong> 类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
</li>
<li><p><strong>AUTOMATED:</strong> 自动构建。</p>
</li>
</ul>
<h3 id="3-4-拖取镜像"><a href="#3-4-拖取镜像" class="headerlink" title="3.4 拖取镜像"></a>3.4 拖取镜像</h3><p>决定使用上图中的<code>httpd</code> 官方版本的镜像，使用命令 <code>docker pull</code> 来下载镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker pull httpd</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line"><span class="number">1</span>efc276f4ff9: Downloading [==================================================&gt;]  <span class="number">31.37</span>MB/<span class="number">31.37</span>MB</span><br><span class="line">aed046121ed8: Download complete </span><br><span class="line"><span class="number">4340</span>e7be3d7f: Download complete </span><br><span class="line"><span class="number">80</span>e368ef21<span class="built_in">fc</span>: Download complete </span><br><span class="line"><span class="number">80</span>cb79a80bbe: Download complete </span><br><span class="line"><span class="built_in">write</span> /var/lib/docker/tmp/GetImageBlob1509640261: no space left on device</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>下载完成后，就可以使用这个镜像了。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">docker</span>]<span class="comment"># docker run httpd</span></span><br><span class="line">Unable to find image <span class="string">&#x27;httpd:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line"><span class="number">1</span>efc276f4ff9: Pull complete </span><br><span class="line">aed046121ed8: Pull complete </span><br><span class="line"><span class="number">4340</span>e7be3d7f: Pull complete </span><br><span class="line"><span class="number">80</span>e368ef21<span class="built_in">fc</span>: Pull complete </span><br><span class="line"><span class="number">80</span>cb79a80bbe: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">343452</span>ec820a5d59eb3ab9aaa6201d193f91c3354f8c4f29705796d9353d4cc6</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> httpd:latest</span><br><span class="line">AH00558: httpd: Could not reliably determine the server<span class="string">&#x27;s fully qualified domain name, using 172.17.0.2. Set the &#x27;</span>ServerName<span class="string">&#x27; directive globally to suppress this message</span></span><br><span class="line"><span class="string">AH00558: httpd: Could not reliably determine the server&#x27;</span>s fully qualified domain name, <span class="keyword">using</span> 172.17.0.2. Set the <span class="string">&#x27;ServerName&#x27;</span> directive globally to suppress this message</span><br><span class="line">[<span class="type">Mon</span> <span class="type">Aug</span> <span class="number">22</span> <span class="number">06</span>:<span class="number">29</span>:<span class="number">11.880882</span> <span class="number">2022</span>] [<span class="type">mpm_event</span>:<span class="type">notice</span>] [<span class="type">pid</span> <span class="number">1</span>:<span class="type">tid</span> <span class="number">140442894695744</span>] AH00489: Apache/<span class="number">2.4</span>.<span class="number">54</span> (Unix) configured <span class="literal">--</span> resuming normal operations</span><br><span class="line">[<span class="type">Mon</span> <span class="type">Aug</span> <span class="number">22</span> <span class="number">06</span>:<span class="number">29</span>:<span class="number">11.881094</span> <span class="number">2022</span>] [<span class="type">core</span>:<span class="type">notice</span>] [<span class="type">pid</span> <span class="number">1</span>:<span class="type">tid</span> <span class="number">140442894695744</span>] AH00094: Command line: <span class="string">&#x27;httpd -D FOREGROUND&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-5-删除镜像"><a href="#3-5-删除镜像" class="headerlink" title="3.5 删除镜像"></a>3.5 删除镜像</h3><p>镜像删除使用<code>docker rmi</code> 命令，比如删除<code>hello-world</code> 镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">docker</span>]<span class="comment"># docker rmi hello-world</span></span><br><span class="line">Untagged: hello<span class="literal">-world</span>:latest</span><br><span class="line">Untagged: hello<span class="literal">-world</span>@sha256:<span class="number">7</span>d246653d0511db2a6b2e0436cfd0e52ac8c066000264b3ce63331ac66dca625</span><br><span class="line">Deleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412</span><br><span class="line">Deleted: sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">docker</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-创建镜像"><a href="#3-6-创建镜像" class="headerlink" title="3.6 创建镜像"></a>3.6 创建镜像</h3><p>当从 docker 镜像仓库中下载的镜像不能满足需求时，可以通过以下方式对镜像进行更改。</p>
<h4 id="3-6-1-更新镜像"><a href="#3-6-1-更新镜像" class="headerlink" title="3.6.1 更新镜像"></a>3.6.1 更新镜像</h4><p><strong>从已经创建的容器中更新镜像，并且提交这个镜像。</strong></p>
<p>更新镜像之前，需要使用镜像来创建一个容器。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -t -i ubuntu:18.04 /bin/bash</span></span><br><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>在运行的容器内使用 <code>apt-get update</code> 命令进行更新。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># apt-get update</span></span><br><span class="line">Ign:<span class="number">1</span> http://mirrors.<span class="number">163</span>.com/debian jessie InRelease</span><br><span class="line">Ign:<span class="number">2</span> http://mirrors.<span class="number">163</span>.com/debian jessie<span class="literal">-proposed-updates</span> InRelease                                                  </span><br><span class="line">Get:<span class="number">3</span> http://mirrors.<span class="number">163</span>.com/debian jessie Release [<span class="number">77.3</span> <span class="type">kB</span>]                                                           </span><br><span class="line">Hit:<span class="number">4</span> http://archive.ubuntu.com/ubuntu bionic InRelease                                                  </span><br><span class="line">Err:<span class="number">5</span> http://mirrors.<span class="number">163</span>.com/debian jessie<span class="literal">-proposed-updates</span> Release                                      </span><br><span class="line">  <span class="number">404</span>  Not Found [<span class="type">IP</span>: <span class="number">60.191</span><span class="type">.80.11</span> <span class="number">80</span>]</span><br><span class="line">Get:<span class="number">6</span> http://mirrors.<span class="number">163</span>.com/debian jessie Release.gpg [<span class="number">1652</span> <span class="type">B</span>]     </span><br><span class="line">Hit:<span class="number">7</span> http://archive.ubuntu.com/ubuntu bionic<span class="literal">-updates</span> InRelease            </span><br><span class="line">Hit:<span class="number">8</span> http://security.ubuntu.com/ubuntu bionic<span class="literal">-security</span> InRelease          </span><br><span class="line">Ign:<span class="number">6</span> http://mirrors.<span class="number">163</span>.com/debian jessie Release.gpg                     </span><br><span class="line">Hit:<span class="number">9</span> http://archive.ubuntu.com/ubuntu bionic<span class="literal">-backports</span> InRelease</span><br><span class="line">Reading package lists... Done</span><br><span class="line">E: The repository <span class="string">&#x27;http://mirrors.163.com/debian jessie-proposed-updates Release&#x27;</span> does not have a Release file.</span><br><span class="line">N: Updating from such a repository can<span class="string">&#x27;t be done securely, and is therefore disabled by default.</span></span><br><span class="line"><span class="string">N: See apt-secure(8) manpage for repository creation and user configuration details.</span></span><br><span class="line"><span class="string">W: GPG error: http://mirrors.163.com/debian jessie Release: The following signatures couldn&#x27;</span>t be verified because the public key is not available: NO_PUBKEY <span class="number">7638</span>D0442B90D010 NO_PUBKEY CBF8D6FD518E17E1</span><br><span class="line">E: The repository <span class="string">&#x27;http://mirrors.163.com/debian jessie Release&#x27;</span> is not signed.</span><br><span class="line">N: Updating from such a repository can<span class="string">&#x27;t be done securely, and is therefore disabled by default.</span></span><br><span class="line"><span class="string">N: See apt-secure(8) manpage for repository creation and user configuration details.</span></span><br><span class="line"><span class="string">root@5a156e79af57:/# </span></span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><p><strong>问题阐述：</strong></p>
<p>在运行的容器内使用 <code>apt-get update</code> 命令进行更新时，发下很多404错误。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># apt-get update </span></span><br><span class="line">Ign http://archive.ubuntu.com wily InRelease</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-updates</span> InRelease</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-security</span> InRelease</span><br><span class="line">Ign http://archive.ubuntu.com wily Release.gpg</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-updates</span> Release.gpg</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-security</span> Release.gpg</span><br><span class="line">Ign http://archive.ubuntu.com wily Release</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-updates</span> Release</span><br><span class="line">Ign http://archive.ubuntu.com wily<span class="literal">-security</span> Release</span><br><span class="line">Err http://archive.ubuntu.com wily/main Sources</span><br><span class="line">  <span class="number">404</span>  Not Found [<span class="type">IP</span>: <span class="number">91.189</span><span class="type">.91.39</span> <span class="number">80</span>]</span><br><span class="line">Err http://archive.ubuntu.com wily/restricted Sources</span><br><span class="line">  <span class="number">404</span>  Not Found [<span class="type">IP</span>: <span class="number">91.189</span><span class="type">.91.39</span> <span class="number">80</span>]</span><br><span class="line">...</span><br><span class="line">W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/wily<span class="literal">-security</span>/universe/binary<span class="literal">-amd64</span>/Packages  <span class="number">404</span>  Not Found [<span class="type">IP</span>: <span class="number">91.189</span><span class="type">.91.39</span> <span class="number">80</span>]</span><br><span class="line"></span><br><span class="line">E: Some index files failed to download. They have been ignored, or old ones used instead.</span><br><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>问题解决：</strong></p>
<p>经查，每一个Ubuntu发布版本都有它的结束时间，通常，Ubuntu发布版本支持18个月，而LTS (Long Term Support)（长期支持）版本分别支持3年(服务器版)和5年(桌面版)。</p>
<p>当一个Ubuntu发布版本到达结束期后，它的库将不再能够访问，并且你也不会得到任何维护更新和安全补丁。当写这个的时候，我的15.10版本已经到了它的结束期了。<br>对于那些使用旧版本的Ubuntu的用户，这是一个过期库的归档。因此，Ubuntu过期后，我们必须把源切换到 old-releases.ubuntu.com。</p>
<p>下面的方法通过切换到旧版本的源来解决“404 Not Found”错误。</p>
<p>首先，使用旧版本的源来替换当前主源</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># cat &lt;&lt;eof&gt; /etc/apt/sources.list</span></span><br><span class="line">&gt; deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">&gt; deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal<span class="literal">-updates</span> main restricted universe multiverse</span><br><span class="line">&gt; deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal<span class="literal">-backports</span> main restricted universe multiverse</span><br><span class="line">&gt; deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal<span class="literal">-security</span> main restricted universe multiverse</span><br><span class="line">&gt; deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal<span class="literal">-proposed</span> main restricted universe multiverse</span><br><span class="line">&gt; eof</span><br><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>现在，应该能够在旧版本的Ubuntu镜像系统上进行安装或者更新了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># apt-get update</span></span><br><span class="line">......</span><br><span class="line">root@<span class="number">5</span>a156e79af57:/<span class="comment"># apt-get install vim</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>更换国内镜像</strong></p>
<p>打开网站<code>https://mirrors.tuna.tsinghua.edu.cn/</code></p>
<p>找到<code>ubuntu</code>后面的问号，点击跳转后，有对应的设置方法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">94</span>a33576bd1b:/<span class="comment"># sed -i &quot;s@http://.*archive.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g&quot; /etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line">root@<span class="number">94</span>a33576bd1b:/<span class="comment"># sed -i &quot;s@http://.*security.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g&quot; /etc/apt/sources.list</span></span><br><span class="line">root@<span class="number">94</span>a33576bd1b:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<p>在完成操作之后，输入 <code>exit</code> 命令来退出这个容器。</p>
<p>此时 ID 为 <code>94a33576bd1b</code> 的容器，是按需求更改的容器。可以通过命令 <code>docker commit</code> 来提交容器副本。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker commit -m &quot;has update&quot; -a=&quot;yanpenggong&quot; 94a33576bd1b yanpenggong/ubuntu:v2</span></span><br><span class="line">sha256:e0a0ea0b15174c6f322a806ca08f11c316b4f878c01689a807c950f3447b840b</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>各个参数说明：</p>
<ul>
<li><strong>-m:</strong> 提交的描述信息</li>
<li><strong>-a:</strong> 指定镜像作者</li>
<li><strong>e218edb10161：</strong>容器 ID</li>
<li><strong>runoob/ubuntu:v2:</strong> 指定要创建的目标镜像名</li>
</ul>
<p>我们可以使用 <code>docker images</code> 命令来查看我们的新镜像 <code>yanpenggong/ubuntu:v2</code>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY           TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">yanpenggong/ubuntu   v2        e0a0ea0b1517   <span class="number">46</span> seconds ago   <span class="number">99.3</span>MB</span><br><span class="line">httpd                latest    f2a976f932ec   <span class="number">2</span> weeks ago      <span class="number">145</span>MB</span><br><span class="line">ubuntu               <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">2</span> weeks ago      <span class="number">63.1</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>使用我们的新镜像  <code>yanpenggong/ubuntu</code> 来启动一个容器:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">software</span>]<span class="comment"># docker run -t -i yanpenggong/ubuntu:v2 /bin/bash</span></span><br><span class="line">root@<span class="number">4</span>cd6ec171b77:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="3-6-2-构建镜像"><a href="#3-6-2-构建镜像" class="headerlink" title="3.6.2 构建镜像"></a>3.6.2 构建镜像</h4><p><strong>使用 Dockerfile 指令来创建一个新的镜像</strong>。</p>
<p>使用命令 <code>docker build</code>， 从零开始来创建一个新的镜像。为此，我们需要创建一个 <code>Dockerfile</code> 文件，其中包含一组指令来告诉 Docker 如何构建镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># cat Dockerfile </span></span><br><span class="line">FROM        centos:<span class="number">6.7</span></span><br><span class="line">MAINTAINER  yanpenggong <span class="string">&quot;yanpenggong@163.com&quot;</span></span><br><span class="line"></span><br><span class="line">RUN         /bin/<span class="built_in">echo</span> <span class="string">&quot;root:yanpenggong&quot;</span> | chpasswd</span><br><span class="line">RUN         useradd yanpenggong</span><br><span class="line">RUN         /bin/<span class="built_in">echo</span> <span class="string">&quot;yanpenggong:yanpenggong&quot;</span> | chpasswd</span><br><span class="line">RUN         /bin/<span class="built_in">echo</span> <span class="literal">-e</span> <span class="string">&quot;LANG=\&quot;</span>en_US.UTF<span class="literal">-8</span>\<span class="string">&quot;&quot;</span> &gt; /etc/default/local</span><br><span class="line">EXPOSE      <span class="number">22</span></span><br><span class="line">EXPOSE      <span class="number">80</span></span><br><span class="line">CMD         /usr/sbin/sshd <span class="literal">-D</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</p>
<p>第一条FROM，指定使用哪个镜像源，RUN 指令告诉docker 在镜像内执行命令，安装了什么。</p>
</blockquote>
<p><strong>参数说明：</strong></p>
<ul>
<li><strong>FROM</strong>：构建镜像基于哪个镜像</li>
<li><strong>MAINTAINER</strong>：镜像维护者姓名或邮箱地址</li>
<li><strong>RUN</strong>：构建镜像时运行的指令</li>
<li><strong>CMD</strong>：运行容器时执行的shell环境</li>
<li><strong>VOLUME</strong>：指定容器挂载点到宿主机自动生成的目录或其他容器</li>
<li><strong>USER</strong>：为RUN、CMD、和 ENTRYPOINT 执行命令指定运行用户</li>
<li><strong>WORKDIR</strong>：为 RUN、CMD、ENTRYPOINT、COPY 和 ADD 设置工作目录，就是切换目录</li>
<li><strong>HEALTHCHECH</strong>：健康检查</li>
<li><strong>ARG</strong>：构建时指定的一些参数</li>
<li><strong>EXPOSE</strong>：声明容器的服务端口（仅仅是声明）</li>
<li><strong>ENV</strong>：设置容器环境变量</li>
<li><strong>ADD</strong>：拷贝文件或目录到容器中，如果是URL或压缩包便会自动下载或自动解压</li>
<li><strong>COPY</strong>：拷贝文件或目录到容器中，跟ADD类似，但不具备自动下载或解压的功能</li>
<li><strong>ENTRYPOINT</strong>：运行容器时执行的shell命令</li>
</ul>
<p>然后，使用 Dockerfile 文件，通过 <code>docker build</code> 命令来构建一个镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker build -t yanpenggong/centos:6.7 .</span></span><br><span class="line">Sending build context to Docker daemon  <span class="number">80.36</span>MB</span><br><span class="line">Step <span class="number">1</span>/<span class="number">9</span> : FROM        centos:<span class="number">6.7</span></span><br><span class="line"><span class="number">6.7</span>: Pulling from library/centos</span><br><span class="line">cbddbc0189a0: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">4</span>c952fc7d30ed134109c769387313ab864711d1bd8b4660017f9d27243622df1</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:<span class="number">6.7</span></span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">9</span>f1de3c6ad53</span><br><span class="line">Step <span class="number">2</span>/<span class="number">9</span> : MAINTAINER  yanpenggong <span class="string">&quot;yanpenggong@163.com&quot;</span></span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> f2ceecd3f084</span><br><span class="line">Removing intermediate container f2ceecd3f084</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">94858</span>bb3d4ef</span><br><span class="line">Step <span class="number">3</span>/<span class="number">9</span> : RUN         /bin/<span class="built_in">echo</span> <span class="string">&quot;root:yanpenggong&quot;</span> | chpasswd</span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">425</span>b7bfbb037</span><br><span class="line">Removing intermediate container <span class="number">425</span>b7bfbb037</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">1</span>c9059ca47f8</span><br><span class="line">Step <span class="number">4</span>/<span class="number">9</span> : RUN         useradd yanpenggong</span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">03</span>fc22eb515b</span><br><span class="line">Removing intermediate container <span class="number">03</span>fc22eb515b</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">27028</span>b46ae31</span><br><span class="line">Step <span class="number">5</span>/<span class="number">9</span> : RUN         /bin/<span class="built_in">echo</span> <span class="string">&quot;yanpenggong:yanpenggong&quot;</span> | chpasswd</span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> e8ad081c0835</span><br><span class="line">Removing intermediate container e8ad081c0835</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">06533911</span>be02</span><br><span class="line">Step <span class="number">6</span>/<span class="number">9</span> : RUN         /bin/<span class="built_in">echo</span> <span class="literal">-e</span> <span class="string">&quot;LANG=\&quot;</span>en_US.UTF<span class="literal">-8</span>\<span class="string">&quot;&quot;</span> &gt; /etc/default/local</span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> ea73216a2abc</span><br><span class="line">Removing intermediate container ea73216a2abc</span><br><span class="line"> <span class="literal">---</span>&gt; a09cf5c5f9a1</span><br><span class="line">Step <span class="number">7</span>/<span class="number">9</span> : EXPOSE      <span class="number">22</span></span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">2090</span>bcdb357b</span><br><span class="line">Removing intermediate container <span class="number">2090</span>bcdb357b</span><br><span class="line"> <span class="literal">---</span>&gt; d7c5685a04ce</span><br><span class="line">Step <span class="number">8</span>/<span class="number">9</span> : EXPOSE      <span class="number">80</span></span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">09</span>b19ed81af5</span><br><span class="line">Removing intermediate container <span class="number">09</span>b19ed81af5</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">5</span>acf09136b6b</span><br><span class="line">Step <span class="number">9</span>/<span class="number">9</span> : CMD         /usr/sbin/sshd <span class="literal">-D</span></span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">514</span>a034e0a13</span><br><span class="line">Removing intermediate container <span class="number">514</span>a034e0a13</span><br><span class="line"> <span class="literal">---</span>&gt; d791216a0356</span><br><span class="line">Successfully built d791216a0356</span><br><span class="line">Successfully tagged yanpenggong/centos:<span class="number">6.7</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>-t</strong> ：指定要创建的目标镜像名</li>
<li><strong>.</strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li>
</ul>
<p>使用<code>docker images</code> 查看创建的镜像已经在列表中存在,镜像ID为<code>d791216a0356</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY           TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">yanpenggong/centos   <span class="number">6.7</span>       d791216a0356   <span class="number">48</span> seconds ago   <span class="number">191</span>MB</span><br><span class="line">yanpenggong/ubuntu   v2        e0a0ea0b1517   <span class="number">56</span> minutes ago   <span class="number">99.3</span>MB</span><br><span class="line">httpd                latest    f2a976f932ec   <span class="number">2</span> weeks ago      <span class="number">145</span>MB</span><br><span class="line">ubuntu               <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">2</span> weeks ago      <span class="number">63.1</span>MB</span><br><span class="line">centos               <span class="number">6.7</span>       <span class="number">9</span>f1de3c6ad53   <span class="number">3</span> years ago      <span class="number">191</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>使用新的镜像来创建容器:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -it yanpenggong/centos:6.7 /bin/bash</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">666</span><span class="type">f0af44d9c</span> /]<span class="comment"># id yanpenggong</span></span><br><span class="line">uid=<span class="number">500</span>(yanpenggong) gid=<span class="number">500</span>(yanpenggong) groups=<span class="number">500</span>(yanpenggong)</span><br><span class="line">[<span class="type">root</span>@<span class="number">666</span><span class="type">f0af44d9c</span> /]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>从上面看到新镜像已经包含我们创建的用户 <code>yanpenggong</code>。</p>
<h4 id="3-6-3-设置镜像标签"><a href="#3-6-3-设置镜像标签" class="headerlink" title="3.6.3 设置镜像标签"></a>3.6.3 设置镜像标签</h4><p>使用 <code>docker tag</code> 命令，为镜像添加一个新的标签。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker tag d791216a0356 yanpenggong/centos:dev</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><code>docker tag 镜像ID</code>，这里是 <code>d791216a0356</code> ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p>
<p>使用 <code>docker images</code> 命令可以看到，ID为<code>d791216a0356</code>的镜像多一个标签。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY           TAG       IMAGE ID       CREATED             SIZE</span><br><span class="line">yanpenggong/centos   <span class="number">6.7</span>       d791216a0356   <span class="number">6</span> minutes ago       <span class="number">191</span>MB</span><br><span class="line">yanpenggong/centos   dev       d791216a0356   <span class="number">6</span> minutes ago       <span class="number">191</span>MB</span><br><span class="line">yanpenggong/ubuntu   v2        e0a0ea0b1517   About an hour ago   <span class="number">99.3</span>MB</span><br><span class="line">httpd                latest    f2a976f932ec   <span class="number">2</span> weeks ago         <span class="number">145</span>MB</span><br><span class="line">ubuntu               <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">2</span> weeks ago         <span class="number">63.1</span>MB</span><br><span class="line">centos               <span class="number">6.7</span>       <span class="number">9</span>f1de3c6ad53   <span class="number">3</span> years ago         <span class="number">191</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h2 id="4-Docker容器连接"><a href="#4-Docker容器连接" class="headerlink" title="4. Docker容器连接"></a>4. Docker容器连接</h2><p>容器中可以运行一些网络应用，要让外部也可以访问这些应用，可以通过 <code>-P</code> 或 <code>-p</code> 参数来指定端口映射。</p>
<p>下面我们来实现通过端口连接到一个 docker 容器。</p>
<h3 id="4-1-网络端口映射"><a href="#4-1-网络端口映射" class="headerlink" title="4.1 网络端口映射"></a>4.1 网络端口映射</h3><p>创建了一个 python 应用的容器:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -P training/webapp python app.py</span></span><br><span class="line">Unable to find image <span class="string">&#x27;training/webapp:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from training/webapp</span><br><span class="line">Image docker.io/training/webapp:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image <span class="keyword">for</span> better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated<span class="literal">-schema-v1</span>/</span><br><span class="line">e190868d63f8: Pull complete </span><br><span class="line"><span class="number">909</span>cd34c6fd7: Pull complete </span><br><span class="line"><span class="number">0</span>b9bfabab7c1: Pull complete </span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line"><span class="number">10</span>bbbc0fc0ff: Pull complete </span><br><span class="line">fca59b508e9f: Pull complete </span><br><span class="line">e7ae2541b15b: Pull complete </span><br><span class="line"><span class="number">9</span>dd97ef58ce9: Pull complete </span><br><span class="line">a4c1b0cb7af7: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">06</span>e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> training/webapp:latest</span><br><span class="line"><span class="number">949</span>ba9ad02954210132ff41d52c4d402031a4b87647a62be458cec17ee2a1fc5</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>另外，可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<p>使用 <strong>-P</strong> 绑定端口号，使用 <strong>docker ps</strong> 可以看到容器端口 5000 绑定主机端口 49153。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line"><span class="number">949</span>ba9ad0295   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">9</span> seconds ago   Up <span class="number">8</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   hopeful_darwin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>也可以使用 <strong>-p</strong> 标识来指定容器端口绑定到主机端口。</p>
<p>两种方式的区别是:</p>
<ul>
<li><strong>-P :</strong> [大写]，是容器内部端口<strong>随机</strong>映射到主机的端口。</li>
<li><strong>-p :</strong> [小写]，是容器内部端口绑定到<strong>指定</strong>的主机端口。</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -p 5000:5000 training/webapp python app.py</span></span><br><span class="line">fabc2132704350dfe29a1b899abef72926660a8ffb98f04f6a05d00db367e3f6</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                                         NAMES</span><br><span class="line">fabc21327043   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">28</span> seconds ago   Up <span class="number">27</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp     competent_allen</span><br><span class="line"><span class="number">949</span>ba9ad0295   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">3</span> hours ago      Up <span class="number">3</span> hours      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   hopeful_darwin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>另外，可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -p 127.0.0.1:5001:5000 training/webapp python app.py</span></span><br><span class="line"><span class="number">08</span>da7892182cc14a717909593cfcd62862f6bcae9535aa8af88563b281b107e9</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line"><span class="number">08</span>da7892182c   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">2</span> seconds ago   Up <span class="number">1</span> second    <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5001</span>-&gt;<span class="number">5000</span>/tcp                      angry_beaver</span><br><span class="line">fabc21327043   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">4</span> minutes ago   Up <span class="number">4</span> minutes   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp     competent_allen</span><br><span class="line"><span class="number">949</span>ba9ad0295   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">3</span> hours ago     Up <span class="number">3</span> hours     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   hopeful_darwin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>这样就可以通过访问 <code>127.0.0.1:5001</code> 来访问容器的 5000 端口。</p>
<p>上面的例子中，默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 <code>/udp</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -p 127.0.0.1:5001:5000/udp training/webapp python app.py</span></span><br><span class="line"><span class="number">452</span>f6b05777215093e648b730693ca6f5f9c2b1c75909a92b13b87dd84eb549e</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED              STATUS              PORTS                                         NAMES</span><br><span class="line"><span class="number">452</span>f6b057772   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">2</span> seconds ago        Up <span class="number">1</span> second         <span class="number">5000</span>/tcp, <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5001</span>-&gt;<span class="number">5000</span>/udp            beautiful_rosalind</span><br><span class="line"><span class="number">08</span>da7892182c   training/webapp   <span class="string">&quot;python app.py&quot;</span>   About a minute ago   Up About a minute   <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5001</span>-&gt;<span class="number">5000</span>/tcp                      angry_beaver</span><br><span class="line">fabc21327043   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">6</span> minutes ago        Up <span class="number">5</span> minutes        <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">5000</span>-&gt;<span class="number">5000</span>/tcp     competent_allen</span><br><span class="line"><span class="number">949</span>ba9ad0295   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">3</span> hours ago          Up <span class="number">3</span> hours          <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49153</span>-&gt;<span class="number">5000</span>/tcp   hopeful_darwin</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>docker port</strong> 命令可以快捷地查看端口的绑定情况。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker port angry_beaver 5000</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5001</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-Docker-容器互联"><a href="#4-2-Docker-容器互联" class="headerlink" title="4.2 Docker 容器互联"></a>4.2 Docker 容器互联</h3><p>端口映射并不是唯一把 docker 连接到另一个容器的方法。</p>
<p>docker 有一个连接系统允许将多个容器连接在一起，共享连接信息。</p>
<p>docker 连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p>
<h4 id="4-2-1-容器命名"><a href="#4-2-1-容器命名" class="headerlink" title="4.2.1 容器命名"></a>4.2.1 容器命名</h4><p>当创建一个容器的时候，docker 会自动对它进行命名。另外，也可以使用 <strong>—name</strong> 标识来命名容器，例如：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -d -P --name gyp01 training/webapp python app.py</span></span><br><span class="line"><span class="number">1</span>b5960c5c67768da9bfa1e692bfb4e92ffb8bb7adf84e97673834897428305ad</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>可以使用 <code>docker ps</code> 命令来查看容器名称。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND           CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line"><span class="number">1</span>b5960c5c677   training/webapp   <span class="string">&quot;python app.py&quot;</span>   <span class="number">9</span> seconds ago   Up <span class="number">8</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">49154</span>-&gt;<span class="number">5000</span>/tcp, :::<span class="number">49154</span>-&gt;<span class="number">5000</span>/tcp   gyp01</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-2-新建网络"><a href="#4-2-2-新建网络" class="headerlink" title="4.2.2 新建网络"></a>4.2.2 新建网络</h4><p>创建一个新的 Docker 网络。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker network create -d bridge test-net</span></span><br><span class="line"><span class="number">9</span>cd4cfe85b059e418a34d22ad67c93163fde29fd24c558b18ec8ffd2f67a32e8</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME       DRIVER    SCOPE</span><br><span class="line"><span class="number">90318</span>cd44c6e   bridge     bridge    local</span><br><span class="line"><span class="number">1</span>a9a32f8cdda   host       host      local</span><br><span class="line"><span class="number">83</span>e6b7fb39a6   none       null      local</span><br><span class="line"><span class="number">9</span>cd4cfe85b05   <span class="built_in">test-net</span>   bridge    local</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<p><strong>-d</strong>：参数指定 Docker 网络类型，有 bridge、overlay。</p>
<p>其中 overlay 网络类型用于 Swarm mode。</p>
<h4 id="4-2-3-连接容器"><a href="#4-2-3-连接容器" class="headerlink" title="4.2.3 连接容器"></a>4.2.3 连接容器</h4><p>运行一个容器并连接到新建的 test-net 网络:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -itd --name test1 --network test-net ubuntu /bin/bash</span></span><br><span class="line">Unable to find image <span class="string">&#x27;ubuntu:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line">d19f32bd9e41: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">34</span>fea4f31bf187bc915536831fd0afc9d214755bf700b5cdb1336c82516d154e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:latest</span><br><span class="line">e6d15d1d5dc6f9698ab88a74c029d24e9b960a3ef45a946a476ffc0db6a3c64a</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>打开新的终端，再运行一个容器并加入到 test-net 网络:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -itd --name test2 --network test-net ubuntu /bin/bash</span></span><br><span class="line">fa1f782105efcc19828d20e4391e91bb8d480621c3cab330be73820a58091a96</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>下面通过 ping 来证明 test1 容器和 test2 容器建立了互联关系。</p>
<p>如果 test1、test2 容器内中无 ping 命令，则在容器内执行以下命令安装 ping（即学即用：可以在一个容器里安装好，提交容器到镜像，在以新的镜像重新运行以上俩个容器）。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@e6d15d1d5dc6:/<span class="comment"># apt-get update</span></span><br><span class="line">Get:<span class="number">1</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal InRelease [<span class="number">265</span> <span class="type">kB</span>]</span><br><span class="line">...                  </span><br><span class="line">Get:<span class="number">22</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal<span class="literal">-proposed</span>/restricted amd64 Packages [<span class="number">257</span> <span class="type">kB</span>]</span><br><span class="line">Fetched <span class="number">24.2</span> MB <span class="keyword">in</span> <span class="number">1</span>min <span class="number">27</span>s (<span class="number">279</span> kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">root@e6d15d1d5dc6:/<span class="comment"># apt-get install iputils-ping</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">...</span><br><span class="line">debconf: unable to initialize frontend: Readline</span><br><span class="line">debconf: (Can<span class="string">&#x27;t locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.34.0 /usr/local/share/perl/5.34.0 /usr/lib/x86_64-linux-gnu/perl5/5.34 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl-base /usr/lib/x86_64-linux-gnu/perl/5.34 /usr/share/perl/5.34 /usr/local/lib/site_perl) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)</span></span><br><span class="line"><span class="string">debconf: falling back to frontend: Teletype</span></span><br><span class="line"><span class="string">Setting up iputils-ping (3:20190709-3) ...</span></span><br><span class="line"><span class="string">root@e6d15d1d5dc6:/# </span></span><br></pre></td></tr></table></figure>
<p>在 test1 容器输入以下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker exec -it test1 /bin/bash</span></span><br><span class="line">root@e6d15d1d5dc6:/<span class="comment"># ping test2</span></span><br><span class="line">PING test2 (<span class="number">172.18</span>.<span class="number">0.3</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from test2.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.3</span>): icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.134</span> ms</span><br><span class="line"><span class="number">64</span> bytes from test2.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.3</span>): icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.116</span> ms</span><br><span class="line"><span class="number">64</span> bytes from test2.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.3</span>): icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">0.065</span> ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>同理在 test2 容器也会成功连接到:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker exec -it test2 /bin/bash</span></span><br><span class="line">root@fa1f782105ef:/<span class="comment"># ping test1</span></span><br><span class="line">PING test1 (<span class="number">172.18</span>.<span class="number">0.2</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from test1.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.2</span>): icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.065</span> ms</span><br><span class="line"><span class="number">64</span> bytes from test1.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.2</span>): icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.084</span> ms</span><br><span class="line"><span class="number">64</span> bytes from test1.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.2</span>): icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">0.121</span> ms</span><br><span class="line"><span class="number">64</span> bytes from test1.<span class="built_in">test-net</span> (<span class="number">172.18</span>.<span class="number">0.2</span>): icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">0.070</span> ms</span><br></pre></td></tr></table></figure>
<p>这样，test1 容器和 test2 容器建立了互联关系。</p>
<p>如果有多个容器之间需要互相连接，推荐使用 Docker Compose，后面会介绍。</p>
<h3 id="4-3-配置-DNS"><a href="#4-3-配置-DNS" class="headerlink" title="4.3 配置 DNS"></a>4.3 配置 DNS</h3><p>可以在宿主机的 <code>/etc/docker/daemon.json</code> 文件中增加以下内容来设置全部容器的 DNS：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dns&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;114.114.114.114&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;8.8.8.8&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>设置后，启动容器的 DNS 会自动配置为 114.114.114.114 和 8.8.8.8。</p>
<p>配置完，需要重启 docker 才能生效。</p>
<p>查看容器的 DNS 是否生效可以使用以下命令，它会输出容器的 DNS 信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -it --rm  ubuntu  cat etc/resolv.conf</span></span><br><span class="line">nameserver <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">nameserver <span class="number">114.114</span>.<span class="number">114.114</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>手动指定容器的配置</strong></p>
<p>如果只想在指定的容器设置 DNS，则可以使用以下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -it --rm -h host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu</span></span><br><span class="line">root@host_ubuntu:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><p><strong><code>--rm</code></strong>：容器退出时自动清理容器内部的文件系统。</p>
</li>
<li><p><strong><code>-h HOSTNAME</code> 或者 <code>--hostname=HOSTNAME</code></strong>： 设定容器的主机名，它会被写到容器内的 <code>/etc/hostname</code> 和 <code>/etc/hosts</code>。</p>
</li>
<li><p><strong><code>--dns=IP_ADDRESS</code></strong>： 添加 DNS 服务器到容器的 <code>/etc/resolv.conf</code>中，让容器用这个服务器来解析所有不在 <code>/etc/hosts</code> 中的主机名。</p>
</li>
<li><p><strong><code>--dns-search=DOMAIN</code></strong>： 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker run -it --rm -h host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu</span></span><br><span class="line">root@host_ubuntu:/<span class="comment"># cat /etc/hostname</span></span><br><span class="line">host_ubuntu</span><br><span class="line">root@host_ubuntu:/<span class="comment"># cat  /etc/hosts</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>	localhost</span><br><span class="line">::<span class="number">1</span>	localhost ip6<span class="literal">-localhost</span> ip6<span class="literal">-loopback</span></span><br><span class="line">fe00::<span class="number">0</span>	ip6<span class="literal">-localnet</span></span><br><span class="line">ff00::<span class="number">0</span>	ip6<span class="literal">-mcastprefix</span></span><br><span class="line">ff02::<span class="number">1</span>	ip6<span class="literal">-allnodes</span></span><br><span class="line">ff02::<span class="number">2</span>	ip6<span class="literal">-allrouters</span></span><br><span class="line"><span class="number">172.17</span>.<span class="number">0.7</span>	host_ubuntu</span><br><span class="line">root@host_ubuntu:/<span class="comment"># cat /etc/resolv.conf</span></span><br><span class="line">search test.com</span><br><span class="line">nameserver <span class="number">114.114</span>.<span class="number">114.114</span></span><br><span class="line">root@host_ubuntu:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>如果在容器启动时没有指定 <code>--dns</code> 和 <code>--dns-search</code>，Docker 会默认用宿主主机上的 <code>/etc/resolv.conf</code> 来配置容器的 DNS。</p>
<h2 id="5-Docker仓库管理"><a href="#5-Docker仓库管理" class="headerlink" title="5. Docker仓库管理"></a>5. Docker仓库管理</h2><p>仓库（Repository）是集中存放镜像的地方。以下介绍一下 <a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a>。当然不止 docker hub，只是远程的服务商不一样，操作都是一样的。</p>
<h3 id="5-1-Docker-Hub"><a href="#5-1-Docker-Hub" class="headerlink" title="5.1 Docker Hub"></a>5.1 Docker Hub</h3><p>目前 Docker 官方维护了一个公共仓库 <a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a>。</p>
<p>大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。</p>
<h3 id="5-2-注册"><a href="#5-2-注册" class="headerlink" title="5.2 注册"></a>5.2 注册</h3><p>在 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a> 免费注册一个 Docker 账号。</p>
<h3 id="5-3-登录和退出"><a href="#5-3-登录和退出" class="headerlink" title="5.3 登录和退出"></a>5.3 登录和退出</h3><p>登录需要输入用户名和密码，登录成功后，我们就可以从 docker hub 上拉取自己账号下的全部镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker login</span></span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. <span class="keyword">If</span> you don<span class="string">&#x27;t have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username: kungs</span></span><br><span class="line"><span class="string">Password: </span></span><br><span class="line"><span class="string">Error response from daemon: Get &quot;https://registry-1.docker.io/v2/&quot;: unauthorized: incorrect username or password</span></span><br><span class="line"><span class="string">[root@localhost DDocker]# docker login</span></span><br><span class="line"><span class="string">Login with your Docker ID to push and pull images from Docker Hub. If you don&#x27;</span>t have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="line">Username: kungs</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/<span class="comment">#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>退出 docker hub 可以使用以下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker logout</span></span><br><span class="line">Removing login credentials <span class="keyword">for</span> https://index.docker.io/v1/</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="5-4-拉取镜像"><a href="#5-4-拉取镜像" class="headerlink" title="5.4 拉取镜像"></a>5.4 拉取镜像</h3><p>可以通过 <code>docker search</code> 命令来查找官方仓库中的镜像，并利用 <code>docker pull</code> 命令来将它下载到本地。</p>
<p>以 ubuntu 为关键词进行搜索：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker search ubuntu</span></span><br><span class="line">NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">ubuntu                           Ubuntu is a Debian<span class="literal">-based</span> Linux operating sys…   <span class="number">14855</span>     [<span class="type">OK</span>]       </span><br><span class="line">websphere<span class="literal">-liberty</span>                WebSphere Liberty multi<span class="literal">-architecture</span> images …   <span class="number">288</span>       [<span class="type">OK</span>]       </span><br><span class="line">ubuntu<span class="literal">-upstart</span>                   DEPRECATED, as is Upstart (find other proces…   <span class="number">112</span>       [<span class="type">OK</span>]       </span><br><span class="line">neurodebian                      NeuroDebian provides neuroscience research s…   <span class="number">92</span>        [<span class="type">OK</span>]       </span><br><span class="line">ubuntu/nginx                     Nginx, a high<span class="literal">-performance</span> reverse proxy &amp; we…   <span class="number">57</span>                   </span><br><span class="line"><span class="built_in">open-liberty</span>                     Open Liberty multi<span class="literal">-architecture</span> images based…   <span class="number">54</span>        [<span class="type">OK</span>]       </span><br><span class="line">ubuntu<span class="literal">-debootstrap</span>               DEPRECATED; use <span class="string">&quot;ubuntu&quot;</span> instead                <span class="number">46</span>        [<span class="type">OK</span>]       </span><br><span class="line">ubuntu/apache2                   Apache, a secure &amp; extensible <span class="built_in">open-source</span> HT…   <span class="number">40</span>                   </span><br><span class="line">ubuntu/mysql                     MySQL open source fast, stable, multi<span class="literal">-thread</span>…   <span class="number">36</span>                   </span><br><span class="line">kasmweb/ubuntu<span class="literal">-bionic-desktop</span>    Ubuntu productivity desktop <span class="keyword">for</span> Kasm Workspa…   <span class="number">31</span>                   </span><br><span class="line">ubuntu/squid                     Squid is a caching proxy <span class="keyword">for</span> the Web. Long<span class="literal">-t</span>…   <span class="number">30</span>                   </span><br><span class="line">ubuntu/prometheus                Prometheus is a systems and service monitori…   <span class="number">28</span>                   </span><br><span class="line">ubuntu/bind9                     BIND <span class="number">9</span> is a very flexible, full<span class="literal">-featured</span> DNS…   <span class="number">25</span>                   </span><br><span class="line">ubuntu/postgres                  PostgreSQL is an open source object<span class="literal">-relation</span>…   <span class="number">19</span>                   </span><br><span class="line">ubuntu/redis                     Redis, an open source key<span class="literal">-value</span> store. Long-…   <span class="number">11</span>                   </span><br><span class="line">ubuntu/kafka                     Apache Kafka, a distributed event streaming …   <span class="number">11</span>                   </span><br><span class="line">ubuntu/grafana                   Grafana, a feature rich metrics dashboard &amp; …   <span class="number">6</span>                    </span><br><span class="line">ubuntu/prometheus<span class="literal">-alertmanager</span>   Alertmanager handles client alerts from Prom…   <span class="number">6</span>                    </span><br><span class="line">ubuntu/memcached                 Memcached, <span class="keyword">in</span><span class="literal">-memory</span> keyvalue store <span class="keyword">for</span> smal…   <span class="number">5</span>                    </span><br><span class="line">ubuntu/zookeeper                 ZooKeeper maintains configuration informatio…   <span class="number">5</span>                    </span><br><span class="line">ubuntu/telegraf                  Telegraf collects, processes, aggregates &amp; w…   <span class="number">4</span>                    </span><br><span class="line">ubuntu/cortex                    Cortex provides storage <span class="keyword">for</span> Prometheus. Long…   <span class="number">3</span>                    </span><br><span class="line">ubuntu/cassandra                 Cassandra, an open source NoSQL distributed …   <span class="number">2</span>                    </span><br><span class="line">ubuntu/dotnet<span class="literal">-deps</span>               Chiselled Ubuntu <span class="keyword">for</span> self<span class="literal">-contained</span> .NET &amp; A…   <span class="number">2</span>                    </span><br><span class="line">ubuntu/loki                      Grafana Loki, a log aggregation system like …   <span class="number">0</span>                    </span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>使用 <code>docker pull</code> 将官方 ubuntu 镜像下载到本地：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker pull ubuntu</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line">Digest: sha256:<span class="number">34</span>fea4f31bf187bc915536831fd0afc9d214755bf700b5cdb1336c82516d154e</span><br><span class="line">Status: Image is up to date <span class="keyword">for</span> ubuntu:latest</span><br><span class="line">docker.io/library/ubuntu:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="5-5-推送镜像"><a href="#5-5-推送镜像" class="headerlink" title="5.5 推送镜像"></a>5.5 推送镜像</h3><p>用户登录后，可以通过 docker push 命令将自己的镜像推送到 Docker Hub。</p>
<p>以下命令中的 <code>kungs</code> 请替换为你的 Docker 账号用户名。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker tag ubuntu:18.04 kungs/ubuntu:18.04</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">ubuntu            latest    df5de72bdb3b   <span class="number">4</span> weeks ago   <span class="number">77.8</span>MB</span><br><span class="line">kungs/ubuntu      <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">4</span> weeks ago   <span class="number">63.1</span>MB</span><br><span class="line">ubuntu            <span class="number">18.04</span>     <span class="number">8</span>d5df41c547b   <span class="number">4</span> weeks ago   <span class="number">63.1</span>MB</span><br><span class="line">training/webapp   latest    <span class="number">6</span>fae60ef3446   <span class="number">7</span> years ago   <span class="number">349</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker push kungs/ubuntu:18.04</span></span><br><span class="line">The push refers to repository [<span class="type">docker.io</span>/<span class="type">kungs</span>/<span class="type">ubuntu</span>]</span><br><span class="line">e722d396f503: Mounted from library/ubuntu </span><br><span class="line"><span class="number">18.04</span>: digest: sha256:e4771b7160543c6e43968b4e9795be9ddcad9d573edd7cd7aebd3ce61326fc7a size: <span class="number">529</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># docker search kungs/ubuntu</span></span><br><span class="line">NAME      DESCRIPTION   STARS     OFFICIAL   AUTOMATED</span><br><span class="line"> kungs/ubuntu</span><br></pre></td></tr></table></figure>
<h2 id="6-Docker-Dockerfile"><a href="#6-Docker-Dockerfile" class="headerlink" title="6. Docker Dockerfile"></a>6. Docker Dockerfile</h2><h3 id="6-1-什么是-Dockerfile？"><a href="#6-1-什么是-Dockerfile？" class="headerlink" title="6.1 什么是 Dockerfile？"></a>6.1 什么是 Dockerfile？</h3><p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<h3 id="6-2-使用-Dockerfile-定制镜像"><a href="#6-2-使用-Dockerfile-定制镜像" class="headerlink" title="6.2 使用 Dockerfile 定制镜像"></a>6.2 使用 Dockerfile 定制镜像</h3><p>这里仅讲解如何运行 Dockerfile 文件来定制一个镜像，具体 Dockerfile 文件内指令详解，将在下一节中介绍，这里你只要知道构建的流程即可。</p>
<ol>
<li><p><strong>下面以定制一个 nginx 镜像（构建好的镜像内会有一个 /usr/share/nginx/html/index.html 文件）</strong></p>
<p>在一个空目录下，新建一个名为 Dockerfile 文件，并在文件内添加以下内容：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cd /root/yanpenggong/DEMO/DockerTest/docker/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">docker</span>]<span class="comment"># mkdir Dockerfile</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">docker</span>]<span class="comment"># cd Dockerfile/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># pwd</span></span><br><span class="line">/root/yanpenggong/DEMO/DockerTest/docker/Dockerfile</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># vi Dockerfile</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># cat Dockerfile </span></span><br><span class="line">FROM nginx</span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&quot;这是一个本地构建的nginx镜像&quot;</span> &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FROM 和 RUN 指令的作用</strong></p>
<ul>
<li><p><strong>FROM</strong>：定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</p>
</li>
<li><p><strong>RUN</strong>：用于执行后面跟着的命令行命令。有以下俩种格式：</p>
<ul>
<li><p>shell 格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;命令行命令&gt;</span></span><br><span class="line"><span class="comment"># &lt;命令行命令&gt; 等同于 在终端操作的 shell 命令.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>exec 格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;可执行文件&quot;</span>, <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span>]</span></span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="comment"># RUN [&quot;./test.py&quot;, &quot;dev&quot;, &quot;offline&quot;] 等价于 RUN ./test.py def offline</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大。例如：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install wget</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> tar -xvf redis.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>以上执行会创建 3 层镜像。可简化为以下格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install wget \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; tar -xvf redis.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>如上，以 <code>&amp;&amp;</code> 符号连接命令，这样执行后，只会创建 1 层镜像。</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="6-3-开始构建镜像"><a href="#6-3-开始构建镜像" class="headerlink" title="6.3 开始构建镜像"></a>6.3 开始构建镜像</h3><p>在 Dockerfile 文件的存放目录下，执行构建动作。</p>
<p>以下示例，通过目录下的 Dockerfile 构建一个<code>nginx:v3</code>（镜像名称:镜像标签）。</p>
<p><strong>注</strong>：最后的 <code>.</code> 代表本次执行的上下文路径。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># docker build -t nginx:v1 .</span></span><br><span class="line">Sending build context to Docker daemon  <span class="number">2.048</span>kB</span><br><span class="line">Step <span class="number">1</span>/<span class="number">2</span> : FROM nginx</span><br><span class="line"> <span class="literal">---</span>&gt; <span class="number">3964</span>ce7b8458</span><br><span class="line">Step <span class="number">2</span>/<span class="number">2</span> : RUN <span class="built_in">echo</span> <span class="string">&quot;这是一个本地构建的nginx镜像&quot;</span> &gt; /usr/share/nginx/html/index.html</span><br><span class="line"> <span class="literal">---</span>&gt; Running <span class="keyword">in</span> <span class="number">37</span>afd3da723f</span><br><span class="line">Removing intermediate container <span class="number">37</span>afd3da723f</span><br><span class="line"> <span class="literal">---</span>&gt; bc6855014a02</span><br><span class="line">Successfully built bc6855014a02</span><br><span class="line">Successfully tagged nginx:v1</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">nginx             v1        bc6855014a02   About a minute ago   <span class="number">142</span>MB</span><br><span class="line">kungs1            v2        <span class="number">5707</span>f6758e8f   <span class="number">2</span> days ago           <span class="number">118</span>MB</span><br><span class="line">kungs1            v1        <span class="number">2</span>d82fcabb70f   <span class="number">2</span> days ago           <span class="number">77.8</span>MB</span><br><span class="line">nginx             latest    <span class="number">3964</span>ce7b8458   <span class="number">5</span> days ago           <span class="number">142</span>MB</span><br><span class="line">ubuntu            latest    <span class="number">6</span>b7dfa7e8fdb   <span class="number">10</span> days ago          <span class="number">77.8</span>MB</span><br><span class="line">httpd             latest    <span class="number">157</span>dcdf23d6c   <span class="number">12</span> days ago          <span class="number">145</span>MB</span><br><span class="line">training/webapp   latest    <span class="number">6</span>fae60ef3446   <span class="number">7</span> years ago          <span class="number">349</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>以上显示，说明已经构建成功。</p>
<h3 id="6-4-上下文路径"><a href="#6-4-上下文路径" class="headerlink" title="6.4 上下文路径"></a>6.4 上下文路径</h3><p>上面有提到指令最后一个 <strong>.</strong> 是上下文路径，那么什么是上下文路径呢？</p>
<p>上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</p>
<p><strong>解析</strong>：由于 docker 的运行模式是 C/S。我们本机是 C，docker 引擎是 S。实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</p>
<p>如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</p>
<p><strong>注意</strong>：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p>
<h3 id="6-5-指令详解"><a href="#6-5-指令详解" class="headerlink" title="6.5 指令详解"></a>6.5 指令详解</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>FROM</td>
<td>建镜像基于哪个镜像</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>镜像维护者姓名或邮箱地址</td>
</tr>
<tr>
<td>RUN</td>
<td>构建镜像时运行的指令</td>
</tr>
<tr>
<td>CMD</td>
<td>运行容器时执行的shell环境</td>
</tr>
<tr>
<td>VOLUME</td>
<td>指定容器挂载点到宿主机自动生成的目录或其他容器</td>
</tr>
<tr>
<td>USER</td>
<td>为RUN、CMD、和 ENTRYPOINT 执行命令指定运行用户</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>为 RUN、CMD、ENTRYPOINT、COPY 和 ADD 设置工作目录，就是切换目录</td>
</tr>
<tr>
<td>HEALTHCHECH</td>
<td>健康检查</td>
</tr>
<tr>
<td>ARG</td>
<td>构建时指定的一些参数</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>声明容器的服务端口（仅仅是声明）</td>
</tr>
<tr>
<td>ENV</td>
<td>设置容器环境变量</td>
</tr>
<tr>
<td>ADD</td>
<td>拷贝文件或目录到容器中，如果是URL或压缩包便会自动下载或自动解压</td>
</tr>
<tr>
<td>COPY</td>
<td>拷贝文件或目录到容器中，跟ADD类似，但不具备自动下载或解压的功能</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>运行容器时执行的shell命令</td>
</tr>
</tbody>
</table>
</div>
<h4 id="6-5-1-COPY"><a href="#6-5-1-COPY" class="headerlink" title="6.5.1 COPY"></a>6.5.1 COPY</h4><p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] &lt;源路径1&gt;...  &lt;目标路径&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;源路径1&gt;&quot;</span>,...  <span class="string">&quot;&lt;目标路径&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><p><strong><code>[--chown=:&lt;group&gt;]</code>:</strong> 可选参数，用户改变复制到容器内文件的拥有者和属组。</p>
</li>
<li><p><strong><code>&lt;源路径1&gt;</code>:</strong> 源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hom* /mydir/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>&lt;目标路径&gt;</code>:</strong> 容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p>
</li>
</ul>
<h4 id="6-5-2-ADD"><a href="#6-5-2-ADD" class="headerlink" title="6.5.2 ADD"></a>6.5.2 ADD</h4><p>ADD 指令和 COPY 的使用格类似（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p>
<ul>
<li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 <code>gzip</code>, <code>bzip2</code> 以及 <code>xz</code> 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</li>
<li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li>
</ul>
<h4 id="6-5-3-CMD"><a href="#6-5-3-CMD" class="headerlink" title="6.5.3 CMD"></a>6.5.3 CMD</h4><p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>
<ul>
<li><strong>CMD</strong> 在<code>docker run</code> 时运行。</li>
<li><strong>RUN</strong> 是在 <code>docker build</code>。</li>
</ul>
<p><strong>作用</strong>：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p>
<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> &lt;shell 命令&gt; </span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;&lt;可执行文件或命令&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...] </span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]  <span class="comment"># 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span></span></span><br></pre></td></tr></table></figure>
<p>推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</p>
<h4 id="6-5-4-ENTRYPOINT"><a href="#6-5-4-ENTRYPOINT" class="headerlink" title="6.5.4 ENTRYPOINT"></a>6.5.4 ENTRYPOINT</h4><p>类似于 CMD 指令，但其不会被 <code>docker run</code> 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>
<p>但是, 如果运行 <code>docker run</code> 时使用了<code>--entrypoint</code> 选项，将覆盖 ENTRYPOINT 指令指定的程序。</p>
<p><strong>优点</strong>：在执行 <code>docker run</code> 的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;&lt;executeable&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]</span></span><br></pre></td></tr></table></figure>
<p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p>
<p>示例：</p>
<p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-c&quot;</span>] <span class="comment"># 定参</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="comment"># 变参 </span></span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>不传参运行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># docker run  nginx:test</span></span><br></pre></td></tr></table></figure>
<p>容器内会默认运行以下命令，启动主进程。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx <span class="literal">-c</span> /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>传参运行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># docker run  nginx:test -c /etc/nginx/new.conf</span></span><br></pre></td></tr></table></figure>
<p>容器内会默认运行以下命令，启动主进程(/etc/nginx/new.conf:假设容器内已有此文件)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx <span class="literal">-c</span> /etc/nginx/new.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="6-5-5-ENV"><a href="#6-5-5-ENV" class="headerlink" title="6.5.5 ENV"></a>6.5.5 ENV</h4><p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure>
<p>以下示例设置 <code>NODE_VERSION = 7.2.0</code> ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> NODE_VERSION <span class="number">7.2</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/node-v<span class="variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="6-5-6-ARG"><a href="#6-5-6-ARG" class="headerlink" title="6.5.6 ARG"></a>6.5.6 ARG</h4><p>构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 <code>docker build</code> 的过程中有效，构建好的镜像内不存在此环境变量。</p>
<p>构建命令 <code>docker build</code> 中可以用 <code>--build-arg &lt;参数名&gt;=&lt;值&gt;</code> 来覆盖。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;参数名&gt;[=&lt;默认值&gt;]</span><br></pre></td></tr></table></figure>
<h4 id="6-5-7-VOLUME"><a href="#6-5-7-VOLUME" class="headerlink" title="6.5.7 VOLUME"></a>6.5.7 VOLUME</h4><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p>
<p>作用：</p>
<ul>
<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>
<li>避免容器不断变大。</li>
</ul>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</span><br><span class="line">VOLUME &lt;路径&gt;</span><br></pre></td></tr></table></figure>
<p>在启动容器 <code>docker run</code> 的时候，我们可以通过 <code>-v</code> 参数修改挂载点。</p>
<h4 id="6-5-8-EXPOSE"><a href="#6-5-8-EXPOSE" class="headerlink" title="6.5.8 EXPOSE"></a>6.5.8 EXPOSE</h4><p>仅仅只是声明端口。</p>
<p>作用：</p>
<ul>
<li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</li>
<li>在运行时使用随机端口映射时，也就是 <code>docker run -P</code> 时，会自动随机映射 <code>EXPOSE</code> 的端口。</li>
</ul>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;端口<span class="number">1</span>&gt; [&lt;端口<span class="number">2</span>&gt;...]</span><br></pre></td></tr></table></figure>
<h4 id="6-5-9-WORKDIR"><a href="#6-5-9-WORKDIR" class="headerlink" title="6.5.9 WORKDIR"></a>6.5.9 WORKDIR</h4><p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p>
<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> &lt;工作目录路径&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="6-5-10-USER"><a href="#6-5-10-USER" class="headerlink" title="6.5.10 USER"></a>6.5.10 USER</h4><p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> &lt;用户名&gt;[:&lt;用户组&gt;]</span><br></pre></td></tr></table></figure>
<h4 id="6-5-11-HEALTHCHECK"><a href="#6-5-11-HEALTHCHECK" class="headerlink" title="6.5.11 HEALTHCHECK"></a>6.5.11 HEALTHCHECK</h4><p>用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span></span><br></pre></td></tr></table></figure>
<h4 id="6-5-12-ONBUILD"><a href="#6-5-12-ONBUILD" class="headerlink" title="6.5.12 ONBUILD"></a>6.5.12 ONBUILD</h4><p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> &lt;其它指令&gt;</span><br></pre></td></tr></table></figure>
<h4 id="6-5-13-LABEL"><a href="#6-5-13-LABEL" class="headerlink" title="6.5.13 LABEL"></a>6.5.13 LABEL</h4><p>LABEL 指令用来给镜像添加一些元数据（metadata），以键值对的形式，语法格式如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure>
<p>比如我们可以添加镜像的作者：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> org.opencontainers.image.authors=<span class="string">&quot;yanpenggong&quot;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="7-Docker-Compose"><a href="#7-Docker-Compose" class="headerlink" title="7. Docker Compose"></a>7. Docker Compose</h2><h3 id="7-0-YAML-入门教程"><a href="#7-0-YAML-入门教程" class="headerlink" title="7.0 YAML 入门教程"></a>7.0 YAML 入门教程</h3><p>YAML 是 “YAML Ain’t a Markup Language”（YAML 不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）。</p>
<p>YAML 的语法和其他高级语言类似，并且可以简单表达清单、散列表，标量等数据形态。它使用空白符号缩进和大量依赖外观的特色，特别适合用来表达或编辑数据结构、各种配置文件、倾印调试内容、文件大纲（例如：许多电子邮件标题格式和YAML非常接近）。</p>
<p>YAML 的配置文件后缀为 <strong>.yml</strong>，如：<strong>yanpenggong.yml</strong> 。</p>
<h4 id="7-0-1-基本语法"><a href="#7-0-1-基本语法" class="headerlink" title="7.0.1 基本语法"></a>7.0.1 基本语法</h4><ul>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，只允许空格</li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li><code>#</code>表示注释</li>
</ul>
<h4 id="7-0-2-数据类型"><a href="#7-0-2-数据类型" class="headerlink" title="7.0.2 数据类型"></a>7.0.2 数据类型</h4><p>YAML 支持以下几种数据类型：</p>
<ul>
<li><strong>对象</strong>：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）</li>
<li><strong>数组</strong>：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li>
<li><strong>纯量（scalars）</strong>：单个的、不可再分的值</li>
</ul>
<h5 id="7-0-2-1-YAML-对象"><a href="#7-0-2-1-YAML-对象" class="headerlink" title="7.0.2.1 YAML 对象"></a>7.0.2.1 YAML 对象</h5><p>对象键值对使用冒号结构表示 <strong>key: value</strong>，冒号后面要加一个空格。</p>
<p>也可以使用 <strong>key:{key1: value1, key2: value2, …}</strong>。</p>
<p>还可以使用缩进表示层级关系；</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">key:</span> </span><br><span class="line">    <span class="attr">child-key:</span> <span class="string">value</span></span><br><span class="line">    <span class="attr">child-key2:</span> <span class="string">value2</span></span><br></pre></td></tr></table></figure>
<p>较为复杂的对象格式，可以使用<strong><code>问号加一个空格</code></strong>代表一个复杂的 key，配合<strong><code>一个冒号加一个空格</code></strong>代表一个 value：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">complexkey1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">complexkey2</span></span><br><span class="line"><span class="string">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">complexvalue1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">complexvalue2</span></span><br></pre></td></tr></table></figure>
<p>意思即对象的属性是一个数组 [complexkey1,complexkey2]，对应的值也是一个数组 [complexvalue1,complexvalue2]</p>
<h5 id="7-0-2-2-YAML-数组"><a href="#7-0-2-2-YAML-数组" class="headerlink" title="7.0.2.2 YAML 数组"></a>7.0.2.2 YAML 数组</h5><p>以 <strong>-</strong> 开头的行表示构成一个数组：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">A</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">B</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">C</span></span><br></pre></td></tr></table></figure>
<p>YAML 支持多维数组，可以使用行内表示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">key:</span> [<span class="string">value1</span>, <span class="string">value2</span>, <span class="string">...</span>]</span><br></pre></td></tr></table></figure>
<p>数据结构的子成员是一个数组，则可以在该项下面缩进一个空格。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">A</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">B</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">C</span></span><br></pre></td></tr></table></figure>
<p>一个相对复杂的例子：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">companies:</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">        <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">company1</span></span><br><span class="line">        <span class="attr">price:</span> <span class="string">200W</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">        <span class="attr">id:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">company2</span></span><br><span class="line">        <span class="attr">price:</span> <span class="string">500W</span></span><br></pre></td></tr></table></figure>
<p>意思是 companies 属性是一个数组，每一个数组元素又是由 id、name、price 三个属性构成。</p>
<p>数组也可以使用流式(flow)的方式表示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">companies:</span> [&#123;<span class="attr">id:</span> <span class="number">1</span>,<span class="attr">name:</span> <span class="string">company1</span>,<span class="attr">price:</span> <span class="string">200W</span>&#125;,&#123;<span class="attr">id:</span> <span class="number">2</span>,<span class="attr">name:</span> <span class="string">company2</span>,<span class="attr">price:</span> <span class="string">500W</span>&#125;]</span><br></pre></td></tr></table></figure>
<h5 id="7-0-2-3-复合结构"><a href="#7-0-2-3-复合结构" class="headerlink" title="7.0.2.3 复合结构"></a>7.0.2.3 复合结构</h5><p>数组和对象可以构成复合结构，例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">languages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ruby</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Perl</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Python</span> </span><br><span class="line"><span class="attr">websites:</span></span><br><span class="line">  <span class="attr">YAML:</span> <span class="string">yaml.org</span> </span><br><span class="line">  <span class="attr">Ruby:</span> <span class="string">ruby-lang.org</span> </span><br><span class="line">  <span class="attr">Python:</span> <span class="string">python.org</span> </span><br><span class="line">  <span class="attr">Perl:</span> <span class="string">use.perl.org</span></span><br></pre></td></tr></table></figure>
<p>转换为 json 为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">  languages<span class="punctuation">:</span> <span class="punctuation">[</span> &#x27;Ruby&#x27;<span class="punctuation">,</span> &#x27;Perl&#x27;<span class="punctuation">,</span> &#x27;Python&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  websites<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    YAML<span class="punctuation">:</span> &#x27;yaml.org&#x27;<span class="punctuation">,</span></span><br><span class="line">    Ruby<span class="punctuation">:</span> &#x27;ruby-lang.org&#x27;<span class="punctuation">,</span></span><br><span class="line">    Python<span class="punctuation">:</span> &#x27;python.org&#x27;<span class="punctuation">,</span></span><br><span class="line">    Perl<span class="punctuation">:</span> &#x27;use.perl.org&#x27; </span><br><span class="line">  <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="7-0-2-4-纯量"><a href="#7-0-2-4-纯量" class="headerlink" title="7.0.2.4 纯量"></a>7.0.2.4 纯量</h5><p>纯量是最基本的，不可再分的值，包括：</p>
<ul>
<li>字符串</li>
<li>布尔值</li>
<li>整数</li>
<li>浮点数</li>
<li>Null</li>
<li>时间</li>
<li>日期</li>
</ul>
<p>使用一个例子来快速了解纯量的基本使用：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boolean:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="literal">TRUE</span>  <span class="comment">#true,True都可以</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">FALSE</span>  <span class="comment">#false，False都可以</span></span><br><span class="line"><span class="attr">float:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3.14</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">6.8523015e+5</span>  <span class="comment">#可以使用科学计数法</span></span><br><span class="line"><span class="attr">int:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">123</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">0b1010_0111_0100_1010_1110</span>    <span class="comment">#二进制表示</span></span><br><span class="line"><span class="attr">null:</span></span><br><span class="line">    <span class="attr">nodeName:</span> <span class="string">&#x27;node&#x27;</span></span><br><span class="line">    <span class="attr">parent:</span> <span class="string">~</span>  <span class="comment">#使用~表示null</span></span><br><span class="line"><span class="attr">string:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">哈哈</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;Hello world&#x27;</span>  <span class="comment">#可以使用双引号或者单引号包裹特殊字符</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">newline</span></span><br><span class="line">      <span class="string">newline2</span>    <span class="comment">#字符串可以拆成多行，每一行会被转化成一个空格</span></span><br><span class="line"><span class="attr">date:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2022-08-31</span>    <span class="comment">#日期必须使用ISO 8601格式，即yyyy-MM-dd</span></span><br><span class="line"><span class="attr">datetime:</span> </span><br><span class="line">    <span class="bullet">-</span>  <span class="number">2022-08-31T10:50:21+08:00</span>    <span class="comment">#时间使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区</span></span><br></pre></td></tr></table></figure>
<h5 id="7-0-2-5-引用"><a href="#7-0-2-5-引用" class="headerlink" title="7.0.2.5 引用"></a>7.0.2.5 引用</h5><ul>
<li><code>&amp;</code> 锚点和 <code>*</code> 别名，可以用来引用:</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">defaults: &amp;defaults</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  &lt;&lt;: *defaults</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  &lt;&lt;: *defaults</span><br></pre></td></tr></table></figure>
<p>相当于:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">defaults:</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br></pre></td></tr></table></figure>
<p><strong>&amp;</strong> 用来建立锚点（defaults），<strong>&lt;&lt;</strong> 表示合并到当前数据，<strong>*</strong> 用来引用锚点。</p>
<p>下面是另一个例子:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- &amp;showell Steve </span><br><span class="line">- Clark </span><br><span class="line">- Brian </span><br><span class="line">- Oren </span><br><span class="line">- *showell </span><br></pre></td></tr></table></figure>
<p>转为 JavaScript 代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="string">&#x27;Steve&#x27;</span>, <span class="string">&#x27;Clark&#x27;</span>, <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;Oren&#x27;</span>, <span class="string">&#x27;Steve&#x27;</span> ]</span><br></pre></td></tr></table></figure>
<h3 id="7-1-Compose-简介"><a href="#7-1-Compose-简介" class="headerlink" title="7.1 Compose 简介"></a>7.1 Compose 简介</h3><p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 <code>YML</code> 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 <code>YML</code> 文件配置中创建并启动所有服务。</p>
<p>Compose 使用的三个步骤：</p>
<ul>
<li>使用 Dockerfile 定义应用程序的环境。</li>
<li>使用 <code>docker-compose.yml</code> 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。</li>
<li>最后，执行 <code>docker-compose up</code> 命令来启动并运行整个应用程序。</li>
</ul>
<p><code>docker-compose.yml</code> 的配置案例如下（配置参数参考下文）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yml 配置实例</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;1.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">	<span class="attr">web:</span></span><br><span class="line">		<span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">		<span class="attr">ports:</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">		<span class="attr">volumes:</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">.:</span> <span class="string">/code</span></span><br><span class="line">			<span class="bullet">-</span> <span class="attr">logvolume01:</span> <span class="string">/var/log</span></span><br><span class="line">		<span class="attr">links:</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">	<span class="attr">redis:</span></span><br><span class="line">		<span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">	<span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-Compose-安装"><a href="#7-2-Compose-安装" class="headerlink" title="7.2 Compose 安装"></a>7.2 Compose 安装</h3><p>Linux 上可以从 Github 上下载它的二进制包来使用，最新发行的版本地址：<a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases。">https://github.com/docker/compose/releases。</a></p>
<p>运行以下命令以下载 Docker Compose 的当前稳定版本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># sudo curl -SL &quot;https://github.com/docker/compose/releases/download/v2.10.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>   <span class="number">425</span>  <span class="number">100</span>   <span class="number">425</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">479</span>      <span class="number">0</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span>   <span class="number">479</span></span><br><span class="line"><span class="number">100</span> <span class="number">24.5</span>M  <span class="number">100</span> <span class="number">24.5</span>M    <span class="number">0</span>     <span class="number">0</span>  <span class="number">7220</span>k      <span class="number">0</span>  <span class="number">0</span>:<span class="number">00</span>:<span class="number">03</span>  <span class="number">0</span>:<span class="number">00</span>:<span class="number">03</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="number">13.3</span>M</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>要安装其他版本的 Compose，请替换 v2.14.0。</p>
<blockquote>
<p>Docker Compose 存放在 GitHub，不太稳定。</p>
<p>也可以通过执行下面的命令，高速安装 Docker Compose。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># curl -SL https://github.com/docker/compose/releases/download/v2.14.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span></span><br><span class="line">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                              Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2</span> <span class="number">42.8</span>M    <span class="number">2</span>  <span class="number">944</span>k    <span class="number">0</span>     <span class="number">0</span>  <span class="number">11860</span>      <span class="number">0</span>  <span class="number">1</span>:<span class="number">03</span>:<span class="number">07</span>  <span class="number">0</span>:<span class="number">01</span>:<span class="number">21</span>  <span class="number">1</span>:<span class="number">01</span>:<span class="number">46</span>  <span class="number">8238</span></span><br><span class="line"><span class="number">100</span> <span class="number">42.8</span>M  <span class="number">100</span> <span class="number">42.8</span>M    <span class="number">0</span>     <span class="number">0</span>    <span class="number">98</span>k      <span class="number">0</span>  <span class="number">0</span>:<span class="number">07</span>:<span class="number">27</span>  <span class="number">0</span>:<span class="number">07</span>:<span class="number">27</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span>  <span class="number">208</span>k</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>将可执行权限应用于二进制文件：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># sudo chmod +x /usr/local/bin/docker-compose</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>创建软链：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DDocker</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>测试是否安装成功：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># docker-compose --version</span></span><br><span class="line">Docker Compose version v2.<span class="number">14.0</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Dockerfile</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>： 对于 alpine，需要以下依赖包： <code>py-pip</code>，<code>python-dev</code>，<code>libffi-dev</code>，<code>openssl-dev</code>，<code>gcc</code>，<code>libc-dev</code>，和 <code>make</code>。</p>
<p><strong>macOS 和 windows</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Docker 桌面版和 Docker Toolbox 已经包括 Compose 和其他 Docker 应用程序，故不需要单独安装 Compose。</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="7-3-使用"><a href="#7-3-使用" class="headerlink" title="7.3 使用"></a>7.3 使用</h3><h4 id="7-3-1-准备"><a href="#7-3-1-准备" class="headerlink" title="7.3.1 准备"></a>7.3.1 准备</h4><p>创建一个测试目录：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># pwd</span></span><br><span class="line">/root/yanpenggong/DEMO/DockerTest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># mkdir composeTest</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># cd composeTest/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>在测试目录中创建一个名为 <code>app.py</code> 的文件，并复制粘贴以下内容：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composetest</span>]<span class="comment"># cat app.py </span></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">import redis</span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">&#x27;redis&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_hit_count():</span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">&#x27;hits&#x27;</span>)</span><br><span class="line">        except redis.exceptions.ConnectionError as exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                raise exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">def hello():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;</span>.format(count)</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composetest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>在此示例中，<code>redis</code> 是应用程序网络上的 <code>redis 容器</code>的主机名，该主机使用的端口为 6379。</p>
<p>在 composeTest 目录中创建另一个名为 <strong>requirements.txt</strong> 的文件，内容如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composetest</span>]<span class="comment"># cat requirements.txt </span></span><br><span class="line">flask</span><br><span class="line">redis</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composetest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="7-3-2-创建-Dockerfile-文件"><a href="#7-3-2-创建-Dockerfile-文件" class="headerlink" title="7.3.2 创建 Dockerfile 文件"></a>7.3.2 创建 Dockerfile 文件</h4><p>在 composeTest 目录中，创建一个名为 <code>Dockerfile</code> 的文件，内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost composeTest]<span class="comment"># cat Dockerfile </span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>-alpine3.<span class="number">10</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /code</span></span><br><span class="line"><span class="keyword">ENV</span> FLASK_APP=app.py \</span><br><span class="line">    FLASK_RUN_HOST=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache gcc musl-dev linux-headers</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -r requirements.txt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;flask&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">[root@localhost composeTest]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>Dockerfile 内容解释：</strong></p>
<ul>
<li><p><strong>FROM python:3.7-alpine</strong>: 从 Python 3.7 映像开始构建镜像。</p>
</li>
<li><p><strong>WORKDIR /code</strong>: 将工作目录设置为 /code。</p>
</li>
<li><p><strong>ENV：设置 flask 命令使用的环境变量。</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> FLASK_APP app.py</span><br><span class="line"><span class="keyword">ENV</span> FLASK_RUN_HOST <span class="number">0.0</span>.<span class="number">0.0</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> FLASK_APP=app.py \</span><br><span class="line">    FLASK_RUN_HOST=<span class="number">0.0</span>.<span class="number">0.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>RUN apk add —no-cache gcc musl-dev linux-headers</strong>: 安装 gcc，以便诸如 MarkupSafe 和 SQLAlchemy 之类的 Python 包可以编译加速。</p>
</li>
<li><p>```<br>COPY requirements.txt requirements.txt<br>RUN pip install -r requirements.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  复制 requirements.txt 并安装 Python 依赖项。</span><br><span class="line"></span><br><span class="line">- **COPY . .**: 将 . 项目中的当前目录复制到 `.` 镜像中的工作目录。</span><br><span class="line"></span><br><span class="line">- **CMD [&quot;flask&quot;, &quot;run&quot;]**: 容器提供默认的执行命令为：`flask run`。</span><br><span class="line"></span><br><span class="line">#### 7.3.3 创建 docker-compose.yml</span><br><span class="line"></span><br><span class="line">&gt; **端口永久开放(permanent)**</span><br><span class="line">&gt;</span><br><span class="line">&gt; ```shell</span><br><span class="line">&gt; #开端口</span><br><span class="line">&gt; firewall-cmd --get-active-zones</span><br><span class="line">&gt; firewall-cmd --zone=public --add-port=端口号/tcp --permanent</span><br><span class="line">&gt; #重启</span><br><span class="line">&gt; firewall-cmd --reload</span><br><span class="line">&gt; #检验端口是否开放</span><br><span class="line">&gt; firewall-cmd --query-port=8000/tcp</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在测试目录中创建一个名为 <code>docker-compose.yml</code> 的文件，内容如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># cat docker-compose.yml </span></span><br><span class="line"><span class="comment"># yml 配置实例</span></span><br><span class="line">version: <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8001:8001&quot;</span></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="7-3-4-使用-Compose-命令构建和运行您的应用"><a href="#7-3-4-使用-Compose-命令构建和运行您的应用" class="headerlink" title="7.3.4 使用 Compose 命令构建和运行您的应用"></a>7.3.4 使用 Compose 命令构建和运行您的应用</h4><p>在测试目录中，执行 <code>docker-compose up</code> 命令来启动应用程序：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># docker-compose up</span></span><br><span class="line">[+] Running <span class="number">2</span>/<span class="number">0</span></span><br><span class="line"> ⠿ Container compose<span class="built_in">test-redis</span><span class="literal">-1</span>  Created                                                               <span class="number">0.0</span>s</span><br><span class="line"> ⠿ Container compose<span class="built_in">test-app1</span><span class="literal">-1</span>   Created                                                               <span class="number">0.0</span>s</span><br><span class="line">Attaching to compose<span class="built_in">test-app1</span><span class="literal">-1</span>, compose<span class="built_in">test-redis</span><span class="literal">-1</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:C <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.874</span> <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:C <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.874</span> <span class="comment"># Redis version=7.0.7, bits=64, commit=00000000, modified=0, pid=1, just started</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:C <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.874</span> <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.875</span> * monotonic clock: POSIX clock_gettime</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * Running mode=standalone, port=<span class="number">6379</span>.</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> <span class="comment"># Server initialized</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> <span class="comment"># WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * Loading RDB produced by version <span class="number">7.0</span>.<span class="number">7</span></span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * RDB age <span class="number">165</span> seconds</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * RDB memory usage when created <span class="number">0.85</span> Mb</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * Done loading RDB, keys loaded: <span class="number">1</span>, keys expired: <span class="number">0</span>.</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * DB loaded from disk: <span class="number">0.000</span> seconds</span><br><span class="line">compose<span class="built_in">test-redis</span><span class="literal">-1</span>  | <span class="number">1</span>:M <span class="number">19</span> Dec <span class="number">2022</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">46.876</span> * Ready to accept connections</span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   |  * Serving Flask app <span class="string">&#x27;app.py&#x27;</span></span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   |  * Debug mode: off</span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   | WARNING: This is a development server. <span class="keyword">Do</span> not use it <span class="keyword">in</span> a production deployment. Use a production WSGI server instead.</span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   |  * Running on all addresses (<span class="number">0.0</span>.<span class="number">0.0</span>)</span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   |  * Running on http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8001</span></span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   |  * Running on http://<span class="number">172.26</span>.<span class="number">0.3</span>:<span class="number">8001</span></span><br><span class="line">compose<span class="built_in">test-app1</span><span class="literal">-1</span>   | Press CTRL+C to quit</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>如果想在后台执行该服务可以加上 <strong>-d</strong> 参数：<code>docker-compose up -d</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># docker-compose up -d</span></span><br><span class="line">[+] Running <span class="number">3</span>/<span class="number">3</span></span><br><span class="line"> ⠿ Network composetest_default    Created                   <span class="number">0.2</span>s</span><br><span class="line"> ⠿ Container compose<span class="built_in">test-redis</span><span class="literal">-1</span>  Started                   <span class="number">0.4</span>s</span><br><span class="line"> ⠿ Container compose<span class="built_in">test-app1</span><span class="literal">-1</span>   Started                   <span class="number">0.4</span>s</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 修改dockerfile后，需要进行 `docker-compose up --build`</span><br><span class="line"><span class="number">2</span>. 修改docker-compose，仅仅需要 `docker-compose up`</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="7-4-yml配置指令参考"><a href="#7-4-yml配置指令参考" class="headerlink" title="7.4 yml配置指令参考"></a>7.4 yml配置指令参考</h3><div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="#7.4.1">version</a></td>
<td>指定本 yml 依从的 compose 哪个版本制定的</td>
</tr>
<tr>
<td>2</td>
<td><a href="#7.4.2">build</a></td>
<td>指定为构建镜像上下文路径</td>
</tr>
<tr>
<td>3</td>
<td><a href="#7.4.3">cap_add, cap_drop</a></td>
<td>添加或删除容器拥有的宿主机的内核功能</td>
</tr>
<tr>
<td>4</td>
<td><a href="#7.4.4">cgroup_parent</a></td>
<td>为容器指定父 cgroup 组，意味着将继承该组的资源限制</td>
</tr>
<tr>
<td>5</td>
<td><a href="#7.4.5">command</a></td>
<td>覆盖容器启动的默认命令</td>
</tr>
<tr>
<td>6</td>
<td><a href="#7.4.6">container_name</a></td>
<td>指定自定义容器名称，而不是生成的默认名称</td>
</tr>
<tr>
<td>7</td>
<td><a href="#7.4.7">depends_on</a></td>
<td>设置依赖关系</td>
</tr>
<tr>
<td>8</td>
<td><a href="#7.4.8">deploy</a></td>
<td>指定与服务的部署和运行有关的配置。只在 swarm 模式下才会有用</td>
</tr>
<tr>
<td>9</td>
<td><a href="#7.4.9">devices</a></td>
<td>指定设备映射列表</td>
</tr>
<tr>
<td>10</td>
<td><a href="#7.4.10">dns</a></td>
<td>自定义 DNS 服务器，可以是单个值或列表的多个值。</td>
</tr>
<tr>
<td>11</td>
<td><a href="#7.4.11">dns_search</a></td>
<td>自定义 DNS 搜索域。可以是单个值或列表。</td>
</tr>
<tr>
<td>12</td>
<td><a href="#7.4.12">entrypoint</a></td>
<td>覆盖容器默认的 entrypoint。</td>
</tr>
<tr>
<td>13</td>
<td><a href="#7.4.13">env_file</a></td>
<td>从文件添加环境变量。可以是单个值或列表的多个值。</td>
</tr>
<tr>
<td>14</td>
<td><a href="#7.4.14">environment</a></td>
<td>添加环境变量。您可以使用数组或字典、任何布尔值，布尔值需要用引号引起来，以确保 YML 解析器不会将其转换为 True 或 False。</td>
</tr>
<tr>
<td>15</td>
<td><a href="#7.4.15">expose</a></td>
<td>暴露端口，但不映射到宿主机，只被连接的服务访问。</td>
</tr>
<tr>
<td>16</td>
<td><a href="#7.4.16">extra_hosts</a></td>
<td>添加主机名映射。类似 <code>docker client --add-host</code>。</td>
</tr>
<tr>
<td>17</td>
<td><a href="#7.4.17">healthcheck</a></td>
<td>用于检测 docker 服务是否健康运行。</td>
</tr>
<tr>
<td>18</td>
<td><a href="#7.4.18">image</a></td>
<td>指定容器运行的镜像。</td>
</tr>
<tr>
<td>19</td>
<td><a href="#7.4.19">logging</a></td>
<td>服务的日志记录配置。</td>
</tr>
<tr>
<td>20</td>
<td><a href="#7.4.20">network_mode</a></td>
<td>设置网络模式</td>
</tr>
<tr>
<td>21</td>
<td><a href="#7.4.21">restart</a></td>
<td>重启容器策略</td>
</tr>
<tr>
<td>22</td>
<td><a href="#7.4.22">secrets</a></td>
<td>存储敏感数据，例如密码</td>
</tr>
<tr>
<td>23</td>
<td><a href="#7.4.23">security_opt</a></td>
<td>修改容器默认的 schema 标签。</td>
</tr>
<tr>
<td>24</td>
<td><a href="#7.4.24">stop_grace_period</a></td>
<td>指定在容器无法处理 <code>SIGTERM</code> (或者任何 stop_signal 的信号)，等待多久后发送 <code>SIGKILL</code> 信号关闭容器。</td>
</tr>
<tr>
<td>25</td>
<td><a href="#7.4.25">stop_signal</a></td>
<td>设置停止容器的替代信号。默认情况下使用 <code>SIGTERM</code> 。</td>
</tr>
<tr>
<td>26</td>
<td><a href="#7.4.26">sysctls</a></td>
<td>设置容器中的内核参数，可以使用数组或字典格式。</td>
</tr>
<tr>
<td>27</td>
<td><a href="#7.4.27">tmpfs</a></td>
<td>在容器内安装一个临时文件系统。可以是单个值或列表的多个值。</td>
</tr>
<tr>
<td>28</td>
<td><a href="#7.4.28">ulimits</a></td>
<td>覆盖容器默认的 ulimit。</td>
</tr>
<tr>
<td>29</td>
<td><a href="#7.4.29">volumes</a></td>
<td>将主机的数据卷或者文件挂载到容器里。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="7-4-1-version"><a href="#7-4-1-version" class="headerlink" title="7.4.1 version"></a><a id="7.4.1">7.4.1 version</a></h4><p>指定本 yml 依从的 compose 哪个版本制定的。</p>
<h4 id="7-4-2-build"><a href="#7-4-2-build" class="headerlink" title="7.4.2 build"></a><a id="7.4.2">7.4.2 build</a></h4><p>指定为构建镜像上下文路径：</p>
<p>例如 webapp 服务，指定为从上下文路径 <code>./dir/Dockerfile</code> 所构建的镜像：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./dir</span></span><br></pre></td></tr></table></figure>
<p>或者，作为具有在上下文指定的路径的对象，以及可选的 Dockerfile 和 args：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./dir</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-alternate</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">buildno:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;com.example.description=Accounting webapp&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br><span class="line">      <span class="attr">target:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>context</strong>：上下文路径。</li>
<li><strong>dockerfile</strong>：指定构建镜像的 Dockerfile 文件名。</li>
<li><strong>args</strong>：添加构建参数，这是只能在构建过程中访问的环境变量。</li>
<li><strong>labels</strong>：设置构建镜像的标签。</li>
<li><strong>target</strong>：多层构建，可以指定构建哪一层。</li>
</ul>
<h4 id="7-4-3-cap-add，cap-drop"><a href="#7-4-3-cap-add，cap-drop" class="headerlink" title="7.4.3 cap_add，cap_drop"></a><a id="7.4.3">7.4.3 cap_add，cap_drop</a></h4><p>添加或删除容器拥有的宿主机的内核功能。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cap_add:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ALL</span> <span class="comment"># 开启全部权限</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cap_drop:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SYS_PTRACE</span> <span class="comment"># 关闭 ptrace权限</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-4-cgroup-parent"><a href="#7-4-4-cgroup-parent" class="headerlink" title="7.4.4 cgroup_parent"></a><a id="7.4.4">7.4.4 cgroup_parent</a></h4><p>为容器指定父 cgroup 组，意味着将继承该组的资源限制。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cgroup_parent:</span> <span class="string">m-executor-abcd</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-5-command"><a href="#7-4-5-command" class="headerlink" title="7.4.5 command"></a><a id="7.4.5">7.4.5 command</a></h4><p>覆盖容器启动的默认命令。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> [<span class="string">&quot;bundle&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;thin&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;3000&quot;</span>]</span><br></pre></td></tr></table></figure>
<h4 id="7-4-6-container-name"><a href="#7-4-6-container-name" class="headerlink" title="7.4.6 container_name"></a><a id="7.4.6">7.4.6 container_name</a></h4><p>指定自定义容器名称，而不是生成的默认名称。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">container_name:</span> <span class="string">my-web-container</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-7-depends-on"><a href="#7-4-7-depends-on" class="headerlink" title="7.4.7 depends_on"></a><a id="7.4.7">7.4.7 depends_on</a></h4><p>设置依赖关系。</p>
<ul>
<li><strong><code>docker-compose up</code></strong> ：以依赖性顺序启动服务。在以下示例中，先启动 db 和 redis ，才会启动 web。</li>
<li><strong><code>docker-compose up SERVICE</code></strong> ：自动包含 SERVICE 的依赖项。在以下示例中，<code>docker-compose up web</code> 还将创建并启动 db 和 redis。</li>
<li><strong><code>docker-compose stop</code></strong> ：按依赖关系顺序停止服务。在以下示例中，web 在 db 和 redis 之前停止。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure>
<p>注意：web 服务不会等待 redis db 完全启动 之后才启动。</p>
<h4 id="7-4-8-deploy"><a href="#7-4-8-deploy" class="headerlink" title="7.4.8 deploy"></a><a id="7.4.8">7.4.8 deploy</a></h4><p>指定与服务的部署和运行有关的配置。==只在 swarm 模式下才会有用==。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line">	<span class="attr">services:</span></span><br><span class="line">		<span class="attr">redis:</span></span><br><span class="line">			<span class="attr">image:</span> <span class="string">redis.alpine</span></span><br><span class="line">			<span class="attr">deploy:</span></span><br><span class="line">				<span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">				<span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">				<span class="attr">endpoint_mode:</span> <span class="string">dnsrr</span></span><br><span class="line">				<span class="attr">labels:</span></span><br><span class="line">					<span class="attr">description:</span> <span class="string">&quot;This redis service label&quot;</span></span><br><span class="line">				<span class="attr">resources:</span></span><br><span class="line">					<span class="attr">limits:</span></span><br><span class="line">						<span class="attr">cpus:</span> <span class="string">&quot;0.50&quot;</span></span><br><span class="line">						<span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">					<span class="attr">reservations:</span></span><br><span class="line">						<span class="attr">cpus:</span> <span class="string">&quot;0.25&quot;</span></span><br><span class="line">						<span class="attr">memory:</span> <span class="string">20M</span></span><br><span class="line">				<span class="attr">restart_policy:</span></span><br><span class="line">					<span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">					<span class="attr">delay:</span> <span class="string">5s</span></span><br><span class="line">					<span class="attr">max_attempts:</span> <span class="number">3</span></span><br><span class="line">					<span class="attr">window:</span> <span class="string">120s</span></span><br></pre></td></tr></table></figure>
<p>可以选参数：</p>
<ul>
<li><p><strong>endpoint_mode</strong>：访问集群服务的方式。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">endpoint_mode:</span> <span class="string">vip</span> </span><br><span class="line"><span class="comment"># Docker 集群服务一个对外的虚拟 ip。所有的请求都会通过这个虚拟 ip 到达集群服务内部的机器。</span></span><br><span class="line"><span class="attr">endpoint_mode:</span> <span class="string">dnsrr</span></span><br><span class="line"><span class="comment"># DNS 轮询（DNSRR）。所有的请求会自动轮询获取到集群 ip 列表中的一个 ip 地址。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>labels</strong>：在服务上设置标签。可以用容器上的 labels（跟 deploy 同级的配置） 覆盖 deploy 下的 labels。</p>
</li>
<li><p><strong>mode</strong>：指定服务提供的模式。</p>
<ul>
<li><p><strong>replicated</strong>：复制服务，复制指定服务到集群的机器上。</p>
</li>
<li><p><strong>global</strong>：全局服务，服务将部署至集群的每个节点。</p>
</li>
<li><p>图解：下图中黄色的方块是 replicated 模式的运行情况，灰色方块是 global 模式的运行情况。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_7.4.8_deploy_mode.png" style="zoom:50%;" /></p>
</li>
</ul>
</li>
<li><p><strong>replicas</strong>：<code>mode</code> 为 replicated 时，需要使用此参数配置具体运行的节点数量。</p>
</li>
<li><p><strong>resources</strong>：配置服务器资源使用的限制，例如上例子，配置 redis 集群运行需要的 cpu 的百分比 和 内存的占用。避免占用资源过高出现异常。</p>
<ul>
<li><p>limits:  控制最大限制</p>
<ul>
<li>cpus: “0.50”，表示可占处理周期百分之50的处理时间</li>
<li>memory: 50M，表示可用的内存为50M</li>
</ul>
</li>
<li><p>reservations: 初始可使用资源，保留资源</p>
<ul>
<li>cpus: “0.25”， 表示可占处理周期百分之25的处理时间</li>
<li>memory: 20M，表示可用的内存为20M</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>restart_policy</strong>：配置如何在退出容器时重新启动容器。</p>
<ul>
<li>condition：可选 none，on-failure 或者 any（默认值：any）。</li>
<li>delay：设置多久之后重启（默认值：0）。</li>
<li>max_attempts：尝试重新启动容器的次数，超出次数，则不再尝试（默认值：一直重试）。</li>
<li>window：设置容器重启超时时间（默认值：0）。</li>
</ul>
</li>
<li><p><strong>rollback_config</strong>：配置在更新失败的情况下应如何回滚服务。</p>
<ul>
<li>parallelism：一次要回滚的容器数。如果设置为0，则所有容器将同时回滚。</li>
<li>delay：每个容器组回滚之间等待的时间（默认为0s）。</li>
<li>failure_action：如果回滚失败，该怎么办。其中一个 continue 或者 pause（默认pause）。</li>
<li>monitor：每个容器更新后，持续观察是否失败了的时间 (ns|us|ms|s|m|h)（默认为0s）。</li>
<li>max_failure_ratio：在回滚期间可以容忍的故障率（默认为0）。</li>
<li>order：回滚期间的操作顺序。其中一个 stop-first（串行回滚），或者 start-first（并行回滚）（默认 stop-first ）。</li>
</ul>
</li>
<li><p><strong>update_config</strong>：配置应如何更新服务，对于配置滚动更新很有用。</p>
<ul>
<li>parallelism：一次更新的容器数。</li>
<li>delay：在更新一组容器之间等待的时间。</li>
<li>failure_action：如果更新失败，该怎么办。其中一个 continue，rollback 或者pause （默认：pause）。</li>
<li>monitor：每个容器更新后，持续观察是否失败了的时间 (ns|us|ms|s|m|h)（默认为0s）。</li>
<li>max_failure_ratio：在更新过程中可以容忍的故障率。</li>
<li>order：回滚期间的操作顺序。其中一个 stop-first（串行回滚），或者 start-first（并行回滚）（默认stop-first）。</li>
</ul>
<p><strong>注</strong>：仅支持 V3.4 及更高版本。</p>
</li>
</ul>
<h4 id="7-4-9-devices"><a href="#7-4-9-devices" class="headerlink" title="7.4.9 devices"></a><a id="7.4.9">7.4.9 devices</a></h4><p>指定设备映射列表。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devices:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-10-dns"><a href="#7-4-10-dns" class="headerlink" title="7.4.10 dns"></a><a id="7.4.10">7.4.10 dns</a></h4><p>自定义 DNS 服务器，可以是单个值或列表的多个值。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">9.9</span><span class="number">.9</span><span class="number">.9</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-11-dns-search"><a href="#7-4-11-dns-search" class="headerlink" title="7.4.11 dns_search"></a><a id="7.4.11">7.4.11 dns_search</a></h4><p>自定义 DNS 搜索域。可以是单个值或列表。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_search:</span> <span class="string">example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dns_search:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc1.example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc2.example.com</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-12-entrypoint"><a href="#7-4-12-entrypoint" class="headerlink" title="7.4.12 entrypoint"></a><a id="7.4.12">7.4.12 entrypoint</a></h4><p>覆盖容器默认的 entrypoint。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entrypoint:</span> <span class="string">/code/entrypoint.sh</span></span><br></pre></td></tr></table></figure>
<p>也可以是以下格式：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entrypoint:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">memory_limit=-1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">vendor/bin/phpunit</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-13-env-file"><a href="#7-4-13-env-file" class="headerlink" title="7.4.13 env_file"></a><a id="7.4.13">7.4.13 env_file</a></h4><p>从文件添加环境变量。可以是单个值或列表的多个值。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env_file:</span> <span class="string">.env</span></span><br></pre></td></tr></table></figure>
<p>也可以是列表格式：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env_file:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./common.env</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./apps/web.env</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/opt/secrets.env</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-14-environment"><a href="#7-4-14-environment" class="headerlink" title="7.4.14 environment"></a><a id="7.4.14">7.4.14 environment</a></h4><p>添加环境变量。您可以使用数组或字典、任何布尔值，布尔值需要用引号引起来，以确保 YML 解析器不会将其转换为 True 或 False。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments:</span></span><br><span class="line">  <span class="attr">RACK_ENV:</span> <span class="string">development</span></span><br><span class="line">  <span class="attr">SHOW:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-15-expose"><a href="#7-4-15-expose" class="headerlink" title="7.4.15 expose"></a><a id="7.4.15">7.4.15 expose</a></h4><p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p>
<p>仅可以指定内部端口为参数：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">expose:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8000&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8862&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-16-extra-hosts"><a href="#7-4-16-extra-hosts" class="headerlink" title="7.4.16 extra_hosts"></a><a id="7.4.16">7.4.16 extra_hosts</a></h4><p>添加主机名映射。类似 <code>docker client --add-host</code>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extra_hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;onehost:192.168.58.101&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;otherhost:192.168.58.102&quot;</span></span><br></pre></td></tr></table></figure>
<p>以上会在此服务的内部容器中 /etc/hosts 创建一个具有 ip 地址和主机名的映射关系：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.58</span><span class="number">.101</span>  <span class="string">onehost</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.58</span><span class="number">.102</span>  <span class="string">otherhost</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-17-healthcheck"><a href="#7-4-17-healthcheck" class="headerlink" title="7.4.17 healthcheck"></a><a id="7.4.17">7.4.17 healthcheck</a></h4><p>用于检测 docker 服务是否健康运行。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">healthcheck:</span></span><br><span class="line">  <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]  <span class="comment"># 设置监测程序</span></span><br><span class="line">  <span class="attr">interval:</span> <span class="string">1m30s</span>  <span class="comment"># 设置监测间隔</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">10s</span>  <span class="comment"># 设置检测超时时间</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span>  <span class="comment"># 设置重试次数</span></span><br><span class="line">  <span class="attr">start_period:</span> <span class="string">40s</span>  <span class="comment"># 启动后，多少秒开始启动检测程序</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-18-image"><a href="#7-4-18-image" class="headerlink" title="7.4.18 image"></a><a id="7.4.18">7.4.18 image</a></h4><p>指定容器运行的镜像。以下格式都可以：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">ubuntu:16.04</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">tutum/influxdb</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">60ce5883af74</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-19-logging"><a href="#7-4-19-logging" class="headerlink" title="7.4.19 logging"></a><a id="7.4.19">7.4.19 logging</a></h4><p>服务的日志记录配置。</p>
<p>driver：指定服务容器的日志记录驱动程序，默认值为json-file。有以下三个选项</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver:</span> <span class="string">&quot;json-file&quot;</span></span><br><span class="line"><span class="attr">driver:</span> <span class="string">&quot;syslog&quot;</span></span><br><span class="line"><span class="attr">driver:</span> <span class="string">&quot;none&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>driver: &quot;json-file&quot;</code> 驱动程序下，可以使用以下参数，限制日志得数量和大小。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">json-file</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="attr">max-size:</span> <span class="string">&quot;200k&quot;</span>  <span class="comment"># 单个文件大小为200k</span></span><br><span class="line">    <span class="attr">max-file:</span> <span class="string">&quot;10&quot;</span>  <span class="comment"># 最多10个文件</span></span><br></pre></td></tr></table></figure>
<p>当达到文件限制上限，会自动删除旧得文件。</p>
</li>
<li><p><code>driver: &quot;syslog&quot;</code> 驱动程序下，可以使用 <code>syslog-address</code> 指定日志接收地址。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">syslog</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="attr">syslog-address:</span> <span class="string">&quot;tcp://192.168.58.101:8802&quot;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="7-4-20-network-mode"><a href="#7-4-20-network-mode" class="headerlink" title="7.4.20 network_mode"></a><a id="7.4.20">7.4.20 network_mode</a></h4><p>设置网络模式</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network-mode:</span> <span class="string">&quot;bridge&quot;</span></span><br><span class="line"><span class="attr">network-mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"><span class="attr">network-mode:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line"><span class="attr">network-mode:</span> <span class="string">&quot;service:[service name]&quot;</span></span><br><span class="line"><span class="attr">network-mode:</span> <span class="string">&quot;container:[container name/id]&quot;</span></span><br></pre></td></tr></table></figure>
<p>networks：配置容器连接的网络，引用顶级networks下的条目</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">one-service:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">one-network:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">alias1</span></span><br><span class="line">      <span class="attr">other-network:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="string">-alias2</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">one-network:</span></span><br><span class="line">    <span class="comment"># Use a custom driver</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">custom-driver-1</span></span><br><span class="line">  <span class="attr">other-network:</span></span><br><span class="line">    <span class="comment"># Use a custom driver which takes special options</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">custom-driver-2</span></span><br></pre></td></tr></table></figure>
<p><strong>aliases</strong>: 同一网络上的其他容器阔以使用服务名称或此别名来连接到对应容器的服务。</p>
<h4 id="7-4-21-restart"><a href="#7-4-21-restart" class="headerlink" title="7.4.21 restart"></a><a id="7.4.21">7.4.21 restart</a></h4><ul>
<li><strong>no</strong>:  默认的重启策略，在任何情况下都不会重启容器</li>
<li><strong>always</strong>: 容器总是重新启动</li>
<li><strong>on-failure</strong>: 在容器非正常退出时(退出状态非0)，才会重启容器</li>
<li><strong>unless-stopped</strong>: 在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">restart:</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line"><span class="attr">restart:</span> <span class="string">&quot;on-failure&quot;</span></span><br><span class="line"><span class="attr">retart:</span> <span class="string">&quot;unless-stopped&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>swarm集群模式，请改用<code>restart_policy</code></p>
</blockquote>
<h4 id="7-4-22-secrets"><a href="#7-4-22-secrets" class="headerlink" title="7.4.22 secrets"></a><a id="7.4.22">7.4.22 secrets</a></h4><p>存储敏感数据，例如密码：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD_FILE:</span> <span class="string">/run/secrets/my_secret</span></span><br><span class="line">  <span class="attr">secrets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">my_secret</span></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">my_secret:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./my_secret.txt</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-23-security-opt"><a href="#7-4-23-security-opt" class="headerlink" title="7.4.23 security_opt"></a><a id="7.4.23">7.4.23 security_opt</a></h4><p>修改容器默认的 schema 标签。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security-opt:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">label:</span> <span class="string">user:USER</span>  <span class="comment"># 设置容器的用户标签</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">label: role:</span> <span class="string">ROLE</span>  <span class="comment"># 设置容器的角色标签</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">label: type:</span> <span class="string">TYPE</span>  <span class="comment"># 设置容器的安全策略标签</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">label:</span> <span class="string">level:LEVEL</span>  <span class="comment"># 设置容器的安全等级标签</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-24-stop-grace-period"><a href="#7-4-24-stop-grace-period" class="headerlink" title="7.4.24 stop_grace_period"></a><a id="7.4.24">7.4.24 stop_grace_period</a></h4><p>指定在容器无法处理 <code>SIGTERM</code> (或者任何 stop_signal 的信号)，等待多久后发送 <code>SIGKILL</code> 信号关闭容器。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stop_grace_period:</span> <span class="string">1s</span>  <span class="comment"># 等待1秒</span></span><br><span class="line"><span class="attr">stop_grace_period:</span> <span class="string">1m30s</span>  <span class="comment"># 等待1分30秒</span></span><br></pre></td></tr></table></figure>
<p>默认的等待时间时10秒。</p>
<h4 id="7-4-25-stop-signal"><a href="#7-4-25-stop-signal" class="headerlink" title="7.4.25 stop_signal"></a><a id="7.4.25">7.4.25 stop_signal</a></h4><p>设置停止容器的替代信号。默认情况下使用 <code>SIGTERM</code> 。</p>
<p>以下示例，使用 <code>SIGUSR1</code> 替代信号 <code>SIGTERM</code> 来停止容器。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stop_signal:</span> <span class="string">SIGUSR1</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-26-sysctls"><a href="#7-4-26-sysctls" class="headerlink" title="7.4.26 sysctls"></a><a id="7.4.26">7.4.26 sysctls</a></h4><p>设置容器中的内核参数，可以使用数组或字典格式。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="attr">net.core.somaxconn:</span> <span class="number">1024</span></span><br><span class="line">  <span class="attr">net.ipv4.tcp_syncookies:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.core.somaxconn=1024</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.ipv4.tcp_syncookies=0</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-27-tmpfs"><a href="#7-4-27-tmpfs" class="headerlink" title="7.4.27 tmpfs"></a><a id="7.4.27">7.4.27 tmpfs</a></h4><p>在容器内安装一个临时文件系统。可以是单个值或列表的多个值。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tmpfs:</span> <span class="string">/run</span></span><br><span class="line"><span class="attr">tmpfs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/run</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-28-ulimits"><a href="#7-4-28-ulimits" class="headerlink" title="7.4.28 ulimits"></a><a id="7.4.28">7.4.28 ulimits</a></h4><p>覆盖容器默认的 ulimit。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ulimits:</span></span><br><span class="line">  <span class="attr">nproc:</span> <span class="number">65535</span></span><br><span class="line">  <span class="attr">nofile:</span></span><br><span class="line">    <span class="attr">soft:</span> <span class="number">20000</span></span><br><span class="line">    <span class="attr">hard:</span> <span class="number">40000</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-29-volumes"><a href="#7-4-29-volumes" class="headerlink" title="7.4.29 volumes"></a><a id="7.4.29">7.4.29 volumes</a></h4><p>将主机的数据卷或者文件挂载到容器里。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yml 配置实例</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:latest</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/localhost/postgres.sock:/var/run/postgres/postgres.sock&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/localhost/data:/var/lib/postgres/data&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="8-Docker-Machine"><a href="#8-Docker-Machine" class="headerlink" title="8. Docker Machine"></a>8. Docker Machine</h2><h3 id="8-1-简介"><a href="#8-1-简介" class="headerlink" title="8.1 简介"></a>8.1 简介</h3><p>Docker Machine 是一种可以让您在虚拟主机上安装 Docker 的工具，并可以使用 <code>docker-machine</code> 命令来管理主机。</p>
<p>Docker Machine 也可以集中管理所有的 docker 主机，比如快速的给 100 台服务器安装上 docker。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_8.1%20%E7%AE%80%E4%BB%8B.png" style="zoom:50%;" /></p>
<p>Docker Machine 管理的虚拟主机可以是机上的，也可以是云供应商，如阿里云，腾讯云，AWS，或 DigitalOcean等等。</p>
<p>使用 <code>docker-machine</code> 命令，您可以启动，检查，停止和重新启动托管主机，也可以升级 Docker 客户端和守护程序，以及配置 Docker 客户端与您的主机进行通信。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_8.1%20%E7%AE%80%E4%BB%8B01.png" style="zoom:50%;" /></p>
<h3 id="8-2-安装"><a href="#8-2-安装" class="headerlink" title="8.2 安装"></a>8.2 安装</h3><p>安装 Docker Machine 之前你需要先安装 Docker</p>
<p>Docker Machine 可以在多种平台上安装使用，包括 Linux 、MacOS 以及 windows。</p>
<h4 id="8-2-1-macOS安装命令"><a href="#8-2-1-macOS安装命令" class="headerlink" title="8.2.1 macOS安装命令"></a>8.2.1 macOS安装命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> ~ % <span class="built_in">curl</span> <span class="literal">-L</span> https://github.com/docker/machine/releases/download/v0.<span class="number">16.2</span>/docker<span class="literal">-machine-</span>`uname <span class="literal">-s</span>`-`uname <span class="literal">-m</span>` &gt;/usr/local/bin/docker<span class="literal">-machine</span> &amp;&amp; \</span><br><span class="line">&gt; chmod +x /usr/local/bin/docker<span class="literal">-machine</span></span><br><span class="line">    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span>     <span class="number">0</span></span><br><span class="line">  <span class="number">0</span> <span class="number">32.6</span>M    <span class="number">0</span> <span class="number">97716</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">355</span>      <span class="number">0</span> <span class="number">26</span>:<span class="number">46</span>:<span class="number">17</span>  <span class="number">0</span>:<span class="number">04</span>:<span class="number">34</span> <span class="number">26</span>:<span class="number">41</span>:<span class="number">43</span>     <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-2-Linux-安装命令"><a href="#8-2-2-Linux-安装命令" class="headerlink" title="8.2.2 Linux 安装命令"></a>8.2.2 Linux 安装命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;     chmod +x /tmp/docker-machine &amp;&amp;     sudo cp /tmp/docker-machine /usr/local/bin/docker-machine</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span> <span class="literal">--</span>:<span class="literal">--</span>:<span class="literal">--</span>     <span class="number">0</span></span><br><span class="line">  <span class="number">0</span> <span class="number">32.6</span>M    <span class="number">0</span> <span class="number">97716</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">355</span>      <span class="number">0</span> <span class="number">26</span>:<span class="number">46</span>:<span class="number">17</span>  <span class="number">0</span>:<span class="number">04</span>:<span class="number">34</span> <span class="number">26</span>:<span class="number">41</span>:<span class="number">43</span>     <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-3-Windows-with-git-bash"><a href="#8-2-3-Windows-with-git-bash" class="headerlink" title="8.2.3 Windows with git bash"></a>8.2.3 Windows with git bash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yanpenggong@kungs MINGW64 ~</span><br><span class="line">$ <span class="keyword">if</span> [[ ! -d <span class="string">&quot;<span class="variable">$HOME</span>/bin&quot;</span> ]]; <span class="keyword">then</span> <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$HOME</span>/bin&quot;</span>; <span class="keyword">fi</span> &amp;&amp; \</span><br><span class="line">curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-Windows-x86_64.exe &gt; <span class="string">&quot;<span class="variable">$HOME</span>/bin/docker-machine.exe&quot;</span> &amp;&amp; \</span><br><span class="line"><span class="built_in">chmod</span> +x <span class="string">&quot;<span class="variable">$HOME</span>/bin/docker-machine.exe&quot;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">  0 32.8M    0  111k    0     0  23166      0  0:24:47  0:00:04  0:24:43 34068</span><br></pre></td></tr></table></figure>
<p>否则，直接从<a target="_blank" rel="noopener" href="https://github.com/docker/machine/releases/">发布页面</a>下载其中一个版本。</p>
<p>有关更多安装选项和说明，请参阅安装<a target="_blank" rel="noopener" href="https://docs.docker.com/machine/install-machine/">文档</a>。</p>
<h4 id="8-2-4-查看是否安装成功："><a href="#8-2-4-查看是否安装成功：" class="headerlink" title="8.2.4 查看是否安装成功："></a>8.2.4 查看是否安装成功：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># docker-machine --version</span></span><br><span class="line">docker<span class="literal">-machine</span> version <span class="number">0.16</span>.<span class="number">2</span>, build bd45ab13</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>各版本更新日志里面也有安装说明：<a target="_blank" rel="noopener" href="https://github.com/docker/machine/releases">https://github.com/docker/machine/releases</a></p>
</blockquote>
<h3 id="8-3-使用"><a href="#8-3-使用" class="headerlink" title="8.3 使用"></a>8.3 使用</h3><p>这里通过 vmware来介绍 docker-machine 的使用方法。其他云服务商操作与此基本一致。具体可以参考每家服务商的指导文档。</p>
<h4 id="8-3-1列出可用的机器"><a href="#8-3-1列出可用的机器" class="headerlink" title="8.3.1列出可用的机器"></a>8.3.1列出可用的机器</h4><p>可以看到目前只有这里默认的 default 虚拟机。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># docker-machine ls</span></span><br><span class="line">NAME   ACTIVE   DRIVER   STATE   URL   SWARM   DOCKER   ERRORS</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">composeTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="8-3-2-创建机器"><a href="#8-3-2-创建机器" class="headerlink" title="8.3.2 创建机器"></a>8.3.2 创建机器</h4><p>创建一台名为 test 的机器。</p>
<ul>
<li><p><strong>—driver</strong>：指定用来创建机器的驱动类型，这里是 <code>virtualbox</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">--driver</span> virtualbox test</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ERROR：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">--driver</span> virtualbox test</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % </span><br></pre></td></tr></table></figure>
<p><strong>解决办法：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % brew install virtualbox</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.ustc.edu.cn</span><br><span class="line"> * extras: ftp.sjtu.edu.cn</span><br><span class="line"> * updates: mirrors.ustc.edu.cn</span><br><span class="line">base                                                            | <span class="number">3.6</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">docker<span class="literal">-ce-stable</span>                                                | <span class="number">3.5</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">extras                                                          | <span class="number">2.9</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">updates                                                         | <span class="number">2.9</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">(<span class="number">1</span>/<span class="number">2</span>): docker<span class="literal">-ce-stable</span>/<span class="number">7</span>/x86_64/primary_db                     |  <span class="number">91</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     </span><br><span class="line">(<span class="number">2</span>/<span class="number">2</span>): updates/<span class="number">7</span>/x86_64/primary_db                              |  <span class="number">19</span> MB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">06</span>     </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % </span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><strong>—driver</strong>：指定用来创建机器的驱动类型，这里是 <code>vmware</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">--driver</span>=vmware yanpenggong1</span><br><span class="line">Running pre<span class="literal">-create</span> checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(yanpenggong1) Copying /Users/kungs/.docker/machine/cache/boot2docker.iso to /Users/kungs/.docker/machine/machines/yanpenggong1/boot2docker.iso...</span><br><span class="line">(yanpenggong1) Creating SSH key...</span><br><span class="line">(yanpenggong1) Creating VM...</span><br><span class="line">(yanpenggong1) Starting yanpenggong1...</span><br><span class="line">(yanpenggong1) Waiting <span class="keyword">for</span> VM to come online...</span><br><span class="line">Waiting <span class="keyword">for</span> machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with boot2docker...</span><br><span class="line">Copying certs to the local machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker<span class="literal">-machine</span> env yanpenggong1</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>        </span><br><span class="line">NAME           ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">yanpenggong1   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ERROR</strong>解决办法：</p>
<p>包的路径：<a target="_blank" rel="noopener" href="https://github.com/machine-drivers/docker-machine-driver-vmware">docker-machine-driver-vmware</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % brew install docker<span class="literal">-machine-driver-vmware</span></span><br><span class="line">==&gt; Fetching docker<span class="literal">-machine-driver-vmware</span></span><br><span class="line">==&gt; Downloading https://mirrors.aliyun.com/homebrew/homebrew<span class="literal">-bottles</span>/docker<span class="literal">-machine-driver-vmware-0</span>.<span class="number">1.5</span>.monterey.bottle.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Pouring docker<span class="literal">-machine-driver-vmware-0</span>.<span class="number">1.5</span>.monterey.bottle.<span class="number">1</span>.tar.gz</span><br><span class="line">/usr/local/Cellar/docker<span class="literal">-machine-driver-vmware</span>/<span class="number">0.1</span>.<span class="number">5</span>: <span class="number">5</span> files, <span class="number">10</span>MB</span><br><span class="line">==&gt; Running `brew cleanup docker<span class="literal">-machine-driver-vmware</span>`...</span><br><span class="line">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class="line">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % </span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h4 id="8-3-3-查看机器的-ip"><a href="#8-3-3-查看机器的-ip" class="headerlink" title="8.3.3 查看机器的 ip"></a>8.3.3 查看机器的 ip</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ip yanpenggong1</span><br><span class="line"><span class="number">172.16</span>.<span class="number">247.6</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<h4 id="8-3-4-停止机器"><a href="#8-3-4-停止机器" class="headerlink" title="8.3.4 停止机器"></a>8.3.4 停止机器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> stop yanpenggong1 </span><br><span class="line">Stopping <span class="string">&quot;yanpenggong1&quot;</span>...</span><br><span class="line">Machine <span class="string">&quot;yanpenggong1&quot;</span> was stopped.</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<h4 id="8-3-5-启动机器"><a href="#8-3-5-启动机器" class="headerlink" title="8.3.5 启动机器"></a>8.3.5 启动机器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">start</span> yanpenggong1</span><br><span class="line">Starting <span class="string">&quot;yanpenggong1&quot;</span>...</span><br><span class="line">(yanpenggong1) Starting yanpenggong1...</span><br><span class="line">(yanpenggong1) Waiting <span class="keyword">for</span> VM to come online...</span><br><span class="line">Machine <span class="string">&quot;yanpenggong1&quot;</span> was started.</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Started machines may have new IP addresses. You may need to re<span class="literal">-run</span> the `docker<span class="literal">-machine</span> env` command.</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<h4 id="8-3-6-进入机器"><a href="#8-3-6-进入机器" class="headerlink" title="8.3.6 进入机器"></a>8.3.6 进入机器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ssh yanpenggong1</span><br><span class="line">   ( <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">  /) TC (\   Core is distributed with ABSOLUTELY NO WARRANTY.</span><br><span class="line"> (/<span class="literal">-_--_-</span>\)           www.tinycorelinux.net</span><br><span class="line"></span><br><span class="line">chmod: /mnt/hgfs/Users: Operation not permitted</span><br><span class="line">fuse: mountpoint is not empty</span><br><span class="line">fuse: <span class="keyword">if</span> you are sure this is safe, use the <span class="string">&#x27;nonempty&#x27;</span> <span class="built_in">mount</span> option</span><br><span class="line">chmod: /mnt/hgfs/Users: Operation not permitted</span><br><span class="line">fuse: mountpoint is not empty</span><br><span class="line">fuse: <span class="keyword">if</span> you are sure this is safe, use the <span class="string">&#x27;nonempty&#x27;</span> <span class="built_in">mount</span> option</span><br><span class="line">docker@yanpenggong1:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h4 id="8-3-7-docker-machine-命令参数说明"><a href="#8-3-7-docker-machine-命令参数说明" class="headerlink" title="8.3.7 docker-machine 命令参数说明"></a>8.3.7 docker-machine 命令参数说明</h4><p><strong>激活docker的指定环境<code>eval $(docker-machine env 创建的环境名)</code>，实例：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %  eval <span class="variable">$</span>(docker<span class="literal">-machine</span> env yanpenggong1)</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                       </span><br><span class="line">NAME           ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">yanpenggong1   *        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>演示情况：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                       </span><br><span class="line">NAME           ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">yanpenggong1   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %  eval <span class="variable">$</span>(docker<span class="literal">-machine</span> env yanpenggong1)</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                       </span><br><span class="line">NAME           ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">yanpenggong1   *        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % <span class="built_in">echo</span> <span class="variable">$DOCKER_HOST</span>                       </span><br><span class="line">tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> active                   </span><br><span class="line">yanpenggong1</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>参数</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>active</td>
<td>查看当前激活状态的 Docker 主机。</td>
</tr>
<tr>
<td>2</td>
<td>config</td>
<td>查看当前激活状态 Docker 主机的连接信息。</td>
</tr>
<tr>
<td>3</td>
<td>create</td>
<td>创建 Docker 主机</td>
</tr>
<tr>
<td>4</td>
<td>env</td>
<td>显示连接到某个主机需要的环境变量</td>
</tr>
<tr>
<td>5</td>
<td>inspect</td>
<td>以 json 格式输出指定Docker的详细信息</td>
</tr>
<tr>
<td>6</td>
<td>ip</td>
<td>获取指定 Docker 主机的地址</td>
</tr>
<tr>
<td>7</td>
<td>kill</td>
<td>直接杀死指定的 Docker 主机</td>
</tr>
<tr>
<td>8</td>
<td>ls</td>
<td>列出所有的管理主机</td>
</tr>
<tr>
<td>9</td>
<td>provision</td>
<td>重新配置指定主机</td>
</tr>
<tr>
<td>10</td>
<td>regenerate-certs</td>
<td>某个主机重新生成 TLS 信息</td>
</tr>
<tr>
<td>11</td>
<td>restart</td>
<td>重启指定的主机</td>
</tr>
<tr>
<td>12</td>
<td>rm</td>
<td>删除某台 Docker 主机，对应的虚拟机也会被删除</td>
</tr>
<tr>
<td>13</td>
<td>ssh</td>
<td>通过 SSH 连接到主机上，执行命令</td>
</tr>
<tr>
<td>14</td>
<td>scp</td>
<td>在 Docker 主机之间以及 Docker 主机和本地主机之间通过 scp 远程复制数据</td>
</tr>
<tr>
<td>15</td>
<td>mount</td>
<td>使用 SSHFS 从计算机装载或卸载目录</td>
</tr>
<tr>
<td>16</td>
<td>start</td>
<td>启动一个指定的 Docker 主机，如果对象是个虚拟机，该虚拟机将被启动</td>
</tr>
<tr>
<td>17</td>
<td>status</td>
<td>获取指定 Docker 主机的状态(包括：Running、Paused、Saved、Stopped、Stopping、Starting、Error)等</td>
</tr>
<tr>
<td>18</td>
<td>stop</td>
<td>停止一个指定的 Docker 主机</td>
</tr>
<tr>
<td>19</td>
<td>upgrade</td>
<td>将一个指定主机的 Docker 版本更新为最新</td>
</tr>
<tr>
<td>20</td>
<td>url</td>
<td>获取指定 Docker 主机的监听 URL</td>
</tr>
<tr>
<td>21</td>
<td>version</td>
<td>显示 Docker Machine 的版本或者主机 Docker 版本</td>
</tr>
<tr>
<td>22</td>
<td>help</td>
<td>显示帮助信息</td>
</tr>
</tbody>
</table>
</div>
<h2 id="9-Swarm集群管理"><a href="#9-Swarm集群管理" class="headerlink" title="9. Swarm集群管理"></a>9. Swarm集群管理</h2><p>==这块内容都是基于macbook下的Docker进行操作的。==</p>
<h3 id="9-1-简介"><a href="#9-1-简介" class="headerlink" title="9.1 简介"></a>9.1 简介</h3><p>Docker Swarm 是 Docker 的集群管理工具。它将 Docker 主机池转变为单个虚拟 Docker 主机。 Docker Swarm 提供了标准的 Docker API，所有任何已经与 Docker 守护程序通信的工具都可以使用 Swarm 轻松地扩展到多个主机。</p>
<p>支持的工具包括但不限于以下各项：</p>
<ul>
<li>Dokku</li>
<li>Docker Compose</li>
<li>Docker Machine</li>
<li>Jenkins</li>
</ul>
<h3 id="9-2-原理"><a href="#9-2-原理" class="headerlink" title="9.2 原理"></a>9.2 原理</h3><p>swarm 集群由<strong>管理节点（manager）</strong>和<strong>工作节点（work node）</strong>构成。</p>
<ul>
<li><strong>swarm mananger</strong>：负责整个集群的管理工作包括集群配置、服务管理等所有跟集群有关的工作。</li>
<li><strong>work node</strong>：即图中的 available node，主要负责运行相应的服务来执行任务（task）。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_9.2%E5%8E%9F%E7%90%86.png" style="zoom:50%;" /></p>
<h3 id="9-3-使用"><a href="#9-3-使用" class="headerlink" title="9.3 使用"></a>9.3 使用</h3><p>以下示例，以 <code>Docker Machine</code> 和 <code>vmware</code> 进行介绍，确保你的主机已安装 <code>vmware</code> 。</p>
<h4 id="9-3-1-创建-swarm-集群管理节点（manager）"><a href="#9-3-1-创建-swarm-集群管理节点（manager）" class="headerlink" title="9.3.1 创建 swarm 集群管理节点（manager）"></a>9.3.1 创建 swarm 集群管理节点（manager）</h4><p>创建 docker 机器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">-driver</span> vmware swarm<span class="literal">-manager</span></span><br><span class="line">Running pre<span class="literal">-create</span> checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(swarm<span class="literal">-manager</span>) Copying /Users/kungs/.docker/machine/cache/boot2docker.iso to /Users/kungs/.docker/machine/machines/swarm<span class="literal">-manager</span>/boot2docker.iso...</span><br><span class="line">(swarm<span class="literal">-manager</span>) Creating SSH key...</span><br><span class="line">(swarm<span class="literal">-manager</span>) Creating VM...</span><br><span class="line">(swarm<span class="literal">-manager</span>) Starting swarm<span class="literal">-manager</span>...</span><br><span class="line">(swarm<span class="literal">-manager</span>) Waiting <span class="keyword">for</span> VM to come online...</span><br><span class="line">Waiting <span class="keyword">for</span> machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with boot2docker...</span><br><span class="line">Copying certs to the local machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker<span class="literal">-machine</span> env swarm<span class="literal">-manager</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                                 </span><br><span class="line">NAME            ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">swarm<span class="literal">-manager</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">yanpenggong1    *        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>初始化 swarm 集群，进行初始化的这台机器，就是集群的管理节点。其中<code>docker swarm init --advertise-addr 172.16.247.7</code>对应的ip是创建机器时分配的 ip。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ssh swarm<span class="literal">-manager</span>    </span><br><span class="line">   ( <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">  /) TC (\   Core is distributed with ABSOLUTELY NO WARRANTY.</span><br><span class="line"> (/<span class="literal">-_--_-</span>\)           www.tinycorelinux.net</span><br><span class="line"></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker swarm init <span class="literal">--advertise-addr</span> <span class="number">172.16</span>.<span class="number">247.7</span>                                              </span><br><span class="line">Swarm initialized: current node (qrywiizkesql8crxvyy9maafb) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join <span class="literal">--token</span> SWMTKN<span class="literal">-1-0wstyhdwc045fcam3n3r6yocmrnlj3eyr0ywkjxni2jp4lk0z3-5jzty2vwepgh1vrnfxplfzq7a</span> <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run <span class="string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.</span><br><span class="line"></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<p>以上输出，证明已经初始化成功。需要把以下这行复制出来，在增加工作节点时会用到：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join <span class="literal">--token</span> SWMTKN<span class="literal">-1-0wstyhdwc045fcam3n3r6yocmrnlj3eyr0ywkjxni2jp4lk0z3-5jzty2vwepgh1vrnfxplfzq7a</span> <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-2-创建-swarm-集群工作节点（worker）"><a href="#9-3-2-创建-swarm-集群工作节点（worker）" class="headerlink" title="9.3.2 创建 swarm 集群工作节点（worker）"></a>9.3.2 创建 swarm 集群工作节点（worker）</h4><p>这里直接创建好俩台机器，<code>swarm-worker1</code> 和 <code>swarm-worker2</code> 。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">-driver</span> vmware swarm<span class="literal">-worker1</span></span><br><span class="line">Running pre<span class="literal">-create</span> checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(swarm<span class="literal">-worker1</span>) Copying /Users/kungs/.docker/machine/cache/boot2docker.iso to /Users/kungs/.docker/machine/machines/swarm<span class="literal">-worker1</span>/boot2docker.iso...</span><br><span class="line">(swarm<span class="literal">-worker1</span>) Creating SSH key...</span><br><span class="line">(swarm<span class="literal">-worker1</span>) Creating VM...</span><br><span class="line">(swarm<span class="literal">-worker1</span>) Starting swarm<span class="literal">-worker1</span>...</span><br><span class="line">(swarm<span class="literal">-worker1</span>) Waiting <span class="keyword">for</span> VM to come online...</span><br><span class="line">Waiting <span class="keyword">for</span> machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with boot2docker...</span><br><span class="line">Copying certs to the local machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker<span class="literal">-machine</span> env swarm<span class="literal">-worker1</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> create <span class="literal">-driver</span> vmware swarm<span class="literal">-worker2</span></span><br><span class="line">Running pre<span class="literal">-create</span> checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(swarm<span class="literal">-worker2</span>) Copying /Users/kungs/.docker/machine/cache/boot2docker.iso to /Users/kungs/.docker/machine/machines/swarm<span class="literal">-worker2</span>/boot2docker.iso...</span><br><span class="line">(swarm<span class="literal">-worker2</span>) Creating SSH key...</span><br><span class="line">(swarm<span class="literal">-worker2</span>) Creating VM...</span><br><span class="line">(swarm<span class="literal">-worker2</span>) Starting swarm<span class="literal">-worker2</span>...</span><br><span class="line">(swarm<span class="literal">-worker2</span>) Waiting <span class="keyword">for</span> VM to come online...</span><br><span class="line">Waiting <span class="keyword">for</span> machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with boot2docker...</span><br><span class="line">Copying certs to the local machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker<span class="literal">-machine</span> env swarm<span class="literal">-worker2</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                                 </span><br><span class="line">NAME            ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">swarm<span class="literal">-manager</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">swarm<span class="literal">-worker1</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.8</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">swarm<span class="literal">-worker2</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.9</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">yanpenggong1    *        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>分别进入两个机器里，指定添加至上一步中创建的集群，这里会用到上一步复制的内容。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ssh swarm<span class="literal">-worker1</span></span><br><span class="line">   ( <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">  /) TC (\   Core is distributed with ABSOLUTELY NO WARRANTY.</span><br><span class="line"> (/<span class="literal">-_--_-</span>\)           www.tinycorelinux.net</span><br><span class="line"></span><br><span class="line">&lt;tyhdwc045fcam3n3r6yocmrnlj3eyr0ywkjxni2jp4lk0z3<span class="literal">-5jzty2vwepgh1vrnfxplfzq7a</span> <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line">docker@swarm<span class="literal">-worker1</span>:~<span class="variable">$</span> <span class="keyword">exit</span>                                                                                                                </span><br><span class="line">logout</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ssh swarm<span class="literal">-worker2</span></span><br><span class="line">   ( <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">  /) TC (\   Core is distributed with ABSOLUTELY NO WARRANTY.</span><br><span class="line"> (/<span class="literal">-_--_-</span>\)           www.tinycorelinux.net</span><br><span class="line"></span><br><span class="line">&lt;tyhdwc045fcam3n3r6yocmrnlj3eyr0ywkjxni2jp4lk0z3<span class="literal">-5jzty2vwepgh1vrnfxplfzq7a</span> <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line">docker@swarm<span class="literal">-worker2</span>:~<span class="variable">$</span> <span class="keyword">exit</span>                                                                                                                </span><br><span class="line">logout</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>以上数据输出说明已经添加成功。</p>
<p>上图中，由于上一步复制的内容比较长，会被自动截断，实际上在图运行的命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-worker2</span>:~<span class="variable">$</span> docker swarm join <span class="literal">--token</span> SWMTKN<span class="literal">-1-0wstyhdwc045fcam3n3r6yocmrnlj3eyr0ywkjxni2jp4lk0z3-5jzty2vwepgh1vrnfxplfzq7a</span> <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<h4 id="9-3-3-查看集群信息"><a href="#9-3-3-查看集群信息" class="headerlink" title="9.3.3 查看集群信息"></a>9.3.3 查看集群信息</h4><p>激活swarm模式</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % eval <span class="variable">$</span>(docker<span class="literal">-machine</span> env swarm<span class="literal">-manager</span>)</span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker node <span class="built_in">ls</span>                          </span><br><span class="line">ID                            HOSTNAME        STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">qrywiizkesql8crxvyy9maafb *   swarm<span class="literal">-manager</span>   Ready     Active         Leader           <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">rr74dtx0mq67hskuaxt6kgx0w     swarm<span class="literal">-worker1</span>   Ready     Active                          <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">am79rf9q1mo0tvu0otketbf4q     swarm<span class="literal">-worker2</span>   Ready     Active                          <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>进入管理节点，执行：<code>docker info</code> 可以查看当前集群的信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker info                     </span><br><span class="line">Client:</span><br><span class="line"> Context:    default</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Plugins:</span><br><span class="line">  buildx: Docker Buildx (Docker Inc., v0.<span class="number">8.2</span>)</span><br><span class="line">  compose: Docker Compose (Docker Inc., v2.<span class="number">7.0</span>)</span><br><span class="line">  extension: Manages Docker extensions (Docker Inc., v0.<span class="number">2.8</span>)</span><br><span class="line">  sbom: View the packaged<span class="literal">-based</span> Software Bill Of Materials (SBOM) <span class="keyword">for</span> an image (Anchore Inc., <span class="number">0.6</span>.<span class="number">0</span>)</span><br><span class="line">  scan: Docker Scan (Docker Inc., v0.<span class="number">17.0</span>)</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: <span class="number">0</span></span><br><span class="line">  Running: <span class="number">0</span></span><br><span class="line">  Paused: <span class="number">0</span></span><br><span class="line">  Stopped: <span class="number">0</span></span><br><span class="line"> Images: <span class="number">0</span></span><br><span class="line"> Server Version: <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: extfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay <span class="built_in">Diff</span>: true</span><br><span class="line"> Logging Driver: json<span class="operator">-file</span></span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json<span class="operator">-file</span> local logentries splunk syslog</span><br><span class="line"> Swarm: active</span><br><span class="line">  NodeID: qrywiizkesql8crxvyy9maafb</span><br><span class="line">  Is Manager: true</span><br><span class="line">  ClusterID: xgdh712ll4k6nraf2heear3tm</span><br><span class="line">  Managers: <span class="number">1</span></span><br><span class="line">  Nodes: <span class="number">3</span></span><br><span class="line">  Default Address Pool: <span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">8</span>  </span><br><span class="line">  SubnetSize: <span class="number">24</span></span><br><span class="line">  <span class="keyword">Data</span> Path Port: <span class="number">4789</span></span><br><span class="line">  Orchestration:</span><br><span class="line">   Task <span class="built_in">History</span> Retention Limit: <span class="number">5</span></span><br><span class="line">  Raft:</span><br><span class="line">   Snapshot Interval: <span class="number">10000</span></span><br><span class="line">   Number of Old Snapshots to Retain: <span class="number">0</span></span><br><span class="line">   Heartbeat Tick: <span class="number">1</span></span><br><span class="line">   Election Tick: <span class="number">10</span></span><br><span class="line">  Dispatcher:</span><br><span class="line">   Heartbeat Period: <span class="number">5</span> seconds</span><br><span class="line">  CA Configuration:</span><br><span class="line">   Expiry Duration: <span class="number">3</span> months</span><br><span class="line">   Force Rotate: <span class="number">0</span></span><br><span class="line">  Autolock Managers: false</span><br><span class="line">  Root Rotation <span class="keyword">In</span> Progress: false</span><br><span class="line">  Node Address: <span class="number">172.16</span>.<span class="number">247.7</span></span><br><span class="line">  Manager Addresses:</span><br><span class="line">   <span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2377</span></span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker<span class="literal">-init</span></span><br><span class="line"> containerd version: <span class="number">7</span>ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: <span class="number">4.19</span>.<span class="number">130</span><span class="literal">-boot2docker</span></span><br><span class="line"> Operating System: Boot2Docker <span class="number">19.03</span>.<span class="number">12</span> (TCL <span class="number">10.1</span>)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: <span class="number">1</span></span><br><span class="line"> Total Memory: <span class="number">984.3</span>MiB</span><br><span class="line"> Name: swarm<span class="literal">-manager</span></span><br><span class="line"> ID: XJDY:TYXT:LFCV:CYTK:IDRY:BVD2:AWQO:FYBY:RY6D:YI2D:YC4Z:<span class="number">6</span>LJL</span><br><span class="line"> Docker Root <span class="built_in">Dir</span>: /mnt/sda1/var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line">  provider=vmware</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  <span class="number">127.0</span>.<span class="number">0.0</span>/<span class="number">8</span></span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br><span class="line"></span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning %</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Swarm: active  <span class="comment"># docker engine有没有激活swarm模式， 默认是没有(inactive)</span></span><br><span class="line"> NodeID: qrywiizkesql8crxvyy9maafb</span><br><span class="line"> Is Manager: true</span><br><span class="line"> ClusterID: xgdh712ll4k6nraf2heear3tm</span><br><span class="line"> Managers: <span class="number">1</span>  <span class="comment"># 管理节点</span></span><br><span class="line"> Nodes: <span class="number">3</span>  <span class="comment"># 三个节点</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-4-部署服务到集群中"><a href="#9-3-4-部署服务到集群中" class="headerlink" title="9.3.4 部署服务到集群中"></a>9.3.4 部署服务到集群中</h4><p><strong>注意</strong>：跟集群管理有关的任何操作，都是在管理节点上操作的。</p>
<p>以下例子，在一个工作节点上创建一个名为 helloworld 的服务，这里是随机指派给一个工作节点：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> <span class="built_in">ls</span>                       </span><br><span class="line">NAME            ACTIVE   DRIVER   STATE     URL                       SWARM   DOCKER      ERRORS</span><br><span class="line">swarm<span class="literal">-manager</span>   *        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.7</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">swarm<span class="literal">-worker1</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.8</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">swarm<span class="literal">-worker2</span>   -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.9</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">yanpenggong1    -        vmware   Running   tcp://<span class="number">172.16</span>.<span class="number">247.6</span>:<span class="number">2376</span>           v19.<span class="number">03.12</span>   </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % </span><br><span class="line">(base) kungs@kungs<span class="literal">-MacPro</span> DockerLearning % docker<span class="literal">-machine</span> ssh swarm<span class="literal">-manager</span></span><br><span class="line">   ( <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">  /) TC (\   Core is distributed with ABSOLUTELY NO WARRANTY.</span><br><span class="line"> (/<span class="literal">-_--_-</span>\)           www.tinycorelinux.net</span><br><span class="line"></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service create <span class="literal">--replicas</span> <span class="number">1</span> <span class="literal">--name</span> helloworld alpine ping docker.com                                         </span><br><span class="line"><span class="number">05</span>o7ocmbmpm28xcfeu8ci4cml</span><br><span class="line">overall progress: <span class="number">1</span> out of <span class="number">1</span> tasks </span><br><span class="line"><span class="number">1</span>/<span class="number">1</span>: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-5-查看服务部署情况"><a href="#9-3-5-查看服务部署情况" class="headerlink" title="9.3.5 查看服务部署情况"></a>9.3.5 查看服务部署情况</h4><p>查看 helloworld 服务运行在哪个节点上，可以看到目前是在 <code>swarm-worker2</code> 节点：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">ps</span> helloworld</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class="line">bpopbylx99di        helloworld.<span class="number">1</span>        alpine:latest       swarm<span class="literal">-worker2</span>       Running             Running about a minute ago                       </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<p>查看 helloworld 部署的具体信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service inspect <span class="literal">--pretty</span> helloworld                                                                          </span><br><span class="line"></span><br><span class="line">ID: <span class="number">05</span>o7ocmbmpm28xcfeu8ci4cml</span><br><span class="line">Name: helloworld</span><br><span class="line">Service Mode: Replicated</span><br><span class="line"> Replicas: <span class="number">1</span></span><br><span class="line">Placement:</span><br><span class="line">UpdateConfig:</span><br><span class="line"> Parallelism: <span class="number">1</span></span><br><span class="line"> On failure: pause</span><br><span class="line"> Monitoring Period: <span class="number">5</span>s</span><br><span class="line"> Max failure ratio: <span class="number">0</span></span><br><span class="line"> Update order:      <span class="built_in">stop-first</span></span><br><span class="line">RollbackConfig:</span><br><span class="line"> Parallelism: <span class="number">1</span></span><br><span class="line"> On failure: pause</span><br><span class="line"> Monitoring Period: <span class="number">5</span>s</span><br><span class="line"> Max failure ratio: <span class="number">0</span></span><br><span class="line"> Rollback order:    <span class="built_in">stop-first</span></span><br><span class="line">ContainerSpec:</span><br><span class="line"> Image: alpine:latest@sha256:f271e74b17ced29b915d351685fd4644785c6d1559dd1f2d4189a5e851ef753a</span><br><span class="line"> Args: ping docker.com </span><br><span class="line"> Init: false</span><br><span class="line">Resources:</span><br><span class="line">Endpoint Mode: vip</span><br><span class="line"></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-6-扩展集群服务"><a href="#9-3-6-扩展集群服务" class="headerlink" title="9.3.6 扩展集群服务"></a>9.3.6 扩展集群服务</h4><p>将上述的 helloworld 服务扩展到俩个节点。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">ps</span> helloworld </span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class="line">bpopbylx99di        helloworld.<span class="number">1</span>        alpine:latest       swarm<span class="literal">-worker2</span>       Running             Running about an hour ago                       </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service scale helloworld=<span class="number">2</span>                                                                                   </span><br><span class="line">helloworld scaled to <span class="number">2</span></span><br><span class="line">overall progress: <span class="number">2</span> out of <span class="number">2</span> tasks </span><br><span class="line"><span class="number">1</span>/<span class="number">2</span>: running   [==================================================&gt;] </span><br><span class="line"><span class="number">2</span>/<span class="number">2</span>: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> </span><br></pre></td></tr></table></figure>
<p>可以看到已经从一个节点，扩展到两个节点。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">ps</span> helloworld     </span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class="line">bpopbylx99di        helloworld.<span class="number">1</span>        alpine:latest       swarm<span class="literal">-worker2</span>       Running             Running about an hour ago                       </span><br><span class="line">vr81swcln6s9        helloworld.<span class="number">2</span>        alpine:latest       swarm<span class="literal">-manager</span>       Running             Running <span class="number">45</span> seconds ago                          </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-7-删除服务"><a href="#9-3-7-删除服务" class="headerlink" title="9.3.7 删除服务"></a>9.3.7 删除服务</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">rm</span> helloworld </span><br><span class="line">helloworld</span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">ps</span> helloworld                                                                           </span><br><span class="line">no such service: helloworld</span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<p>命令 <code>docker service ps helloworld</code> 查看是否已删除</p>
<h4 id="9-3-8-滚动升级服务"><a href="#9-3-8-滚动升级服务" class="headerlink" title="9.3.8 滚动升级服务"></a>9.3.8 滚动升级服务</h4><p>介绍 redis 版本如何滚动升级至更高版本。这里创建一个 3.0.5 版本的 redis。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service create <span class="literal">--replicas</span> <span class="number">1</span> <span class="literal">--name</span> redis <span class="literal">--update-delay</span> <span class="number">10</span>s redis:<span class="number">3.0</span>.<span class="number">5</span> </span><br><span class="line">image redis:<span class="number">3.0</span>.<span class="number">5</span> could not be accessed on a registry to record</span><br><span class="line">its digest. Each node will access redis:<span class="number">3.0</span>.<span class="number">5</span> independently,</span><br><span class="line">possibly leading to different nodes running different</span><br><span class="line">versions of the image.</span><br><span class="line"></span><br><span class="line">t25x2wtwzxlkaybsijmshdjel</span><br><span class="line">overall progress: <span class="number">1</span> out of <span class="number">1</span> tasks </span><br><span class="line"><span class="number">1</span>/<span class="number">1</span>: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>滚动升级 redis 。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker service <span class="built_in">ps</span> redis                                                       </span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS</span><br><span class="line">k9yx1lkg8mef        redis.<span class="number">1</span>             redis:<span class="number">3.0</span>.<span class="number">7</span>         swarm<span class="literal">-manager</span>       Running             Running <span class="number">10</span> seconds ago                        </span><br><span class="line">ouanlbtgnjo9         \_ redis.<span class="number">1</span>         redis:<span class="number">3.0</span>.<span class="number">5</span>         swarm<span class="literal">-manager</span>       Shutdown            Shutdown <span class="number">10</span> seconds ago                       </span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<p>看图可以知道 redis 的版本已经从 3.0.5 升级到了 3.0.8，说明服务已经升级成功。</p>
<h4 id="9-3-9-停止某个节点接收新的任务"><a href="#9-3-9-停止某个节点接收新的任务" class="headerlink" title="9.3.9 停止某个节点接收新的任务"></a>9.3.9 停止某个节点接收新的任务</h4><p>查看所有的节点：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker node <span class="built_in">ls</span></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">qrywiizkesql8crxvyy9maafb *   swarm<span class="literal">-manager</span>       Ready               Active              Leader              <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">rr74dtx0mq67hskuaxt6kgx0w     swarm<span class="literal">-worker1</span>       Ready               Active                                  <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">am79rf9q1mo0tvu0otketbf4q     swarm<span class="literal">-worker2</span>       Ready               Active                                  <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<p>可以看到目前所有的节点都是 Active, 可以接收新的任务分配。</p>
<p>停止节点 swarm-worker2：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker node update <span class="literal">--availability</span> drain swarm<span class="literal">-worker2</span></span><br><span class="line">swarm<span class="literal">-worker2</span></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker node <span class="built_in">ls</span>                                                                                                                                  </span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">qrywiizkesql8crxvyy9maafb *   swarm<span class="literal">-manager</span>       Ready               Active              Leader              <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">rr74dtx0mq67hskuaxt6kgx0w     swarm<span class="literal">-worker1</span>       Ready               Active                                  <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">am79rf9q1mo0tvu0otketbf4q     swarm<span class="literal">-worker2</span>       Ready               Drain                                   <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：swarm-worker2 状态变为 Drain。不会影响到集群的服务，只是 swarm-worker2 节点不再接收新的任务，集群的负载能力有所下降。</p>
</blockquote>
<p>可以通过以下命令重新激活节点：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker node update <span class="literal">--availability</span> active swarm<span class="literal">-worker2</span></span><br><span class="line">swarm<span class="literal">-worker2</span></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span> docker node <span class="built_in">ls</span>                                                                                                                                  </span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">qrywiizkesql8crxvyy9maafb *   swarm<span class="literal">-manager</span>       Ready               Active              Leader              <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">rr74dtx0mq67hskuaxt6kgx0w     swarm<span class="literal">-worker1</span>       Ready               Active                                  <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">am79rf9q1mo0tvu0otketbf4q     swarm<span class="literal">-worker2</span>       Ready               Active                                  <span class="number">19.03</span>.<span class="number">12</span></span><br><span class="line">docker@swarm<span class="literal">-manager</span>:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h2 id="10-Docker-安装软件"><a href="#10-Docker-安装软件" class="headerlink" title="10. Docker 安装软件"></a>10. Docker 安装软件</h2><h3 id="10-1-Docker-安装-Centos"><a href="#10-1-Docker-安装-Centos" class="headerlink" title="10.1 Docker 安装 Centos"></a>10.1 Docker 安装 Centos</h3><p>Ubuntu 是基于 Debian 的 Linux 操作系统。</p>
<h4 id="10-1-1-查看可用的-Ubuntu-版本"><a href="#10-1-1-查看可用的-Ubuntu-版本" class="headerlink" title="10.1.1 查看可用的 Ubuntu 版本"></a>10.1.1 查看可用的 Ubuntu 版本</h4><p>访问 Ubuntu 镜像库地址： <a target="_blank" rel="noopener" href="https://hub.docker.com/_/ubuntu?tab=tags&amp;page=1。">https://hub.docker.com/_/ubuntu?tab=tags&amp;page=1。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.1%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84%20Ubuntu%20%E7%89%88%E6%9C%AC.png" style="zoom:50%;" /></p>
<p>也可以在下拉列表中找到其他想要的版本。</p>
<h4 id="10-1-2-拉取最新版的-Ubuntu-镜像"><a href="#10-1-2-拉取最新版的-Ubuntu-镜像" class="headerlink" title="10.1.2 拉取最新版的 Ubuntu 镜像"></a>10.1.2 拉取最新版的 Ubuntu 镜像</h4><p><code>docker pull ubuntu</code>或<code>docker pull ubuntu：latest</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull ubuntu</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line"><span class="number">6</span>e3729cf69e0: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">27</span>cb6e6ccef575a4698b66f5de06c7ecd61589132d5a91d098f7f3f9285415a9</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:latest</span><br><span class="line">docker.io/library/ubuntu:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-1-3-查看本地镜像"><a href="#10-1-3-查看本地镜像" class="headerlink" title="10.1.3 查看本地镜像"></a>10.1.3 查看本地镜像</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">ubuntu       latest    <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago   <span class="number">77.8</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>可以看到我们已经安装了最新版本的 ubuntu。</p>
<h4 id="10-1-4-运行容器，并且可以通过-exec-命令进入-ubuntu-容器"><a href="#10-1-4-运行容器，并且可以通过-exec-命令进入-ubuntu-容器" class="headerlink" title="10.1.4 运行容器，并且可以通过 exec 命令进入 ubuntu 容器"></a>10.1.4 运行容器，并且可以通过 exec 命令进入 ubuntu 容器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run -itd --name ubuntu-test1 ubuntu</span></span><br><span class="line">c281416b5c63869c864b8521819bf4c25e8097eff3bf273bee752ae41f265301</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-1-5安装成功"><a href="#10-1-5安装成功" class="headerlink" title="10.1.5安装成功"></a>10.1.5安装成功</h4><p>通过 <strong>docker ps</strong> 命令查看容器的运行信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED              STATUS              PORTS     NAMES</span><br><span class="line">c281416b5c63   ubuntu    <span class="string">&quot;bash&quot;</span>    About a minute ago   Up About a minute             ubuntu<span class="literal">-test1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="10-2-Docker-安装CentOS"><a href="#10-2-Docker-安装CentOS" class="headerlink" title="10.2 Docker 安装CentOS"></a>10.2 Docker 安装CentOS</h3><p>CentOS（Community Enterprise Operating System）是 Linux 发行版之一，它是来自于 Red Hat Enterprise Linux(RHEL) 依照开放源代码规定发布的源代码所编译而成。由于出自同样的源代码，因此有些要求高度稳定性的服务器以 CentOS 替代商业版的 Red Hat Enterprise Linux 使用。</p>
<h4 id="10-2-1-查看可用的-CentOS-版本"><a href="#10-2-1-查看可用的-CentOS-版本" class="headerlink" title="10.2.1 查看可用的 CentOS 版本"></a>10.2.1 查看可用的 CentOS 版本</h4><p>访问 CentOS 镜像库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/_/centos?tab=tags&amp;page=1。">https://hub.docker.com/_/centos?tab=tags&amp;page=1。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.2CentOS.png" style="zoom:50%;" /></p>
<h4 id="10-2-2-拉取指定版本的-CentOS-镜像，这里我们安装指定版本为例-centos7"><a href="#10-2-2-拉取指定版本的-CentOS-镜像，这里我们安装指定版本为例-centos7" class="headerlink" title="10.2.2 拉取指定版本的 CentOS 镜像，这里我们安装指定版本为例(centos7):"></a>10.2.2 拉取指定版本的 CentOS 镜像，这里我们安装指定版本为例(centos7):</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull centos:centos7</span></span><br><span class="line">centos7: Pulling from library/centos</span><br><span class="line"><span class="number">2</span>d473b07cdd5: Pull complete </span><br><span class="line">Digest: sha256:be65f488b7764ad3638f236b7b515b3678369a5124c47b8d32916d6487418ea4</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:centos7</span><br><span class="line">docker.io/library/centos:centos7</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-2-3-查看本地镜像"><a href="#10-2-3-查看本地镜像" class="headerlink" title="10.2.3 查看本地镜像"></a>10.2.3 查看本地镜像</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">ubuntu       latest    <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7   eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-2-4-运行容器，并且可以通过-exec-命令进入-CentOS-容器。"><a href="#10-2-4-运行容器，并且可以通过-exec-命令进入-CentOS-容器。" class="headerlink" title="10.2.4 运行容器，并且可以通过 exec 命令进入 CentOS 容器。"></a>10.2.4 运行容器，并且可以通过 exec 命令进入 CentOS 容器。</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run -itd --name centos-test centos:centos7</span></span><br><span class="line"><span class="number">81</span>cbdd935383d55fd41a7947e580310920d0e948d1d8bea80a696b767f437a33</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-2-5-安装成功"><a href="#10-2-5-安装成功" class="headerlink" title="10.2.5 安装成功"></a>10.2.5 安装成功</h4><p>通过 <strong>docker ps</strong> 命令查看容器的运行信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line"><span class="number">81</span>cbdd935383   centos:centos7   <span class="string">&quot;/bin/bash&quot;</span>   <span class="number">18</span> seconds ago   Up <span class="number">13</span> seconds             centos<span class="literal">-test</span></span><br><span class="line">c281416b5c63   ubuntu           <span class="string">&quot;bash&quot;</span>        <span class="number">31</span> minutes ago   Up <span class="number">31</span> minutes             ubuntu<span class="literal">-test1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h3 id="10-3-Docker-安装-Nginx"><a href="#10-3-Docker-安装-Nginx" class="headerlink" title="10.3 Docker 安装 Nginx"></a>10.3 Docker 安装 Nginx</h3><p>Nginx 是一个高性能的 HTTP 和反向代理 web 服务器，同时也提供了 IMAP/POP3/SMTP 服务 。</p>
<h4 id="10-3-1-查看可用的-Nginx-版本"><a href="#10-3-1-查看可用的-Nginx-版本" class="headerlink" title="10.3.1 查看可用的 Nginx 版本"></a>10.3.1 查看可用的 Nginx 版本</h4><p>访问 Nginx 镜像库地址： <a target="_blank" rel="noopener" href="https://hub.docker.com/_/nginx?tab=tags。">https://hub.docker.com/_/nginx?tab=tags。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.3NGINX.png" style="zoom:50%;" /></p>
<p>用 <strong>docker search nginx</strong> 命令来查看可用版本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker search nginx</span></span><br><span class="line">NAME                                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                                             Official build of Nginx.                        <span class="number">17948</span>     [<span class="type">OK</span>]       </span><br><span class="line">linuxserver/nginx                                 An Nginx container, brought to you by LinuxS…   <span class="number">183</span>                  </span><br><span class="line">bitnami/nginx                                     Bitnami nginx Docker Image                      <span class="number">150</span>                  [<span class="type">OK</span>]</span><br><span class="line">ubuntu/nginx                                      Nginx, a high<span class="literal">-performance</span> reverse proxy &amp; we…   <span class="number">75</span>                   </span><br><span class="line">bitnami/nginx<span class="literal">-ingress-controller</span>                  Bitnami Docker Image <span class="keyword">for</span> NGINX Ingress Contr…   <span class="number">23</span>                   [<span class="type">OK</span>]</span><br><span class="line">rancher/nginx<span class="literal">-ingress-controller</span>                                                                  <span class="number">11</span>                   </span><br><span class="line">kasmweb/nginx                                     An Nginx image based off nginx:alpine and <span class="keyword">in</span>…   <span class="number">4</span>                    </span><br><span class="line">ibmcom/nginx<span class="literal">-ingress-controller</span>                   Docker Image <span class="keyword">for</span> IBM Cloud Private<span class="literal">-CE</span> (Commu…   <span class="number">4</span>                    </span><br><span class="line">bitnami/nginx<span class="literal">-exporter</span>                                                                            <span class="number">3</span>                    </span><br><span class="line">bitnami/nginx<span class="literal">-ldap-auth-daemon</span>                                                                    <span class="number">3</span>                    </span><br><span class="line">rancher/nginx                                                                                     <span class="number">2</span>                    </span><br><span class="line">circleci/nginx                                    This image is <span class="keyword">for</span> internal use                  <span class="number">2</span>                    </span><br><span class="line">rancher/nginx<span class="literal">-ingress-controller-defaultbackend</span>                                                   <span class="number">2</span>                    </span><br><span class="line">rapidfort/nginx                                   RapidFort optimized, hardened image <span class="keyword">for</span> NGINX   <span class="number">2</span>                    </span><br><span class="line">vmware/nginx                                                                                      <span class="number">2</span>                    </span><br><span class="line">vmware/nginx<span class="literal">-photon</span>                                                                               <span class="number">1</span>                    </span><br><span class="line">bitnami/nginx<span class="literal">-intel</span>                                                                               <span class="number">1</span>                    </span><br><span class="line">wallarm/nginx<span class="literal">-ingress-controller</span>                  Kubernetes Ingress Controller with Wallarm e…   <span class="number">1</span>                    </span><br><span class="line">ibmcom/nginx<span class="literal">-ingress-controller-ppc64le</span>           Docker Image <span class="keyword">for</span> IBM Cloud Private<span class="literal">-CE</span> (Commu…   <span class="number">0</span>                    </span><br><span class="line">rancher/nginx<span class="literal">-conf</span>                                                                                <span class="number">0</span>                    </span><br><span class="line">rapidfort/nginx<span class="literal">-official</span>                          RapidFort optimized, hardened image <span class="keyword">for</span> NGIN…   <span class="number">0</span>                    </span><br><span class="line">ibmcom/nginx<span class="literal">-ppc64le</span>                              Docker image <span class="keyword">for</span> nginx<span class="literal">-ppc64le</span>                  <span class="number">0</span>                    </span><br><span class="line">rancher/nginx<span class="literal">-ssl</span>                                                                                 <span class="number">0</span>                    </span><br><span class="line">rapidfort/nginx<span class="literal">-ib</span>                                RapidFort optimized, hardened image <span class="keyword">for</span> NGIN…   <span class="number">0</span>                    </span><br><span class="line">continuumio/nginx<span class="literal">-ingress-ws</span>                                                                      <span class="number">0</span>                    </span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-3-2-取最新版的-Nginx-镜像"><a href="#10-3-2-取最新版的-Nginx-镜像" class="headerlink" title="10.3.2 取最新版的 Nginx 镜像"></a>10.3.2 取最新版的 Nginx 镜像</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull nginx:latest</span></span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line"><span class="number">8740</span>c948ffd4: Pull complete </span><br><span class="line">d2c0556a17c5: Pull complete </span><br><span class="line">c8b9881f2c6a: Pull complete </span><br><span class="line"><span class="number">693</span>c3ffa8f43: Pull complete </span><br><span class="line"><span class="number">8316</span>c5e80e6d: Pull complete </span><br><span class="line">b2fe3577faa4: Pull complete </span><br><span class="line">Digest: sha256:b8f2383a95879e1ae064940d9a200f67a6c79e710ed82ac42263397367e7cc4e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-3-3-查看本地镜像是否已安装了-nginx："><a href="#10-3-3-查看本地镜像是否已安装了-nginx：" class="headerlink" title="10.3.3 查看本地镜像是否已安装了 nginx："></a>10.3.3 查看本地镜像是否已安装了 nginx：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        latest    a99a39d070bf   <span class="number">6</span> days ago      <span class="number">142</span>MB</span><br><span class="line">ubuntu       latest    <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7   eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>可以看到我们已经安装了最新版本（latest）的 nginx 镜像。</p>
<h4 id="10-3-4-运行容器"><a href="#10-3-4-运行容器" class="headerlink" title="10.3.4 运行容器"></a>10.3.4 运行容器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run --name nginx-test -p 8080:80 -d nginx</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab9704b2f6f175f1d6e5fd5e1c36b39740c3c4341743d821129a12</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>—name nginx-test</strong>：容器名称。</li>
<li><strong>-p 8080:80</strong>： 端口进行映射，将本地 8080 端口映射到容器内部的 80 端口。</li>
<li><strong>-d nginx</strong>： 设置容器在在后台一直运行。</li>
</ul>
<h4 id="10-3-5-安装成功"><a href="#10-3-5-安装成功" class="headerlink" title="10.3.5 安装成功"></a>10.3.5 安装成功</h4><p>通过浏览器可以直接访问 8080 端口的 nginx 服务：</p>
<p><img src="../../../../../DockerLearning/md_imgs/10.3NGINXweb.png" style="zoom:50%;" /></p>
<h3 id="10-4-Docker-安装-Node-js"><a href="#10-4-Docker-安装-Node-js" class="headerlink" title="10.4 Docker 安装 Node.js"></a>10.4 Docker 安装 Node.js</h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，是一个让 JavaScript 运行在服务端的开发平台。</p>
<h4 id="10-4-1-查看可用的-Node-版本"><a href="#10-4-1-查看可用的-Node-版本" class="headerlink" title="10.4.1 查看可用的 Node 版本"></a>10.4.1 查看可用的 Node 版本</h4><p>访问 Node 镜像库地址： <a target="_blank" rel="noopener" href="https://hub.docker.com/_/node?tab=tags。">https://hub.docker.com/_/node?tab=tags。</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/kungs8/blog_imgs/dockerLearning_imgs_10.4node.png" alt=""></p>
<p>用 <strong>docker search node</strong> 命令来查看可用版本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker search node</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">node                              Node.js is a JavaScript<span class="literal">-based</span> platform <span class="keyword">for</span> s…   <span class="number">12278</span>     [<span class="type">OK</span>]       </span><br><span class="line">mongo<span class="literal">-express</span>                     Web<span class="literal">-based</span> MongoDB admin interface, written w…   <span class="number">1274</span>      [<span class="type">OK</span>]       </span><br><span class="line">nodered/node<span class="literal">-red</span>                  Low<span class="literal">-code</span> programming <span class="keyword">for</span> event<span class="literal">-driven</span> applic…   <span class="number">545</span>                  </span><br><span class="line">nodered/node<span class="literal">-red-docker</span>           Deprecated - older Node<span class="literal">-RED</span> Docker images.      <span class="number">357</span>                  [<span class="type">OK</span>]</span><br><span class="line">circleci/node                     Node.js is a JavaScript<span class="literal">-based</span> platform <span class="keyword">for</span> s…   <span class="number">130</span>                  </span><br><span class="line">kindest/node                      sigs.k8s.io/kind node image                     <span class="number">78</span>                   </span><br><span class="line">bitnami/node                      Bitnami Node.js Docker Image                    <span class="number">69</span>                   [<span class="type">OK</span>]</span><br><span class="line">cimg/node                         The CircleCI Node.js Docker Convenience Imag…   <span class="number">14</span>                   </span><br><span class="line">opendronemap/nodeodm              Automated build <span class="keyword">for</span> NodeODM                     <span class="number">10</span>                   [<span class="type">OK</span>]</span><br><span class="line">bitnami/node<span class="literal">-exporter</span>             Bitnami Node Exporter Docker Image              <span class="number">9</span>                    [<span class="type">OK</span>]</span><br><span class="line">appdynamics/nodejs<span class="literal">-agent</span>          Agent <span class="keyword">for</span> monitoring Node.js applications       <span class="number">5</span>                    </span><br><span class="line">wallarm/node                      Wallarm: <span class="keyword">end</span><span class="literal">-to-end</span> API security solution       <span class="number">5</span>                    [<span class="type">OK</span>]</span><br><span class="line">nodered/node<span class="literal">-red-dev</span>              Dev/Test builds <span class="keyword">for</span> Node<span class="literal">-RED</span> project (NOT st…   <span class="number">4</span>                    </span><br><span class="line">sysdig/node<span class="literal">-image-analyzer</span>        <span class="keyword">In</span> cluster component that allows scanning im…   <span class="number">2</span>                    </span><br><span class="line">okteto/node                                                                       <span class="number">2</span>                    </span><br><span class="line">openwhisk/nodejs6action           Apache OpenWhisk runtime <span class="keyword">for</span> Node.js v6 Acti…   <span class="number">2</span>                    [<span class="type">OK</span>]</span><br><span class="line">bitnami/node<span class="literal">-snapshot</span>                                                             <span class="number">1</span>                    </span><br><span class="line">ibmcom/node<span class="literal">-exporter-ppc64le</span>      Docker Image <span class="keyword">for</span> IBM Cloud Private<span class="literal">-CE</span> (Commu…   <span class="number">0</span>                    </span><br><span class="line">ibmcom/node<span class="literal">-exporter</span>              Docker Image <span class="keyword">for</span> IBM Cloud Private<span class="literal">-CE</span> (Commu…   <span class="number">0</span>                    </span><br><span class="line">docker/node<span class="literal">-agent-k8s</span>                                                             <span class="number">0</span>                    </span><br><span class="line">ibmcom/nodejs<span class="literal">-mobile-foundation</span>                                                   <span class="number">0</span>                    </span><br><span class="line">rancher/node<span class="literal">-simulator</span>                                                            <span class="number">0</span>                    </span><br><span class="line">ibmcom/node<span class="literal">-for-redis</span>                                                             <span class="number">0</span>                    </span><br><span class="line">purestorage/node<span class="literal">-config</span>           image <span class="keyword">for</span> configuring node to install tools …   <span class="number">0</span>                    </span><br><span class="line">vmware/node                       Node.js base built on top of Photon OS          <span class="number">0</span>                    [<span class="type">OK</span>]</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-4-2-取最新版的-node-镜像"><a href="#10-4-2-取最新版的-node-镜像" class="headerlink" title="10.4.2 取最新版的 node 镜像"></a>10.4.2 取最新版的 node 镜像</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull node:latest</span></span><br><span class="line">latest: Pulling from library/node</span><br><span class="line">bbeef03cda1f: Pull complete </span><br><span class="line">f049f75f014e: Pull complete </span><br><span class="line"><span class="number">56261</span>d0e6b05: Pull complete </span><br><span class="line"><span class="number">9</span>bd150679dbd: Pull complete </span><br><span class="line"><span class="number">5</span>b282ee9da04: Pull complete </span><br><span class="line"><span class="number">8</span>bc43c905b24: Pull complete </span><br><span class="line"><span class="number">3</span>ce9e21024ae: Pull complete </span><br><span class="line"><span class="number">36</span>d91be124f1: Pull complete </span><br><span class="line"><span class="number">7</span>d6b04e90455: Pull complete </span><br><span class="line">Digest: sha256:c1d6d7364e956b061d62241c362b3cd0856beba066ec60e25523a169e2137623</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> node:latest</span><br><span class="line">docker.io/library/node:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h4 id="10-4-3查看本地镜像是否已安装了-node"><a href="#10-4-3查看本地镜像是否已安装了-node" class="headerlink" title="10.4.3查看本地镜像是否已安装了 node"></a>10.4.3查看本地镜像是否已安装了 node</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">node         latest    <span class="number">51</span>bd6c84a7f2   <span class="number">6</span> days ago      <span class="number">998</span>MB</span><br><span class="line">nginx        latest    a99a39d070bf   <span class="number">6</span> days ago      <span class="number">142</span>MB</span><br><span class="line">ubuntu       latest    <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7   eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>可以看到我们已经安装了最新版本（latest）的 node 镜像。</p>
<h4 id="10-4-4-运行容器"><a href="#10-4-4-运行容器" class="headerlink" title="10.4.4 运行容器"></a>10.4.4 运行容器</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run -itd --name node-test node</span></span><br><span class="line"><span class="number">5</span>c3af81aab8da4da7d4bed00142711c9f565557eae37b9ce2ca2799e35f6eed3</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>—name node-test</strong>：容器名称。</li>
</ul>
<h4 id="10-4-5-安装成功"><a href="#10-4-5-安装成功" class="headerlink" title="10.4.5 安装成功"></a>10.4.5 安装成功</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it node-test /bin/bash</span></span><br><span class="line">root@<span class="number">5</span>c3af81aab8d:/<span class="comment"># node -v</span></span><br><span class="line">v19.<span class="number">4.0</span></span><br><span class="line">root@<span class="number">5</span>c3af81aab8d:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h2 id="11-Docker命令大全"><a href="#11-Docker命令大全" class="headerlink" title="11. Docker命令大全"></a>11. Docker命令大全</h2><h3 id="11-1-容器生命周期管理"><a href="#11-1-容器生命周期管理" class="headerlink" title="11.1 容器生命周期管理"></a>11.1 容器生命周期管理</h3><h4 id="11-1-1-run"><a href="#11-1-1-run" class="headerlink" title="11.1.1 run"></a>11.1.1 run</h4><p>创建一个新的容器并运行一个命令</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [<span class="type">OPTIONS</span>] IMAGE [<span class="type">COMMAND</span>] [<span class="type">ARG...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-a stdin:</strong> 指定标准输入输出内容类型，可选 STDIN/STDOUT/STDERR 三项；</li>
<li><strong>-d:</strong> 后台运行容器，并返回容器ID；</li>
<li><strong>-i:</strong> 以交互模式运行容器，通常与 -t 同时使用；</li>
<li><strong>-P:</strong> 随机端口映射，容器内部端口<strong>随机</strong>映射到主机的端口</li>
<li><strong>-p:</strong> 指定端口映射，格式为：<strong>主机(宿主)端口:容器端口</strong></li>
<li><strong>-t:</strong> 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</li>
<li><strong>—name=”nginx-lb”:</strong> 为容器指定一个名称；</li>
<li><strong>—dns 8.8.8.8:</strong> 指定容器使用的DNS服务器，默认和宿主一致；</li>
<li><strong>—dns-search example.com:</strong> 指定容器DNS搜索域名，默认和宿主一致；</li>
<li><strong>-h “mars”:</strong> 指定容器的hostname；</li>
<li><strong>-e username=”ritchie”:</strong> 设置环境变量；</li>
<li><strong>—env-file=[]:</strong> 从指定文件读入环境变量；</li>
<li><strong>—cpuset=”0-2” or —cpuset=”0,1,2”:</strong> 绑定容器到指定CPU运行；</li>
<li><strong>-m :</strong>设置容器使用内存最大值；</li>
<li><strong>—net=”bridge”:</strong> 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型；</li>
<li><strong>—link=[]:</strong> 添加链接到另一个容器；</li>
<li><strong>—expose=[]:</strong> 开放一个端口或一组端口；</li>
<li><strong>—volume , -v:</strong> 绑定一个卷</li>
</ul>
</li>
<li><p>实例</p>
<p>使用docker镜像nginx:latest以后台模式启动一个容器,并将容器命名为mynginx。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="literal">--name</span> mynginx <span class="literal">-d</span> nginx:latest</span><br></pre></td></tr></table></figure>
<p>使用镜像nginx:latest以后台模式启动一个容器,并将容器的80端口映射到主机随机端口。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="literal">-P</span> <span class="literal">-d</span> nginx:latest</span><br></pre></td></tr></table></figure>
<p>使用镜像 nginx:latest，以后台模式启动一个容器,将容器的 80 端口映射到主机的 80 端口,主机的目录 /data 映射到容器的 /data。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="literal">-p</span> <span class="number">80</span>:<span class="number">80</span> <span class="literal">-v</span> /<span class="keyword">data</span>:/<span class="keyword">data</span> <span class="literal">-d</span> nginx:latest</span><br></pre></td></tr></table></figure>
<p>绑定容器的 8080 端口，并将其映射到本地主机 127.0.0.1 的 80 端口上。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> docker run <span class="literal">-p</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span>:<span class="number">8080</span>/tcp ubuntu bash</span><br></pre></td></tr></table></figure>
<p>使用镜像nginx:latest以交互模式启动一个容器,在容器内执行/bin/bash命令。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run -it nginx:latest /bin/bash</span></span><br><span class="line">root@<span class="number">9</span>f7e293c70ab:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 Docker 容器退出时，默认容器内部的文件系统仍然被保留，以方便调试并保留用户数据。</p>
<p>但是，对于 foreground 容器，由于其只是在开发调试过程中短期运行，其用户数据并无保留的必要，因而可以在容器启动时设置 <strong>—rm</strong> 选项，这样在容器退出时就能够自动清理容器内部的文件系统。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="literal">--rm</span> yanpenggong1</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="literal">--rm</span>=true yanpenggong1</span><br></pre></td></tr></table></figure>
<p>==注意==：<strong>—rm</strong> 选项不能与 <strong>-d</strong> 同时使用（或者说同时使用没有意义），即只能自动清理 foreground 容器，不能自动清理detached容器。</p>
<p>==注意==，<strong>—rm</strong> 选项也会清理容器的匿名data volumes。</p>
<p>执行 <strong>docker run</strong> 命令带 <strong>—rm</strong>命令选项，等价于在容器退出后，执行 <strong>docker rm -v</strong>。</p>
</blockquote>
</li>
</ol>
<h4 id="11-1-2-start-stop-restart"><a href="#11-1-2-start-stop-restart" class="headerlink" title="11.1.2 start|stop|restart"></a>11.1.2 start|stop|restart</h4><ol>
<li><p>语法</p>
<ul>
<li><p>启动一个或多个已经被停止的容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">start</span> [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>停止一个运行中的容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>启动已被停止的容器 <code>yanpenggong1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">start</span> yanpenggong1</span><br></pre></td></tr></table></figure>
</li>
<li><p>停止运行中的容器 <code>yanpenggong1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop yanpenggong1</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启容器 <code>yanpenggong1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart yanpenggong1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-1-3-kill"><a href="#11-1-3-kill" class="headerlink" title="11.1.3 kill"></a>11.1.3 kill</h4><p>杀掉一个运行中的容器</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-s :</strong> 向容器发送一个信号</li>
</ul>
</li>
<li><p>实例</p>
<p>杀掉运行中的容器mynginx</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker kill -s KILL mynginx</span></span><br><span class="line">mynginx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-1-4-rm"><a href="#11-1-4-rm" class="headerlink" title="11.1.4 rm"></a>11.1.4 rm</h4><p>删除一个或多个容器</p>
<ol>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f :</strong> 通过 SIGKILL 信号强制删除一个运行中的容器。</li>
<li><strong>-l :</strong> 移除容器间的网络连接，而非容器本身。</li>
<li><strong>-v :</strong> 删除与容器关联的卷。</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>强制删除容器 db01、db02：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="operator">-f</span> db01 db02</span><br></pre></td></tr></table></figure>
</li>
<li><p>移除容器 nginx01 对容器 db01 的连接，连接名 db：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="literal">-l</span> db </span><br></pre></td></tr></table></figure>
</li>
<li><p>删除容器 nginx01, 并删除容器挂载的数据卷：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="literal">-v</span> nginx01</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>删除所有已经停止的容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="variable">$</span>(docker <span class="built_in">ps</span> <span class="literal">-a</span> <span class="literal">-q</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="11-1-5-pause-unpause"><a href="#11-1-5-pause-unpause" class="headerlink" title="11.1.5 pause|unpause"></a>11.1.5 pause|unpause</h4><ol>
<li><p>语法</p>
<ul>
<li><p>暂停容器中所有的进程。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pause CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>恢复容器中所有的进程。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker unpause CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>暂停数据库容器db01提供服务。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pause db01</span><br></pre></td></tr></table></figure>
</li>
<li><p>恢复数据库容器 db01 提供服务。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker unpause db01</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-1-6-create"><a href="#11-1-6-create" class="headerlink" title="11.1.6 create"></a>11.1.6 create</h4><p>创建一个新的容器但不启动它</p>
<p>用法同 <code>docker run</code></p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create [<span class="type">OPTIONS</span>] IMAGE [<span class="type">COMMAND</span>] [<span class="type">ARG...</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<p>使用docker镜像 <code>nginx:latest</code> 创建一个容器,并将容器命名为<code>yanpenggong1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker create  --name yanpenggong1  nginx:latest</span></span><br><span class="line">ab1aa65cb3d1d6180de62b890a9caddaada09e8edaf43f1facd3872eb1053784</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-1-7-exec"><a href="#11-1-7-exec" class="headerlink" title="11.1.7 exec"></a>11.1.7 exec</h4><p>在运行的容器中执行命令</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec [<span class="type">OPTIONS</span>] CONTAINER COMMAND [<span class="type">ARG...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-d :</strong>分离模式: 在后台运行</li>
<li><strong>-i :</strong>即使没有附加也保持STDIN 打开</li>
<li><strong>-t :</strong>分配一个伪终端</li>
</ul>
</li>
<li><p>实例</p>
<blockquote>
<p><strong>前期准备工作：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it yanpenggong1 /bin/bash</span></span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># apt-get update</span></span><br><span class="line">...</span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># apt-get upgrade</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">Calculating upgrade... Done</span><br><span class="line"><span class="number">0</span> upgraded, <span class="number">0</span> newly installed, <span class="number">0</span> to remove and <span class="number">0</span> not upgraded.</span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># apt-get install vim</span></span><br><span class="line">...</span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># vim /root/yanpenggong.sh</span></span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># cat /root/yanpenggong.sh </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Welcome yanpenggong, Come on!&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>在容器 mynginx 中以交互模式执行容器内 <code>/root/yanpenggong1.sh</code> 脚本:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it yanpenggong1 /bin/bash /root/yanpenggong.sh</span></span><br><span class="line">Welcome yanpenggong, Come on!</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>在容器 mynginx 中开启一个交互模式的终端:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it yanpenggong1 /bin/bash</span></span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>也可以通过 <strong>docker ps -a</strong> 命令查看已经在运行的容器，然后使用容器 ID 进入容器。</p>
<p>查看已经在运行的容器 ID：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps -a </span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS                     PORTS                 </span><br><span class="line">...</span><br><span class="line">ab1aa65cb3d1   nginx:latest     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago    Up <span class="number">30</span> minutes              <span class="number">80</span>/tcp                                              yanpenggong1</span><br><span class="line">...</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>第一列的 <code>ab1aa65cb3d1</code> 就是容器 ID。</p>
<p>通过 exec 命令对指定的容器执行 bash:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it ab1aa65cb3d1 /bin/bash</span></span><br><span class="line">root@ab1aa65cb3d1:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="11-2-容器操作"><a href="#11-2-容器操作" class="headerlink" title="11.2 容器操作"></a>11.2 容器操作</h3><h4 id="11-2-1-ps"><a href="#11-2-1-ps" class="headerlink" title="11.2.1 ps"></a>11.2.1 ps</h4><p>列出容器</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">ps</span> [<span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><p><strong>-a :</strong>显示所有的容器，包括未运行的。</p>
</li>
<li><p><strong>-f :</strong>根据条件过滤显示的内容。</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>—format :</strong>指定返回值的模板文件。</p>
</li>
<li><p><strong>-l :</strong>显示最近创建的容器。</p>
</li>
<li><p><strong>-n :</strong>列出最近创建的n个容器。</p>
</li>
<li><p><strong>—no-trunc :</strong>不截断输出。</p>
</li>
<li><p><strong>-q :</strong>静默模式，只显示容器编号。</p>
</li>
<li><p><strong>-s :</strong>显示总的文件大小。</p>
</li>
</ul>
<ol>
<li><p>实例</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS          PORTS                                               NAMES</span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago    Up <span class="number">2</span> hours      <span class="number">80</span>/tcp, <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp, :::<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp   nginx<span class="literal">-yanpenggong</span></span><br><span class="line">ab1aa65cb3d1   nginx:latest     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago    Up <span class="number">45</span> minutes   <span class="number">80</span>/tcp                                              yanpenggong1</span><br><span class="line">d4048088ff57   php:<span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>    <span class="string">&quot;docker-php-entrypoi…&quot;</span>   <span class="number">19</span> hours ago   Up <span class="number">19</span> hours     <span class="number">9000</span>/tcp                                            myphp<span class="literal">-fpm</span></span><br><span class="line"><span class="number">5</span>c3af81aab8d   node             <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">21</span> hours ago   Up <span class="number">21</span> hours                                                         node<span class="literal">-test</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">22</span> hours ago   Up <span class="number">22</span> hours     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp, :::<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp               nginx<span class="literal">-test</span></span><br><span class="line"><span class="number">81</span>cbdd935383   centos:centos7   <span class="string">&quot;/bin/bash&quot;</span>              <span class="number">22</span> hours ago   Up <span class="number">22</span> hours                                                         centos<span class="literal">-test</span></span><br><span class="line">c281416b5c63   ubuntu           <span class="string">&quot;bash&quot;</span>                   <span class="number">22</span> hours ago   Up <span class="number">22</span> hours                                                         ubuntu<span class="literal">-test1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>输出详情介绍：</p>
<ul>
<li><p><strong>CONTAINER ID:</strong> 容器 ID。</p>
</li>
<li><p><strong>IMAGE:</strong> 使用的镜像。</p>
</li>
<li><p><strong>COMMAND:</strong> 启动容器时运行的命令。</p>
</li>
<li><p><strong>CREATED:</strong> 容器的创建时间。</p>
</li>
<li><p><strong>STATUS:</strong> 容器状态。状态有7种：</p>
<ul>
<li><p>created（已创建）</p>
</li>
<li><p>restarting（重启中）</p>
</li>
<li><p>running（运行中）</p>
</li>
<li><p>removing（迁移中）</p>
</li>
<li><p>paused（暂停）</p>
</li>
<li><p>exited（停止）</p>
</li>
<li><p>dead（死亡）</p>
</li>
</ul>
</li>
<li><p><strong>PORTS:</strong> 容器的端口信息和使用的连接类型（tcp\udp）。</p>
</li>
<li><p><strong>NAMES:</strong> 自动分配的容器名称。</p>
</li>
</ul>
<p>列出最近创建的5个容器信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps -n 5</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED       STATUS                     PORTS                                               NAMES</span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx          <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Up <span class="number">2</span> hours                 <span class="number">80</span>/tcp, <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp, :::<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp   nginx<span class="literal">-yanpenggong</span></span><br><span class="line">e7ed1ae97d71   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Exited (<span class="number">0</span>) <span class="number">2</span> hours ago                                                         friendly_pascal</span><br><span class="line">ab1aa65cb3d1   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Up <span class="number">46</span> minutes              <span class="number">80</span>/tcp                                              yanpenggong1</span><br><span class="line"><span class="number">9</span>ee8936ebfb4   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Exited (<span class="number">0</span>) <span class="number">2</span> hours ago                                                         cool_herschel</span><br><span class="line"><span class="number">9</span>f7e293c70ab   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Exited (<span class="number">127</span>) <span class="number">2</span> hours ago                                                       angry_liskov</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>列出所有创建的容器ID。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps -a -q</span></span><br><span class="line"><span class="number">565</span>fab9cc1d6</span><br><span class="line">e7ed1ae97d71</span><br><span class="line">ab1aa65cb3d1</span><br><span class="line"><span class="number">9</span>ee8936ebfb4</span><br><span class="line"><span class="number">9</span>f7e293c70ab</span><br><span class="line">e9ec935b0a03</span><br><span class="line">d4048088ff57</span><br><span class="line"><span class="number">5</span>c3af81aab8d</span><br><span class="line"><span class="number">5</span>f1b0abb64ab</span><br><span class="line"><span class="number">81</span>cbdd935383</span><br><span class="line">c281416b5c63</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong>根据条件过滤显示的内容:</strong></p>
<ul>
<li><p>根据标签过滤</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker run -d --name=nginx-labelset --label color=blue nginx</span></span><br><span class="line"><span class="number">76</span>febf58a85a95ae00dc36ac7397fa4b95e666090686a02dc5e1e9d344b5da38</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter &quot;label=color&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line"><span class="number">76</span>febf58a85a   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">22</span> seconds ago   Up <span class="number">21</span> seconds   <span class="number">80</span>/tcp    nginx<span class="literal">-labelset</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter &quot;label=color=blue&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line"><span class="number">76</span>febf58a85a   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">28</span> seconds ago   Up <span class="number">27</span> seconds   <span class="number">80</span>/tcp    nginx<span class="literal">-labelset</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据名称过滤</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter &quot;name=nginx-labelset&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS     NAMES</span><br><span class="line"><span class="number">76</span>febf58a85a   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Up About a minute   <span class="number">80</span>/tcp    nginx<span class="literal">-labelset</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据状态过滤</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps -a --filter &quot;exited=0&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED       STATUS                   PORTS     NAMES</span><br><span class="line">e7ed1ae97d71   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Exited (<span class="number">0</span>) <span class="number">2</span> hours ago             friendly_pascal</span><br><span class="line"><span class="number">9</span>ee8936ebfb4   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago   Exited (<span class="number">0</span>) <span class="number">2</span> hours ago             cool_herschel</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter status=running</span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND                  CREATED         STATUS          PORTS                                               NAMES</span><br><span class="line"><span class="number">76</span>febf58a85a   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">3</span> minutes ago   Up <span class="number">3</span> minutes    <span class="number">80</span>/tcp                                              nginx<span class="literal">-labelset</span></span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago     Up <span class="number">2</span> hours      <span class="number">80</span>/tcp, <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp, :::<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp   nginx<span class="literal">-yanpenggong</span></span><br><span class="line">ab1aa65cb3d1   nginx:latest     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">2</span> hours ago     Up <span class="number">51</span> minutes   <span class="number">80</span>/tcp                                              yanpenggong1</span><br><span class="line">d4048088ff57   php:<span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>    <span class="string">&quot;docker-php-entrypoi…&quot;</span>   <span class="number">19</span> hours ago    Up <span class="number">19</span> hours     <span class="number">9000</span>/tcp                                            myphp<span class="literal">-fpm</span></span><br><span class="line"><span class="number">5</span>c3af81aab8d   node             <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">22</span> hours ago    Up <span class="number">22</span> hours                                                         node<span class="literal">-test</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">22</span> hours ago    Up <span class="number">22</span> hours     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp, :::<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp               nginx<span class="literal">-test</span></span><br><span class="line"><span class="number">81</span>cbdd935383   centos:centos7   <span class="string">&quot;/bin/bash&quot;</span>              <span class="number">22</span> hours ago    Up <span class="number">22</span> hours                                                         centos<span class="literal">-test</span></span><br><span class="line">c281416b5c63   ubuntu           <span class="string">&quot;bash&quot;</span>                   <span class="number">22</span> hours ago    Up <span class="number">22</span> hours                                                         ubuntu<span class="literal">-test1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter status=paused</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据镜像过滤</p>
<ul>
<li><p><strong>镜像名称</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter ancestor=yanpenggong1</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>镜像ID</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter ancestor=ab1aa65cb3d1</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>根据启动顺序过滤</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter before=565fab9cc1d6</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps --filter since=565fab9cc1d6</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-2-2-inspect"><a href="#11-2-2-inspect" class="headerlink" title="11.2.2 inspect"></a>11.2.2 inspect</h4><p> 获取容器/镜像的元数据。</p>
<ol>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f :</strong>指定返回值的模板文件。</li>
<li><strong>-s :</strong>显示总的文件大小。</li>
<li><strong>—type :</strong>为指定类型返回 JSON。</li>
</ul>
</li>
<li><p>实例</p>
<p>获取镜像 mysql:5.7 的元信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker inspect mysql:5.7</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;sha256:e982339a20a53052bd5f2b2e8438b3c95c91013f653ee781a67934cd1f9f9631&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RepoTags&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;mysql:5.7&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;RepoDigests&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;mysql@sha256:f04fc2e2f01e65d6e2828b4cce2c4761d9258aee71d989e273b2ae309f44a945&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Parent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Comment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2023-01-17T21:08:43.190102558Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Container&quot;</span>: <span class="string">&quot;0986b6641b52d0f008c86df95549764df209daf54453c8ae1585823822ea24e7&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ContainerConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;0986b6641b52&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;3306/tcp&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;33060/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;GOSU_VERSION=1.14&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_MAJOR=5.7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_VERSION=5.7.41-1.el7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_SHELL_VERSION=8.0.32-1.el7&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;#(nop) &quot;</span>,</span><br><span class="line">                <span class="string">&quot;CMD [\&quot;</span><span class="type">mysqld</span>\<span class="string">&quot;]&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:dbef667589a9b91b3a5c92717cd272365c6af916b218e357277837b0f447e3e3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;/var/lib/mysql&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;docker-entrypoint.sh&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;DockerVersion&quot;</span>: <span class="string">&quot;20.10.12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;3306/tcp&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;33060/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="type">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;GOSU_VERSION=1.14&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_MAJOR=5.7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_VERSION=5.7.41-1.el7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MYSQL_SHELL_VERSION=8.0.32-1.el7&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;mysqld&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:dbef667589a9b91b3a5c92717cd272365c6af916b218e357277837b0f447e3e3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;/var/lib/mysql&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;docker-entrypoint.sh&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: <span class="type">null</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;amd64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Size&quot;</span>: <span class="number">451547844</span>,</span><br><span class="line">        <span class="string">&quot;VirtualSize&quot;</span>: <span class="number">451547844</span>,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/ef0961e2e6aab1506df05b62e97e01d08e701b726b54537b24b9c4c16c024b2a/diff:/var/lib/docker/overlay2/614ebd76596a654735feb8e2f02179b830dc01e18fc73ff51ba369eb9d4305f1/diff:/var/lib/docker/overlay2/beff48d6417ae0ec536cf6885716e36cba4816b436419774c952e6c975d286a2/diff:/var/lib/docker/overlay2/c4877779ab5e00499e5a0cbf2e316c3ff3067a5355ee24d2b249564c15f5650e/diff:/var/lib/docker/overlay2/b1804f8b6eab76ec28f336e6deba72d9d6b081732f77774dd64ae60f6ccd6ca6/diff:/var/lib/docker/overlay2/fde9ec916ffc6d5a4eb7002f98541a1a5e1512e247ba1c6dcd0209cad5583957/diff:/var/lib/docker/overlay2/41e4c8924e80a6a72a376bc9a3be6ae1fde0874652918e5c5fd803e023c18845/diff:/var/lib/docker/overlay2/ad8ede93da1142c1dc043658204ab5fd2402b8fd2a24ce921406e3fa8e3a1987/diff:/var/lib/docker/overlay2/63d5fabc079fd5e454df0710c2dcbb2ee39d190c44f97a84016fc133ea9ac25f/diff:/var/lib/docker/overlay2/cc89d6ef19a9bbf01a30cc7b5eb97142cc9239359ceb99545c1a770360aea90a/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/c310ac5e33624289534acb8d52701991e2342bad5a12698f493858d666aa3d6e/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/c310ac5e33624289534acb8d52701991e2342bad5a12698f493858d666aa3d6e/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/c310ac5e33624289534acb8d52701991e2342bad5a12698f493858d666aa3d6e/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:62d9c4cbe8f4b26952ebb533b5336bf7af791db2b4288df65c9a685e1f2530cd&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:49769e21013b6fea06035a5dcdbed32ce7c17b66b8a19eab8ce626a492d4e045&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:1a26f263a6af50cde950eb9059948fbc1ae332b27d4f248064838e8233d98781&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:1ab9edd16f9eb635e5240ae4167f8556b742f3b95047c98d43893f2e2bffe064&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:56a71f69f1a80e8e96b53f062f47abb507c71dd418a8cf9037dd141e45dd2b96&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:45968403dd22f9dfd92bc4c0a3349a0919abe64a62ebf85ecd3dbc386e17b15d&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:f4bb02745d0337d503a510f28b98ac101bb9916eff4bd51b6ea108fffc01b567&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:c1f1b5039e40f8c152f16f83d2bd382aea116e5d26779096dfb87a612f4366c8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:e974776afbe2457e7c63f3d6b8c66aa4942414252d5af613904eacb11d0f4b44&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:868b2e381adfd7f4f912f3add73f60e9ec7f3c18937d7f08ffec29d60a24b0e7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:5c542b9ec644bfc9eeace71cf555f9b7ca6ad7e657eb7863aebc1367e1b101d7&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Metadata&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;LastTagTime&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>获取正在运行的容器 <code>mysql-test</code> 的 IP，注意这里<code>mysql-test</code>是容器名称。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker inspect --format=&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; mysql-test</span></span><br><span class="line"><span class="number">172.17</span>.<span class="number">0.10</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-3-top"><a href="#11-2-3-top" class="headerlink" title="11.2.3 top"></a>11.2.3 top</h4><p>查看容器中运行的进程信息，支持 ps 命令参数。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">ps</span> <span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
<p>容器运行时不一定有<code>/bin/bash</code>终端来交互执行top命令，而且容器还不一定有<code>top</code>命令，可以使用<code>docker top</code>来实现查看 container 中正在运行的进程。</p>
</li>
<li><p>实例</p>
<p>查看容器<code>mysql-test</code> 的进程信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker top mysql-test</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">polkitd             <span class="number">42708</span>               <span class="number">42687</span>               <span class="number">0</span>                   <span class="number">00</span>:<span class="number">43</span>               pts/<span class="number">0</span>               <span class="number">00</span>:<span class="number">00</span>:<span class="number">09</span>            mysqld</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>查看所有运行容器的进程信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># for i in  `docker ps |grep Up|awk &#x27;&#123;print $1&#125;&#x27;`;do echo \ &amp;&amp;docker top $i; done</span></span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">polkitd             <span class="number">42708</span>               <span class="number">42687</span>               <span class="number">0</span>                   <span class="number">00</span>:<span class="number">43</span>               pts/<span class="number">0</span>               <span class="number">00</span>:<span class="number">00</span>:<span class="number">09</span>            mysqld</span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">39930</span>               <span class="number">39910</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: master <span class="keyword">process</span> nginx <span class="literal">-g</span> daemon off;</span><br><span class="line"><span class="number">101</span>                 <span class="number">39980</span>               <span class="number">39930</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"><span class="number">101</span>                 <span class="number">39981</span>               <span class="number">39930</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">34104</span>               <span class="number">34083</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: master <span class="keyword">process</span> nginx <span class="literal">-g</span> daemon off;</span><br><span class="line"><span class="number">101</span>                 <span class="number">34173</span>               <span class="number">34104</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"><span class="number">101</span>                 <span class="number">34174</span>               <span class="number">34104</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">36525</span>               <span class="number">36505</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: master <span class="keyword">process</span> nginx <span class="literal">-g</span> daemon off;</span><br><span class="line"><span class="number">101</span>                 <span class="number">36575</span>               <span class="number">36525</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"><span class="number">101</span>                 <span class="number">36576</span>               <span class="number">36525</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">31274</span>               <span class="number">31254</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span>            php<span class="literal">-fpm</span>: master <span class="keyword">process</span> (/usr/local/etc/php<span class="literal">-fpm</span>.conf)</span><br><span class="line"><span class="number">33</span>                  <span class="number">31320</span>               <span class="number">31274</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            php<span class="literal">-fpm</span>: pool www</span><br><span class="line"><span class="number">33</span>                  <span class="number">31321</span>               <span class="number">31274</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            php<span class="literal">-fpm</span>: pool www</span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">23383</span>               <span class="number">23361</span>               <span class="number">0</span>                   Jan17               pts/<span class="number">0</span>               <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            node</span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">22888</span>               <span class="number">22868</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: master <span class="keyword">process</span> nginx <span class="literal">-g</span> daemon off;</span><br><span class="line"><span class="number">101</span>                 <span class="number">22952</span>               <span class="number">22888</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"><span class="number">101</span>                 <span class="number">22953</span>               <span class="number">22888</span>               <span class="number">0</span>                   Jan17               ?                   <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            nginx: worker <span class="keyword">process</span></span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">22489</span>               <span class="number">22469</span>               <span class="number">0</span>                   Jan17               pts/<span class="number">0</span>               <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            /bin/bash</span><br><span class="line"> </span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                <span class="number">22094</span>               <span class="number">22073</span>               <span class="number">0</span>                   Jan17               pts/<span class="number">0</span>               <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>            bash</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-4-attach-exec"><a href="#11-2-4-attach-exec" class="headerlink" title="11.2.4 attach/exec"></a>11.2.4 attach/exec</h4><p>连接到正在运行中的容器。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach [<span class="type">OPTIONS</span>] CONTAINER</span><br></pre></td></tr></table></figure>
<p>要<code>attach</code> 上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕（与screen命令的attach类似）。</p>
<p>官方文档中说attach后可以通过<code>CTRL-C</code>来detach，但实际上经过我的测试，如果container当前在运行bash，<code>CTRL-C</code>自然是当前行的输入，没有退出；如果container当前正在前台运行进程，如输出nginx的access.log日志，<code>CTRL-C</code>不仅会导致退出容器，而且还stop了。这不是我们想要的，detach的意思按理应该是脱离容器终端，但容器依然运行。好在attach是可以带上<code>--sig-proxy=false</code>来确保<code>CTRL-D</code>或<code>CTRL-C</code>不会关闭容器。</p>
</li>
<li><p>实例</p>
<p>容器mynginx将访问日志指到标准输出，连接到容器查看访问信息。</p>
<blockquote>
<p>当docker容器在 “-d”守护态运行的时候，比如通过supervisord控制两个程序非守护态运行：<br>ssh -D<br>tomcat<br>那么这个时候，用户就无法直接进入到容器中去，docker attach 容器id 就会一直卡着。<br>因为此时容器运行的进程是ssh，而不是/bin/bash 也没有虚拟终端（-it）参数，所以是进入不到的，<br>那么这种情况下，该如何attach进去并进入到一个/bin/bash里呢？</p>
<p>==可以用docker exec -it containerID /bin/bash方式进入容器==</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS          PORTS                                                  NAMES</span><br><span class="line">d5a81f38372c   mysql:<span class="number">5.7</span>        <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">3</span> hours ago    Up <span class="number">16</span> seconds   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">3306</span>-&gt;<span class="number">3306</span>/tcp, :::<span class="number">3306</span>-&gt;<span class="number">3306</span>/tcp, <span class="number">33060</span>/tcp   mysql<span class="literal">-test</span></span><br><span class="line"><span class="number">76</span>febf58a85a   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">5</span> hours ago    Up <span class="number">5</span> hours      <span class="number">80</span>/tcp                                                 nginx<span class="literal">-labelset</span></span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">7</span> hours ago    Up <span class="number">7</span> hours      <span class="number">80</span>/tcp, <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp, :::<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp      nginx<span class="literal">-yanpenggong</span></span><br><span class="line">ab1aa65cb3d1   nginx:latest     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">7</span> hours ago    Up <span class="number">5</span> hours      <span class="number">80</span>/tcp                                                 yanpenggong1</span><br><span class="line">d4048088ff57   php:<span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>    <span class="string">&quot;docker-php-entrypoi…&quot;</span>   <span class="number">24</span> hours ago   Up <span class="number">24</span> hours     <span class="number">9000</span>/tcp                                               myphp<span class="literal">-fpm</span></span><br><span class="line"><span class="number">5</span>c3af81aab8d   node             <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">26</span> hours ago   Up <span class="number">26</span> hours                                                            node<span class="literal">-test</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">26</span> hours ago   Up <span class="number">26</span> hours     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp, :::<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp                  nginx<span class="literal">-test</span></span><br><span class="line"><span class="number">81</span>cbdd935383   centos:centos7   <span class="string">&quot;/bin/bash&quot;</span>              <span class="number">26</span> hours ago   Up <span class="number">26</span> hours                                                            centos<span class="literal">-test</span></span><br><span class="line">c281416b5c63   ubuntu           <span class="string">&quot;bash&quot;</span>                   <span class="number">27</span> hours ago   Up <span class="number">27</span> hours</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it d5a81f38372c /bin/bash</span></span><br><span class="line">bash<span class="literal">-4</span>.<span class="number">2</span><span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker exec -it mysql-test /bin/bash</span></span><br><span class="line">bash<span class="literal">-4</span>.<span class="number">2</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-5-events"><a href="#11-2-5-events" class="headerlink" title="11.2.5 events"></a>11.2.5 events</h4><p>从服务器获取实时事件</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker events [<span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f ：</strong>根据条件过滤事件；</li>
<li><strong>—since ：</strong>从指定的时间戳后显示所有事件;</li>
<li><strong>—until ：</strong>流水时间显示到指定的时间为止；</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>显示docker 2016年7月1日后的所有事件。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker events  --since=&quot;1467302400&quot;</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">22.632702912</span><span class="literal">-05</span>:<span class="number">00</span> image untag sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de (name=sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">22.725821259</span><span class="literal">-05</span>:<span class="number">00</span> image delete sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de (name=sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">53.327637992</span><span class="literal">-05</span>:<span class="number">00</span> image untag sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557 (name=sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">54.752238644</span><span class="literal">-05</span>:<span class="number">00</span> image delete sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557 (name=sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示docker 镜像为mysql:5.6 2016年7月1日后的相关事件。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker events  --since=&quot;1467302400&quot;</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">22.632702912</span><span class="literal">-05</span>:<span class="number">00</span> image untag sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de (name=sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">22.725821259</span><span class="literal">-05</span>:<span class="number">00</span> image delete sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de (name=sha256:<span class="number">157</span>dcdf23d6c0ebe14bedd910dfa29d224f75ed104757c7866fa708eaefd16de)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">53.327637992</span><span class="literal">-05</span>:<span class="number">00</span> image untag sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557 (name=sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">36</span>:<span class="number">54.752238644</span><span class="literal">-05</span>:<span class="number">00</span> image delete sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557 (name=sha256:<span class="number">6</span>fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-17T00</span>:<span class="number">37</span>:<span class="number">43.600321934</span><span class="literal">-05</span>:<span class="number">00</span> container destroy <span class="number">795555</span>d12b2a0c537b6d8a972241a1f24a27538b241b25afa13c4c45637389de (com.docker.compose.config<span class="literal">-hash</span>=ae53e06d500b53a458b03065a6c547dcb1f49fca00638ae785ee3a2f3bbb81eb, com.docker.compose.container<span class="literal">-number</span>=<span class="number">1</span>, com.docker.compose.depends_on=, com.docker.compose.image=sha256:<span class="number">8</span>ace02fae412cc7d1ac5b7a10f7f5b7b2a1e1ae6bdc31a92a190a1a8415d412b, com.docker.compose.oneoff=False, com.docker.compose.project=composetest, com.docker.compose.project.config_files=/root/yanpenggong/DEMO/DockerTest/composeTest/docker<span class="literal">-compose</span>.yml, com.docker.compose.project.working_dir=/root/yanpenggong/DEMO/DockerTest/composeTest, com.docker.compose.service=redis, com.docker.compose.version=<span class="number">2.14</span>.<span class="number">0</span>, image=redis:alpine, name=compose<span class="built_in">test-redis</span><span class="literal">-1</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如果指定的时间是到秒级的，需要将时间转成时间戳。如果时间为日期的话，可以直接使用，如—since=”2016-07-01”。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker events -f &quot;image&quot;=&quot;mysql:5.7&quot; --since=&quot;2016-07-01&quot; </span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T00</span>:<span class="number">39</span>:<span class="number">41.140668490</span><span class="literal">-05</span>:<span class="number">00</span> image pull mysql:<span class="number">5.7</span> (name=mysql)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T00</span>:<span class="number">39</span>:<span class="number">41.682132231</span><span class="literal">-05</span>:<span class="number">00</span> container create f318356c965ba6403e095fe456b63f6172d475ba1097476d4e30beff7246e58d (image=mysql:<span class="number">5.7</span>, name=stupefied_banach)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T00</span>:<span class="number">39</span>:<span class="number">42.003726040</span><span class="literal">-05</span>:<span class="number">00</span> container <span class="built_in">start</span> f318356c965ba6403e095fe456b63f6172d475ba1097476d4e30beff7246e58d (image=mysql:<span class="number">5.7</span>, name=stupefied_banach)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T00</span>:<span class="number">39</span>:<span class="number">42.439945201</span><span class="literal">-05</span>:<span class="number">00</span> container die f318356c965ba6403e095fe456b63f6172d475ba1097476d4e30beff7246e58d (exitCode=<span class="number">1</span>, image=mysql:<span class="number">5.7</span>, name=stupefied_banach)</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T00</span>:<span class="number">40</span>:<span class="number">37.076467617</span><span class="literal">-05</span>:<span class="number">00</span> container <span class="built_in">start</span> f318356c965ba6403e095fe456b63f6172d475ba1097476d4e30beff7246e58d (image=mysql:<span class="number">5.7</span>, name=stupefied_banach)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-6-logs"><a href="#11-2-6-logs" class="headerlink" title="11.2.6 logs"></a>11.2.6 logs</h4><p>获取容器的日志</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs [<span class="type">OPTIONS</span>] CONTAINER</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f :</strong> 跟踪日志输出</li>
<li><strong>—since :</strong>显示某个开始时间的所有日志</li>
<li><strong>-t :</strong> 显示时间戳</li>
<li><strong>—tail :</strong>仅列出最新N条容器日志</li>
</ul>
</li>
<li><p>实例</p>
<p>跟踪查看容器<code>mysql-test</code> 的日志输出。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker logs -f mysql-test</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">33</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Entrypoint script <span class="keyword">for</span> MySQL Server <span class="number">5.7</span>.<span class="number">41</span><span class="literal">-1</span>.el7 started.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">34</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Switching to dedicated user <span class="string">&#x27;mysql&#x27;</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">34</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Entrypoint script <span class="keyword">for</span> MySQL Server <span class="number">5.7</span>.<span class="number">41</span><span class="literal">-1</span>.el7 started.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">34</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Initializing database files</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.342035</span>Z <span class="number">0</span> [<span class="type">Warning</span>] TIMESTAMP with implicit DEFAULT value is deprecated. Please use <span class="literal">--explicit_defaults_for_timestamp</span> server option (see documentation <span class="keyword">for</span> more details).</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.580669</span>Z <span class="number">0</span> [<span class="type">Warning</span>] InnoDB: New log files created, LSN=<span class="number">45790</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.613971</span>Z <span class="number">0</span> [<span class="type">Warning</span>] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.679346</span>Z <span class="number">0</span> [<span class="type">Warning</span>] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: <span class="number">0</span>c59ef46<span class="literal">-96f3-11ed-adba-0242ac11000a</span>.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.680219</span>Z <span class="number">0</span> [<span class="type">Warning</span>] Gtid table is not ready to be used. Table <span class="string">&#x27;mysql.gtid_executed&#x27;</span> cannot be opened.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.769058</span>Z <span class="number">0</span> [<span class="type">Warning</span>] A deprecated TLS version TLSv1 is enabled. Please use TLSv1.<span class="number">2</span> or higher.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.769079</span>Z <span class="number">0</span> [<span class="type">Warning</span>] A deprecated TLS version TLSv1.<span class="number">1</span> is enabled. Please use TLSv1.<span class="number">2</span> or higher.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.769519</span>Z <span class="number">0</span> [<span class="type">Warning</span>] CA certificate ca.pem is self signed.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">34.832020</span>Z <span class="number">1</span> [<span class="type">Warning</span>] root@localhost is created with an empty password ! Please consider switching off the <span class="literal">--initialize-insecure</span> option.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">36</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Database files initialized</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">36</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Starting temporary server</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18</span> <span class="number">05</span>:<span class="number">43</span>:<span class="number">36</span>+<span class="number">00</span>:<span class="number">00</span> [<span class="type">Note</span>] [<span class="type">Entrypoint</span>]: Waiting <span class="keyword">for</span> server startup</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">36.752707</span>Z <span class="number">0</span> [<span class="type">Warning</span>] TIMESTAMP with implicit DEFAULT value is deprecated. Please use <span class="literal">--explicit_defaults_for_timestamp</span> server option (see documentation <span class="keyword">for</span> more details).</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">36.754485</span>Z <span class="number">0</span> <span class="function">[<span class="type">Note</span>] <span class="title">mysqld</span></span> (mysqld <span class="number">5.7</span>.<span class="number">41</span>) starting as <span class="keyword">process</span> <span class="number">124</span> ...</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">36.757512</span>Z <span class="number">0</span> [<span class="type">Note</span>] InnoDB: PUNCH HOLE support available</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">36.757535</span>Z <span class="number">0</span> [<span class="type">Note</span>] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T05</span>:<span class="number">43</span>:<span class="number">36.757538</span>Z <span class="number">0</span> [<span class="type">Note</span>] InnoDB: Uses event mutexes</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>查看容器<code>mysql-test</code> 从2016年7月1日后的最新10条日志。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker logs --since=&quot;2022-12-30&quot; --tail=10 mysql-test</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892365</span>Z <span class="number">0</span> [<span class="type">Warning</span>] CA certificate ca.pem is self signed.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892405</span>Z <span class="number">0</span> [<span class="type">Note</span>] Skipping generation of RSA key pair as key files are present <span class="keyword">in</span> <span class="keyword">data</span> directory.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892692</span>Z <span class="number">0</span> [<span class="type">Note</span>] Server hostname (bind<span class="literal">-address</span>): <span class="string">&#x27;*&#x27;</span>; port: <span class="number">3306</span></span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892740</span>Z <span class="number">0</span> [<span class="type">Note</span>] IPv6 is available.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892749</span>Z <span class="number">0</span> [<span class="type">Note</span>]   - <span class="string">&#x27;::&#x27;</span> resolves to <span class="string">&#x27;::&#x27;</span>;</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.892771</span>Z <span class="number">0</span> [<span class="type">Note</span>] Server socket created on IP: <span class="string">&#x27;::&#x27;</span>.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.894066</span>Z <span class="number">0</span> [<span class="type">Warning</span>] Insecure configuration <span class="keyword">for</span> <span class="literal">--pid-file</span>: Location <span class="string">&#x27;/var/run/mysqld&#x27;</span> <span class="keyword">in</span> the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.901316</span>Z <span class="number">0</span> [<span class="type">Note</span>] Event Scheduler: Loaded <span class="number">0</span> events</span><br><span class="line"><span class="number">2023</span><span class="literal">-01-18T08</span>:<span class="number">42</span>:<span class="number">41.901805</span>Z <span class="number">0</span> [<span class="type">Note</span>] mysqld: ready <span class="keyword">for</span> connections.</span><br><span class="line">Version: <span class="string">&#x27;5.7.41&#x27;</span>  socket: <span class="string">&#x27;/var/run/mysqld/mysqld.sock&#x27;</span>  port: <span class="number">3306</span>  MySQL Community Server (GPL)</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-7-wait"><a href="#11-2-7-wait" class="headerlink" title="11.2.7 wait"></a>11.2.7 wait</h4><p>阻塞运行直到容器停止，然后打印出它的退出代码。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker wait [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker wait mysql-test</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>这里在运行停止容器后才会出现返回的<code>0</code></p>
</blockquote>
</li>
</ol>
<h4 id="11-2-8-export"><a href="#11-2-8-export" class="headerlink" title="11.2.8 export"></a>11.2.8 export</h4><p>将文件系统作为一个tar归档文件导出到 <code>STDOUT</code>。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker export [<span class="type">OPTIONS</span>] CONTAINER</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-o :</strong>将输入内容写到文件。</li>
</ul>
</li>
<li><p>实例</p>
<p>将id为<code>d5a81f38372c</code>的容器按日期保存为tar文件。在本地会发现多了一个<code>mysql-20230118.tar</code>文件。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker ps </span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS        PORTS                                                  NAMES</span><br><span class="line">d5a81f38372c   mysql:<span class="number">5.7</span>        <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">4</span> hours ago    Up <span class="number">1</span> second   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">3306</span>-&gt;<span class="number">3306</span>/tcp, :::<span class="number">3306</span>-&gt;<span class="number">3306</span>/tcp, <span class="number">33060</span>/tcp   mysql<span class="literal">-test</span></span><br><span class="line"><span class="number">76</span>febf58a85a   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">5</span> hours ago    Up <span class="number">5</span> hours    <span class="number">80</span>/tcp                                                 nginx<span class="literal">-labelset</span></span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">7</span> hours ago    Up <span class="number">7</span> hours    <span class="number">80</span>/tcp, <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp, :::<span class="number">8000</span>-&gt;<span class="number">8000</span>/tcp      nginx<span class="literal">-yanpenggong</span></span><br><span class="line">ab1aa65cb3d1   nginx:latest     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">7</span> hours ago    Up <span class="number">6</span> hours    <span class="number">80</span>/tcp                                                 yanpenggong1</span><br><span class="line">d4048088ff57   php:<span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>    <span class="string">&quot;docker-php-entrypoi…&quot;</span>   <span class="number">24</span> hours ago   Up <span class="number">24</span> hours   <span class="number">9000</span>/tcp                                               myphp<span class="literal">-fpm</span></span><br><span class="line"><span class="number">5</span>c3af81aab8d   node             <span class="string">&quot;docker-entrypoint.s…&quot;</span>   <span class="number">27</span> hours ago   Up <span class="number">27</span> hours                                                          node<span class="literal">-test</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab   nginx            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">27</span> hours ago   Up <span class="number">27</span> hours   <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp, :::<span class="number">8080</span>-&gt;<span class="number">80</span>/tcp                  nginx<span class="literal">-test</span></span><br><span class="line"><span class="number">81</span>cbdd935383   centos:centos7   <span class="string">&quot;/bin/bash&quot;</span>              <span class="number">27</span> hours ago   Up <span class="number">27</span> hours                                                          centos<span class="literal">-test</span></span><br><span class="line">c281416b5c63   ubuntu           <span class="string">&quot;bash&quot;</span>                   <span class="number">28</span> hours ago   Up <span class="number">28</span> hours                                                          ubuntu<span class="literal">-test1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker export -o mysql-`date +%Y%m%d`.tar d5a81f38372c</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-9-port"><a href="#11-2-9-port" class="headerlink" title="11.2.9 port"></a>11.2.9 port</h4><p>用于列出指定的容器的端口映射，或者查找将 <code>PRIVATE_PORT NAT</code> 到面向公众的端口。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker port [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">PRIVATE_PORT</span>[/<span class="type">PROTO</span>]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<p>查看容器 <code>mysql-test</code> 的端口映射情况：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker port mysql-test</span></span><br><span class="line"><span class="number">3306</span>/tcp -&gt; <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">3306</span></span><br><span class="line"><span class="number">3306</span>/tcp -&gt; :::<span class="number">3306</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-2-10-stats"><a href="#11-2-10-stats" class="headerlink" title="11.2.10 stats"></a>11.2.10 stats</h4><p>显示容器资源的使用情况，包括：CPU、内存、网络 I/O 等。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats [<span class="type">OPTIONS</span>] [<span class="type">CONTAINER...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS 说明：</p>
<ul>
<li><strong>—all , -a :</strong>显示所有的容器，包括未运行的。</li>
<li><strong>—format :</strong>指定返回值的模板文件。</li>
<li><strong>—no-stream :</strong>展示当前状态就直接退出了，不再实时更新。</li>
<li><strong>—no-trunc :</strong>不截断输出。</li>
</ul>
</li>
<li><p>实例</p>
<p>列出所有在运行的容器信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker stats</span></span><br><span class="line">CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O         PIDS</span><br><span class="line">d5a81f38372c   mysql<span class="literal">-test</span>          <span class="number">0.10</span>%     <span class="number">175.8</span>MiB / <span class="number">1.777</span>GiB   <span class="number">9.66</span>%     <span class="number">656</span>B / <span class="number">0</span>B         <span class="number">3.28</span>MB / <span class="number">25.4</span>MB   <span class="number">27</span></span><br><span class="line"><span class="number">76</span>febf58a85a   nginx<span class="literal">-labelset</span>      <span class="number">0.00</span>%     <span class="number">2.016</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.11</span>%     <span class="number">656</span>B / <span class="number">0</span>B         <span class="number">139</span>kB / <span class="number">24.6</span>kB    <span class="number">3</span></span><br><span class="line"><span class="number">565</span>fab9cc1d6   nginx<span class="literal">-yanpenggong</span>   <span class="number">0.00</span>%     <span class="number">3.027</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.17</span>%     <span class="number">8.84</span>MB / <span class="number">211</span>kB    <span class="number">1.2</span>MB / <span class="number">22.5</span>kB    <span class="number">3</span></span><br><span class="line">ab1aa65cb3d1   yanpenggong1        <span class="number">0.00</span>%     <span class="number">3.398</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.19</span>%     <span class="number">20.2</span>MB / <span class="number">399</span>kB    <span class="number">54.1</span>MB / <span class="number">84.2</span>MB   <span class="number">3</span></span><br><span class="line">d4048088ff57   myphp<span class="literal">-fpm</span>           <span class="number">0.01</span>%     <span class="number">4.734</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.26</span>%     <span class="number">740</span>B / <span class="number">0</span>B         <span class="number">0</span>B / <span class="number">0</span>B           <span class="number">3</span></span><br><span class="line"><span class="number">5</span>c3af81aab8d   node<span class="literal">-test</span>           <span class="number">0.00</span>%     <span class="number">11.73</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.64</span>%     <span class="number">782</span>B / <span class="number">0</span>B         <span class="number">12.7</span>MB / <span class="number">0</span>B       <span class="number">11</span></span><br><span class="line"><span class="number">5</span>f1b0abb64ab   nginx<span class="literal">-test</span>          <span class="number">0.00</span>%     <span class="number">1.996</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.11</span>%     <span class="number">3.45</span>kB / <span class="number">2.85</span>kB   <span class="number">0</span>B / <span class="number">15.4</span>kB       <span class="number">3</span></span><br><span class="line"><span class="number">81</span>cbdd935383   centos<span class="literal">-test</span>         <span class="number">0.00</span>%     <span class="number">392</span>KiB / <span class="number">1.777</span>GiB     <span class="number">0.02</span>%     <span class="number">824</span>B / <span class="number">0</span>B         <span class="number">0</span>B / <span class="number">0</span>B           <span class="number">1</span></span><br><span class="line">c281416b5c63   ubuntu<span class="literal">-test1</span>        <span class="number">0.00</span>%     <span class="number">560</span>KiB / <span class="number">1.777</span>GiB     <span class="number">0.03</span>%     <span class="number">1.27</span>kB / <span class="number">0</span>B       <span class="number">0</span>B / <span class="number">0</span>B           <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>输出详情介绍：</p>
<ul>
<li><p><strong>CONTAINER ID 与 NAME:</strong> 容器 ID 与名称。</p>
</li>
<li><p><strong>CPU % 与 MEM %:</strong> 容器使用的 CPU 和内存的百分比。</p>
</li>
<li><p><strong>MEM USAGE / LIMIT:</strong> 容器正在使用的总内存，以及允许使用的内存总量。</p>
</li>
<li><p><strong>NET I/O:</strong> 容器通过其网络接口发送和接收的数据量。</p>
</li>
<li><p><strong>BLOCK I/O:</strong> 容器从主机上的块设备读取和写入的数据量。</p>
</li>
<li><p><strong>PIDs:</strong> 容器创建的进程或线程数。</p>
</li>
</ul>
<p>根据容器等 ID 或名称现实信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker stats mysql-test 76febf58a85a</span></span><br><span class="line">CONTAINER ID   NAME             CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O         PIDS</span><br><span class="line">d5a81f38372c   mysql<span class="literal">-test</span>       <span class="number">0.11</span>%     <span class="number">175.8</span>MiB / <span class="number">1.777</span>GiB   <span class="number">9.66</span>%     <span class="number">656</span>B / <span class="number">0</span>B   <span class="number">3.28</span>MB / <span class="number">25.4</span>MB   <span class="number">27</span></span><br><span class="line"><span class="number">76</span>febf58a85a   nginx<span class="literal">-labelset</span>   <span class="number">0.00</span>%     <span class="number">2.016</span>MiB / <span class="number">1.777</span>GiB   <span class="number">0.11</span>%     <span class="number">656</span>B / <span class="number">0</span>B   <span class="number">139</span>kB / <span class="number">24.6</span>kB    <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>以 JSON 格式输出：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker stats mysql-test --no-stream --format &quot;&#123;&#123; json . &#125;&#125;&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;BlockIO&quot;</span>:<span class="string">&quot;3.28MB / 25.4MB&quot;</span>,<span class="string">&quot;CPUPerc&quot;</span>:<span class="string">&quot;0.08%&quot;</span>,<span class="string">&quot;Container&quot;</span>:<span class="string">&quot;mysql-test&quot;</span>,<span class="string">&quot;ID&quot;</span>:<span class="string">&quot;d5a81f38372c&quot;</span>,<span class="string">&quot;MemPerc&quot;</span>:<span class="string">&quot;9.66%&quot;</span>,<span class="string">&quot;MemUsage&quot;</span>:<span class="string">&quot;175.8MiB / 1.777GiB&quot;</span>,<span class="string">&quot;Name&quot;</span>:<span class="string">&quot;mysql-test&quot;</span>,<span class="string">&quot;NetIO&quot;</span>:<span class="string">&quot;656B / 0B&quot;</span>,<span class="string">&quot;PIDs&quot;</span>:<span class="string">&quot;27&quot;</span>&#125;</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>输出指定的信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker stats --all --format &quot;table &#123;&#123;.Container&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot; d5a81f38372c nginx-labelset yanpenggong1 centos-test</span></span><br><span class="line">CONTAINER        CPU %     MEM USAGE / LIMIT</span><br><span class="line">d5a81f38372c     <span class="number">0.10</span>%     <span class="number">175.8</span>MiB / <span class="number">1.777</span>GiB</span><br><span class="line">nginx<span class="literal">-labelset</span>   <span class="number">0.00</span>%     <span class="number">2.016</span>MiB / <span class="number">1.777</span>GiB</span><br><span class="line">yanpenggong1     <span class="number">0.00</span>%     <span class="number">3.398</span>MiB / <span class="number">1.777</span>GiB</span><br><span class="line">centos<span class="literal">-test</span>      <span class="number">0.00</span>%     <span class="number">392</span>KiB / <span class="number">1.777</span>GiB</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="11-3-容器rootfs命令"><a href="#11-3-容器rootfs命令" class="headerlink" title="11.3 容器rootfs命令"></a>11.3 容器rootfs命令</h3><h4 id="11-3-1-commit"><a href="#11-3-1-commit" class="headerlink" title="11.3.1 commit"></a>11.3.1 commit</h4><p>从容器创建一个新的镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [<span class="type">OPTIONS</span>] CONTAINER [<span class="type">REPOSITORY</span>[:<span class="type">TAG</span>]]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-a :</strong>提交的镜像作者；</li>
<li><strong>-c :</strong>使用Dockerfile指令来创建镜像；</li>
<li><strong>-m :</strong>提交时的说明文字；</li>
<li><strong>-p :</strong>在commit时，将容器暂停。</li>
</ul>
</li>
<li><p>实例</p>
<p>将容器<code>a404c6c174a2</code> 保存为新的镜像,并添加提交人信息和说明信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker commit -a &quot;yanpenggong&quot; -m &quot;my apache&quot; mysql-test  mysql:v1</span></span><br><span class="line">sha256:aafc21722e07a2c532b197fc85860ad0416a741659d20bd62680e75cceffd5b7</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG         IMAGE ID       CREATED          SIZE</span><br><span class="line">mysql        v1          aafc21722e07   <span class="number">25</span> seconds ago   <span class="number">452</span>MB</span><br><span class="line">mysql        <span class="number">5.7</span>         e982339a20a5   <span class="number">12</span> hours ago     <span class="number">452</span>MB</span><br><span class="line">php          <span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>   <span class="number">6</span>c2e0d7fb356   <span class="number">7</span> days ago       <span class="number">450</span>MB</span><br><span class="line">node         latest      <span class="number">51</span>bd6c84a7f2   <span class="number">7</span> days ago       <span class="number">998</span>MB</span><br><span class="line">nginx        latest      a99a39d070bf   <span class="number">7</span> days ago       <span class="number">142</span>MB</span><br><span class="line">ubuntu       latest      <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago      <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7     eeb6ee3f44bd   <span class="number">16</span> months ago    <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-3-2-cp"><a href="#11-3-2-cp" class="headerlink" title="11.3.2 cp"></a>11.3.2 cp</h4><p>用于容器与主机之间的数据拷贝。</p>
<ol>
<li><p>语法</p>
<ul>
<li><p>将容器中的目录拷贝到主机中</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> [<span class="type">OPTIONS</span>] CONTAINER:SRC_PATH DEST_PATH|-</span><br></pre></td></tr></table></figure>
</li>
<li><p>将主机中的目录拷贝到容器中</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> [<span class="type">OPTIONS</span>] SRC_PATH|- CONTAINER:DEST_PATH</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-L :</strong>保持源目标中的链接</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>将主机<code>./GGG/pythonFile</code>目录拷贝到容器<code>aafc21722e07</code> 的<code>/GGG</code>目录下。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker cp ./GGG/pythonFile aafc21722e07:/GGG/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将主机<code>./GGG/pythonFile</code>目录拷贝到容器<code>aafc21722e07</code>中，目录重命名为<code>GGG</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker cp ./GGG/pythonFile aafc21722e07:/GGG</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将容器<code>aafc21722e07</code>的<code>/GGG</code>目录拷贝到主机的<code>./tmp</code>目录中。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker cp aafc21722e07:/GGG ./temp/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-3-3-diff"><a href="#11-3-3-diff" class="headerlink" title="11.3.3 diff"></a>11.3.3 diff</h4><p>检查容器里文件结构的更改。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">diff</span> [<span class="type">OPTIONS</span>] CONTAINER</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<p>查看容器<code>mysql-test</code>的文件结构更改。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker diff mysql-test</span></span><br><span class="line">A /logs</span><br><span class="line">A /mysql_data</span><br><span class="line">C /run</span><br><span class="line">C /run/mysqld</span><br><span class="line">A /run/mysqld/mysqld.pid</span><br><span class="line">A /run/mysqld/mysqld.sock</span><br><span class="line">C /tmp</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="11-4-镜像仓库"><a href="#11-4-镜像仓库" class="headerlink" title="11.4 镜像仓库"></a>11.4 镜像仓库</h3><h4 id="11-4-1-login"><a href="#11-4-1-login" class="headerlink" title="11.4.1 login"></a>11.4.1 login</h4><ol>
<li><p>语法</p>
<ul>
<li><p>登陆到一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login [<span class="type">OPTIONS</span>] [<span class="type">SERVER</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>登出一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logout [<span class="type">OPTIONS</span>] [<span class="type">SERVER</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
</li>
<li><p><strong>-u :</strong>登陆的用户名</p>
</li>
<li><strong>-p :</strong>登陆的密码</li>
</ul>
<ol>
<li><p>实例</p>
<ul>
<li><p>登陆到Docker Hub</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker login</span></span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. <span class="keyword">If</span> you don<span class="string">&#x27;t have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username: kungs</span></span><br><span class="line"><span class="string">Password: </span></span><br><span class="line"><span class="string">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span><br><span class="line"><span class="string">Configure a credential helper to remove this warning. See</span></span><br><span class="line"><span class="string">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Login Succeeded</span></span><br><span class="line"><span class="string">[root@localhost DockerTest]# </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>登出Docker Hub</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker logout</span></span><br><span class="line">Removing login credentials <span class="keyword">for</span> https://index.docker.io/v1/</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-4-2-pull"><a href="#11-4-2-pull" class="headerlink" title="11.4.2 pull"></a>11.4.2 pull</h4><p>从镜像仓库中拉取或者更新指定镜像</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [<span class="type">OPTIONS</span>] NAME[:<span class="type">TAG</span>|@<span class="type">DIGEST</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-a :</strong>拉取所有 tagged 镜像</li>
<li><strong>—disable-content-trust :</strong>忽略镜像的校验,默认开启</li>
</ul>
</li>
<li><p>实例</p>
<p>从Docker Hub下载 <code>python</code> 最新版镜像。\</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull python</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/python</span><br><span class="line">bbeef03cda1f: Already exists </span><br><span class="line">f049f75f014e: Already exists </span><br><span class="line"><span class="number">56261</span>d0e6b05: Already exists </span><br><span class="line"><span class="number">9</span>bd150679dbd: Already exists </span><br><span class="line"><span class="number">5</span>b282ee9da04: Already exists </span><br><span class="line"><span class="number">03</span>f027d5e312: Pull complete </span><br><span class="line">db6ee1ace097: Pull complete </span><br><span class="line"><span class="number">0</span>a86d528f1ea: Pull complete </span><br><span class="line"><span class="number">4</span>cfb032ae58b: Pull complete </span><br><span class="line">Digest: sha256:a3c0c6766535f85f18e7304d3a0111de5208d73935bcf1b024217005ad5ce195</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> python:latest</span><br><span class="line">docker.io/library/python:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>从Docker Hub下载<code>REPOSITORY</code> 为 <code>python</code> 的所有镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker pull -a python</span></span><br><span class="line"><span class="number">2</span>: Pulling from library/python</span><br><span class="line"><span class="number">7</span>e2b2a5af8f6: Pull complete </span><br><span class="line"><span class="number">09</span>b6f03ffac4: Pull complete </span><br><span class="line">dc3f0c679f0f: Pull complete </span><br><span class="line">fd4b47407fc3: Pull complete </span><br><span class="line">b32f6bf7d96d: Pull complete </span><br><span class="line"><span class="number">6</span>f4489a7e4cf: Pull complete </span><br><span class="line">af4b99ad9ef0: Pull complete </span><br><span class="line"><span class="number">39</span>db0bc48c26: Pull complete </span><br><span class="line">acb4a89489<span class="built_in">fc</span>: Pull complete </span><br><span class="line">Digest: sha256:cfa62318c459b1fde9e0841c619906d15ada5910d625176e24bf692cf8a2601d</span><br><span class="line"><span class="number">2</span><span class="literal">-alpine</span>: Pulling from library/python</span><br><span class="line">aad63a933944: Pull complete </span><br><span class="line"><span class="number">259</span>d822268fb: Pull complete </span><br><span class="line"><span class="number">10</span>ba96d218d3: Pull complete </span><br><span class="line"><span class="number">44</span>ba9f6a4209: Pull complete </span><br><span class="line">Digest: sha256:<span class="number">724</span>d0540eb56ffaa6dd770aa13c3bc7dfc829dec561d87cb36b2f5b9ff8a760a</span><br><span class="line">...</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>获取指定编译平台的镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull <span class="literal">--platform</span>=arm64|amd64... image_name</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-4-3-push"><a href="#11-4-3-push" class="headerlink" title="11.4.3 push"></a>11.4.3 push</h4><p> 将本地的镜像上传到镜像仓库,要先登陆到镜像仓库</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push [<span class="type">OPTIONS</span>] NAME[:<span class="type">TAG</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>—disable-content-trust :</strong>忽略镜像的校验,默认开启</li>
</ul>
</li>
<li><p>实例</p>
<p>上传本地镜像<code>mysql:v1</code> 到镜像仓库中。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG            IMAGE ID       CREATED          SIZE</span><br><span class="line">mysql        v1             aafc21722e07   <span class="number">21</span> minutes ago   <span class="number">452</span>MB</span><br><span class="line">python       latest         b44268c8cbc0   <span class="number">10</span> hours ago     <span class="number">932</span>MB</span><br><span class="line">mysql        <span class="number">5.7</span>            e982339a20a5   <span class="number">13</span> hours ago     <span class="number">452</span>MB</span><br><span class="line">php          <span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>      <span class="number">6</span>c2e0d7fb356   <span class="number">7</span> days ago       <span class="number">450</span>MB</span><br><span class="line">node         latest         <span class="number">51</span>bd6c84a7f2   <span class="number">7</span> days ago       <span class="number">998</span>MB</span><br><span class="line">nginx        latest         a99a39d070bf   <span class="number">7</span> days ago       <span class="number">142</span>MB</span><br><span class="line">ubuntu       latest         <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago      <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7        eeb6ee3f44bd   <span class="number">16</span> months ago    <span class="number">204</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">10</span>   dc740d648004   <span class="number">2</span> years ago      <span class="number">68.9</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine</span>       <span class="number">8579</span>e446340f   <span class="number">2</span> years ago      <span class="number">71.1</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">11</span>   <span class="number">8579</span>e446340f   <span class="number">2</span> years ago      <span class="number">71.1</span>MB</span><br><span class="line">python       <span class="number">2</span>              <span class="number">68</span>e7be49c28c   <span class="number">2</span> years ago      <span class="number">902</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">8</span>    fcbce699af86   <span class="number">3</span> years ago      <span class="number">58.4</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">6</span>    dd4c05fcb8d5   <span class="number">3</span> years ago      <span class="number">56.5</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">7</span>    ec0218200ad6   <span class="number">3</span> years ago      <span class="number">58.2</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">4</span>    <span class="number">5</span>fdd069daf25   <span class="number">4</span> years ago      <span class="number">73.5</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker push mysql:v1</span></span><br><span class="line">The push refers to repository [<span class="type">docker.io</span>/<span class="type">library</span>/<span class="type">mysql</span>]</span><br><span class="line">d9cfab7e0ea4: Preparing </span><br><span class="line"><span class="number">5</span>c542b9ec644: Preparing </span><br><span class="line"><span class="number">868</span>b2e381adf: Preparing </span><br><span class="line">e974776afbe2: Preparing </span><br><span class="line">c1f1b5039e40: Preparing </span><br><span class="line">f4bb02745d03: Waiting </span><br><span class="line"><span class="number">45968403</span>dd22: Waiting </span><br><span class="line"><span class="number">56</span>a71f69f1a8: Waiting </span><br><span class="line"><span class="number">1</span>ab9edd16f9e: Waiting </span><br><span class="line"><span class="number">1</span>a26f263a6af: Waiting </span><br><span class="line"><span class="number">49769</span>e21013b: Waiting </span><br><span class="line"><span class="number">62</span>d9c4cbe8f4: Waiting </span><br><span class="line">denied: requested access to the resource is denied</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-4-4-search"><a href="#11-4-4-search" class="headerlink" title="11.4.4 search"></a>11.4.4 search</h4><p>从Docker Hub查找镜像</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [<span class="type">OPTIONS</span>] TERM</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>—automated :</strong>只列出 automated build类型的镜像；</li>
<li><strong>—no-trunc :</strong>显示完整的镜像描述；</li>
<li><strong>-f &lt;过滤条件&gt;:</strong>列出收藏数不小于指定值的镜像。</li>
</ul>
</li>
<li><p>实例</p>
<p>从 Docker Hub 查找所有镜像名包含 python，并且收藏数大于 10 的镜像</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker search -f stars=10 python</span></span><br><span class="line">NAME              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">python            Python is an interpreted, interactive, objec…   <span class="number">8323</span>      [<span class="type">OK</span>]       </span><br><span class="line">pypy              PyPy is a fast, compliant alternative implem…   <span class="number">355</span>       [<span class="type">OK</span>]       </span><br><span class="line">circleci/python   Python is an interpreted, interactive, objec…   <span class="number">61</span>                   </span><br><span class="line">hylang            Hy is a Lisp dialect that translates express…   <span class="number">53</span>        [<span class="type">OK</span>]       </span><br><span class="line">bitnami/python    Bitnami Python Docker Image                     <span class="number">25</span>                   [<span class="type">OK</span>]</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><p><strong>NAME:</strong> 镜像仓库源的名称</p>
</li>
<li><p><strong>DESCRIPTION:</strong> 镜像的描述</p>
</li>
<li><p><strong>OFFICIAL:</strong> 是否 docker 官方发布</p>
</li>
<li><p><strong>stars:</strong> 类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
</li>
<li><p><strong>AUTOMATED:</strong> 自动构建。</p>
</li>
</ul>
</li>
</ol>
<h3 id="11-5-本地镜像管理"><a href="#11-5-本地镜像管理" class="headerlink" title="11.5 本地镜像管理"></a>11.5 本地镜像管理</h3><h4 id="11-5-1-images"><a href="#11-5-1-images" class="headerlink" title="11.5.1 images"></a>11.5.1 images</h4><p> 列出本地镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [<span class="type">OPTIONS</span>] [<span class="type">REPOSITORY</span>[:<span class="type">TAG</span>]]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-a :</strong>列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</li>
<li><strong>—digests :</strong>显示镜像的摘要信息；</li>
<li><strong>-f :</strong>显示满足条件的镜像；</li>
<li><strong>—format :</strong>指定返回值的模板文件；</li>
<li><strong>—no-trunc :</strong>显示完整的镜像信息；</li>
<li><strong>-q :</strong>只显示镜像ID。</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li><p>查看本地镜像列表。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG            IMAGE ID       CREATED          SIZE</span><br><span class="line">mysql        v1             aafc21722e07   <span class="number">27</span> minutes ago   <span class="number">452</span>MB</span><br><span class="line">python       latest         b44268c8cbc0   <span class="number">10</span> hours ago     <span class="number">932</span>MB</span><br><span class="line">mysql        <span class="number">5.7</span>            e982339a20a5   <span class="number">13</span> hours ago     <span class="number">452</span>MB</span><br><span class="line">php          <span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>      <span class="number">6</span>c2e0d7fb356   <span class="number">7</span> days ago       <span class="number">450</span>MB</span><br><span class="line">node         latest         <span class="number">51</span>bd6c84a7f2   <span class="number">7</span> days ago       <span class="number">998</span>MB</span><br><span class="line">nginx        latest         a99a39d070bf   <span class="number">7</span> days ago       <span class="number">142</span>MB</span><br><span class="line">ubuntu       latest         <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago      <span class="number">77.8</span>MB</span><br><span class="line">centos       centos7        eeb6ee3f44bd   <span class="number">16</span> months ago    <span class="number">204</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">10</span>   dc740d648004   <span class="number">2</span> years ago      <span class="number">68.9</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine</span>       <span class="number">8579</span>e446340f   <span class="number">2</span> years ago      <span class="number">71.1</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">11</span>   <span class="number">8579</span>e446340f   <span class="number">2</span> years ago      <span class="number">71.1</span>MB</span><br><span class="line">python       <span class="number">2</span>              <span class="number">68</span>e7be49c28c   <span class="number">2</span> years ago      <span class="number">902</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">8</span>    fcbce699af86   <span class="number">3</span> years ago      <span class="number">58.4</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">6</span>    dd4c05fcb8d5   <span class="number">3</span> years ago      <span class="number">56.5</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">7</span>    ec0218200ad6   <span class="number">3</span> years ago      <span class="number">58.2</span>MB</span><br><span class="line">python       <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">4</span>    <span class="number">5</span>fdd069daf25   <span class="number">4</span> years ago      <span class="number">73.5</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>列出本地镜像中 REPOSITORY 为<code>centos</code>的镜像列表。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images centos</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">centos       centos7   eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="11-5-2-rmi"><a href="#11-5-2-rmi" class="headerlink" title="11.5.2 rmi"></a>11.5.2 rmi</h4><p>删除本地一个或多个镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [<span class="type">OPTIONS</span>] IMAGE [<span class="type">IMAGE...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f :</strong>强制删除；</li>
<li><strong>—no-prune :</strong>不移除该镜像的过程镜像，默认移除；</li>
</ul>
</li>
<li><p>实例</p>
<p>强制删除本地镜像<code>mysql:v2</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<ol>
<li><p>prune 命令用来删除不再使用的 docker 对象。</p>
<p>删除所有未被 tag 标记和未被容器使用的镜像:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker image prune</span><br><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to continue? [y/N] y</span><br></pre></td></tr></table></figure>
<p>删除所有未被容器使用的镜像:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker image prune -a</span><br></pre></td></tr></table></figure>
<p>删除所有停止运行的容器:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker container prune</span><br></pre></td></tr></table></figure>
<p>删除所有未被挂载的卷:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume prune</span><br></pre></td></tr></table></figure>
<p>删除所有网络:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network prune</span><br></pre></td></tr></table></figure>
<p>删除 docker 所有资源:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>docker system prune</strong> 命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This will remove:</span><br><span class="line">        - all stopped containers</span><br><span class="line">        - all networks not used by at least one container</span><br><span class="line">        - all dangling images</span><br><span class="line">        - all dangling build cache</span><br></pre></td></tr></table></figure>
<p>删除停止的容器、删除所有未被容器使用的网络、删除所有none的镜像。</p>
</li>
</ol>
</blockquote>
<h4 id="11-5-3-tag"><a href="#11-5-3-tag" class="headerlink" title="11.5.3 tag"></a>11.5.3 tag</h4><p>标记本地镜像，将其归入某一仓库。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag [<span class="type">OPTIONS</span>] IMAGE[:<span class="type">TAG</span>] [<span class="type">REGISTRYHOST</span>/][<span class="type">USERNAME</span>/]NAME[:<span class="type">TAG</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<p>将镜像<code>centos:centos7</code>标记为<code>yanpenggong/centos:centos7</code> 镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker tag centos:centos7 yanpenggong/centos:centos7</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY           TAG            IMAGE ID       CREATED         SIZE</span><br><span class="line">mysql                v1             aafc21722e07   <span class="number">17</span> hours ago    <span class="number">452</span>MB</span><br><span class="line">python               latest         b44268c8cbc0   <span class="number">27</span> hours ago    <span class="number">932</span>MB</span><br><span class="line">mysql                <span class="number">5.7</span>            e982339a20a5   <span class="number">29</span> hours ago    <span class="number">452</span>MB</span><br><span class="line">php                  <span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>      <span class="number">6</span>c2e0d7fb356   <span class="number">7</span> days ago      <span class="number">450</span>MB</span><br><span class="line">node                 latest         <span class="number">51</span>bd6c84a7f2   <span class="number">7</span> days ago      <span class="number">998</span>MB</span><br><span class="line">nginx                latest         a99a39d070bf   <span class="number">7</span> days ago      <span class="number">142</span>MB</span><br><span class="line">ubuntu               latest         <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">centos               centos7        eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">yanpenggong/centos   centos7        eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">10</span>   dc740d648004   <span class="number">2</span> years ago     <span class="number">68.9</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine</span>       <span class="number">8579</span>e446340f   <span class="number">2</span> years ago     <span class="number">71.1</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">11</span>   <span class="number">8579</span>e446340f   <span class="number">2</span> years ago     <span class="number">71.1</span>MB</span><br><span class="line">python               <span class="number">2</span>              <span class="number">68</span>e7be49c28c   <span class="number">2</span> years ago     <span class="number">902</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">8</span>    fcbce699af86   <span class="number">3</span> years ago     <span class="number">58.4</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">6</span>    dd4c05fcb8d5   <span class="number">3</span> years ago     <span class="number">56.5</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">7</span>    ec0218200ad6   <span class="number">3</span> years ago     <span class="number">58.2</span>MB</span><br><span class="line">python               <span class="number">2</span><span class="literal">-alpine3</span>.<span class="number">4</span>    <span class="number">5</span>fdd069daf25   <span class="number">4</span> years ago     <span class="number">73.5</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-5-4-build"><a href="#11-5-4-build" class="headerlink" title="11.5.4 build"></a>11.5.4 build</h4><p>用于使用 Dockerfile 创建镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [<span class="type">OPTIONS</span>] PATH | URL | -</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>—build-arg=[] :</strong>设置镜像创建时的变量；</li>
<li><strong>—cpu-shares :</strong>设置 cpu 使用权重；</li>
<li><strong>—cpu-period :</strong>限制 CPU CFS周期；</li>
<li><strong>—cpu-quota :</strong>限制 CPU CFS配额；</li>
<li><strong>—cpuset-cpus :</strong>指定使用的CPU id；</li>
<li><strong>—cpuset-mems :</strong>指定使用的内存 id；</li>
<li><strong>—disable-content-trust :</strong>忽略校验，默认开启；</li>
<li><strong>-f :</strong>指定要使用的Dockerfile路径；</li>
<li><strong>—force-rm :</strong>设置镜像过程中删除中间容器；</li>
<li><strong>—isolation :</strong>使用容器隔离技术；</li>
<li><strong>—label=[] :</strong>设置镜像使用的元数据；</li>
<li><strong>-m :</strong>设置内存最大值；</li>
<li><strong>—memory-swap :</strong>设置Swap的最大值为内存+swap，”-1”表示不限swap；</li>
<li><strong>—no-cache :</strong>创建镜像的过程不使用缓存；</li>
<li><strong>—pull :</strong>尝试去更新镜像的新版本；</li>
<li><strong>—quiet, -q :</strong>安静模式，成功后只输出镜像 ID；</li>
<li><strong>—rm :</strong>设置镜像成功后删除中间容器；</li>
<li><strong>—shm-size :</strong>设置/dev/shm的大小，默认值是64M；</li>
<li><strong>—ulimit :</strong>Ulimit配置。</li>
<li><strong>—squash :</strong>将 Dockerfile 中所有的操作压缩为一层。</li>
<li><strong>—tag, -t:</strong> 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</li>
<li><strong>—network:</strong> 默认 default。在构建期间设置RUN指令的网络模式</li>
</ul>
</li>
<li><p>实例</p>
<p>使用当前目录的 Dockerfile 创建镜像，标签为 <code>yanpenggong/centos:centos7</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker build -t yanpenggong/centos:centos7 . </span></span><br></pre></td></tr></table></figure>
<p>使用URL <strong>github.com/creack/docker-firefox</strong> 的 Dockerfile 创建镜像。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker build github.com/creack/docker-firefox</span></span><br></pre></td></tr></table></figure>
<p>也可以通过 -f Dockerfile 文件的位置：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker build -f /path/to/a/Dockerfile .</span></span><br></pre></td></tr></table></figure>
<p>在 Docker 守护进程执行 Dockerfile 中的指令前，首先会对 Dockerfile 进行语法检查，有语法错误时会返回：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker build -t test/myapp .</span></span><br><span class="line">Sending build context to Docker daemon <span class="number">2.048</span> kB</span><br><span class="line">Error response from daemon: Unknown instruction: RUNCMD</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-5-5-history"><a href="#11-5-5-history" class="headerlink" title="11.5.5 history"></a>11.5.5 history</h4><p>查看指定镜像的创建历史。</p>
<ol>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history [OPTIONS] IMAGE</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-H :</strong>以可读的格式打印镜像大小和日期，默认为true；</li>
<li><strong>—no-trunc :</strong>显示完整的提交记录；</li>
<li><strong>-q :</strong>仅列出提交记录ID。</li>
</ul>
</li>
<li><p>实例</p>
<p>查看本地镜像<code>yanpenggong/centos:centos7</code>的创建历史。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker history yanpenggong/centos:centos7</span></span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">eeb6ee3f44bd   <span class="number">16</span> months ago   /bin/sh <span class="literal">-c</span> <span class="comment">#(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span></span><br><span class="line">&lt;missing&gt;      <span class="number">16</span> months ago   /bin/sh <span class="literal">-c</span> <span class="comment">#(nop)  LABEL org.label-schema.sc…   0B        </span></span><br><span class="line">&lt;missing&gt;      <span class="number">16</span> months ago   /bin/sh <span class="literal">-c</span> <span class="comment">#(nop) ADD file:b3ebbe8bd304723d4…   204MB     </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-5-6-save"><a href="#11-5-6-save" class="headerlink" title="11.5.6 save"></a>11.5.6 save</h4><p>将指定镜像保存成 tar 归档文件。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save [<span class="type">OPTIONS</span>] IMAGE [<span class="type">IMAGE...</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS 说明：</p>
<ul>
<li><strong>-o :</strong>输出到的文件。</li>
</ul>
</li>
<li><p>实例</p>
<p>将镜像 <code>yanpenggong/centos:centos7</code> 生成 <code>my_centos_v1.tar</code> 文档</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker save -o my_centos_v1.tar yanpenggong/centos:centos7</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># ll my_centos_v1.tar </span></span><br><span class="line"><span class="literal">-rw-------</span>. <span class="number">1</span> root root <span class="number">211696640</span> Jan <span class="number">18</span> <span class="number">21</span>:<span class="number">23</span> my_centos_v1.tar</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>export 和 import 导出的是一个容器的快照, 不是镜像本身, 也就是说没有 layer。</p>
<p>dockerfile 里的 workdir, entrypoint 之类的所有东西都会丢失，commit 过的话也会丢失。</p>
<p>快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也更大。</p>
<ul>
<li>docker save 保存的是镜像（image），docker export 保存的是容器（container）；</li>
<li>docker load 用来载入镜像包，docker import 用来载入容器包，但两者都会恢复为镜像；</li>
<li>docker load 不能对载入的镜像重命名，而 docker import 可以为镜像指定新名称。</li>
</ul>
</blockquote>
<h4 id="11-5-7-load"><a href="#11-5-7-load" class="headerlink" title="11.5.7 load"></a>11.5.7 load</h4><p>导入使用 <code>docker save</code> 命令导出的镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load [<span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS 说明：</p>
<ul>
<li><strong>—input , -i :</strong> 指定导入的文件，代替 STDIN。</li>
<li><strong>—quiet , -q :</strong> 精简输出信息。</li>
</ul>
</li>
<li><p>实例</p>
<p>导入镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker load &lt; busybox.tar.gz</span></span><br><span class="line">Loaded image: busybox:latest</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox             latest              <span class="number">769</span>b9341d937        <span class="number">7</span> weeks ago         <span class="number">2.489</span> MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker load --input fedora.tar</span></span><br><span class="line">Loaded image: fedora:rawhide</span><br><span class="line">Loaded image: fedora:<span class="number">20</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox             latest              <span class="number">769</span>b9341d937        <span class="number">7</span> weeks ago         <span class="number">2.489</span> MB</span><br><span class="line">fedora              rawhide             <span class="number">0</span>d20aec6529d        <span class="number">7</span> weeks ago         <span class="number">387</span> MB</span><br><span class="line">fedora              <span class="number">20</span>                  <span class="number">58394</span>af37342        <span class="number">7</span> weeks ago         <span class="number">385.5</span> MB</span><br><span class="line">fedora              heisenbug           <span class="number">58394</span>af37342        <span class="number">7</span> weeks ago         <span class="number">385.5</span> MB</span><br><span class="line">fedora              latest              <span class="number">58394</span>af37342        <span class="number">7</span> weeks ago         <span class="number">385.5</span> MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-5-8-import"><a href="#11-5-8-import" class="headerlink" title="11.5.8 import"></a>11.5.8 import</h4><p>从归档文件中创建镜像。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import [<span class="type">OPTIONS</span>] file|URL|- [<span class="type">REPOSITORY</span>[:<span class="type">TAG</span>]]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-c :</strong>应用docker 指令创建镜像；</li>
<li><strong>-m :</strong>提交时的说明文字；</li>
</ul>
</li>
<li><p>实例</p>
<p>从镜像归档文件<code>my_centos_v1.tar</code>创建镜像，命名为<code>yanpenggong/centos:v1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker import my_centos_v1.tar yanpenggong/centos:v1</span></span><br><span class="line">sha256:<span class="number">623</span>ecbbf2e8d746fdfc3e62f8eb4e1268c9bd43e6f3e6ad5c08b52cc2c01e7ca</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY           TAG            IMAGE ID       CREATED         SIZE</span><br><span class="line">yanpenggong/centos   v1             <span class="number">623</span>ecbbf2e8d   <span class="number">3</span> seconds ago   <span class="number">212</span>MB</span><br><span class="line">mysql                v1             aafc21722e07   <span class="number">17</span> hours ago    <span class="number">452</span>MB</span><br><span class="line">python               latest         b44268c8cbc0   <span class="number">27</span> hours ago    <span class="number">932</span>MB</span><br><span class="line">mysql                <span class="number">5.7</span>            e982339a20a5   <span class="number">29</span> hours ago    <span class="number">452</span>MB</span><br><span class="line">php                  <span class="number">8.2</span>.<span class="number">1</span><span class="literal">-fpm</span>      <span class="number">6</span>c2e0d7fb356   <span class="number">7</span> days ago      <span class="number">450</span>MB</span><br><span class="line">node                 latest         <span class="number">51</span>bd6c84a7f2   <span class="number">7</span> days ago      <span class="number">998</span>MB</span><br><span class="line">nginx                latest         a99a39d070bf   <span class="number">7</span> days ago      <span class="number">142</span>MB</span><br><span class="line">ubuntu               latest         <span class="number">6</span>b7dfa7e8fdb   <span class="number">5</span> weeks ago     <span class="number">77.8</span>MB</span><br><span class="line">centos               centos7        eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">yanpenggong/centos   centos7        eeb6ee3f44bd   <span class="number">16</span> months ago   <span class="number">204</span>MB</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="11-6-info-version"><a href="#11-6-info-version" class="headerlink" title="11.6 info|version"></a>11.6 info|version</h3><h4 id="11-6-1-info"><a href="#11-6-1-info" class="headerlink" title="11.6.1 info"></a>11.6.1 info</h4><p>显示 Docker 系统信息，包括镜像和容器数。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info [<span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<p>查看docker系统信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker info</span></span><br><span class="line">Client:</span><br><span class="line"> Context:    default</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Plugins:</span><br><span class="line">  app: Docker App (Docker Inc., v0.<span class="number">9.1</span><span class="literal">-beta3</span>)</span><br><span class="line">  buildx: Docker Buildx (Docker Inc., v0.<span class="number">9.1</span><span class="literal">-docker</span>)</span><br><span class="line">  scan: Docker Scan (Docker Inc., v0.<span class="number">23.0</span>)</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: <span class="number">13</span></span><br><span class="line">  Running: <span class="number">9</span></span><br><span class="line">  Paused: <span class="number">0</span></span><br><span class="line">  Stopped: <span class="number">4</span></span><br><span class="line"> Images: <span class="number">16</span></span><br><span class="line"> Server Version: <span class="number">20.10</span>.<span class="number">22</span></span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay <span class="built_in">Diff</span>: true</span><br><span class="line">  userxattr: false</span><br><span class="line"> Logging Driver: json<span class="operator">-file</span></span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Cgroup Version: <span class="number">1</span></span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json<span class="operator">-file</span> local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: io.containerd.runtime.v1.linux runc io.containerd.runc.v2</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker<span class="literal">-init</span></span><br><span class="line"> containerd version: <span class="number">5</span>b842e528e99d4d4c1686467debf2bd4b88ecd86</span><br><span class="line"> runc version: v1.<span class="number">1.4</span><span class="literal">-0-g5fd4c4d</span></span><br><span class="line"> init version: de40ad0</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: <span class="number">3.10</span>.<span class="number">0</span><span class="literal">-1160</span>.<span class="number">81.1</span>.el7.x86_64</span><br><span class="line"> Operating System: CentOS Linux <span class="number">7</span> (Core)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: <span class="number">2</span></span><br><span class="line"> Total Memory: <span class="number">1.777</span>GiB</span><br><span class="line"> Name: localhost</span><br><span class="line"> ID: V755:HONZ:LVHJ:WBDK:OTF4:B7TK:QTMF:RLPZ:Z55T:<span class="number">4</span>PAM:EE6C:SQFK</span><br><span class="line"> Docker Root <span class="built_in">Dir</span>: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Username: kungs</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  <span class="number">127.0</span>.<span class="number">0.0</span>/<span class="number">8</span></span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="11-6-2-version"><a href="#11-6-2-version" class="headerlink" title="11.6.2 version"></a>11.6.2 version</h4><p>显示 Docker 版本信息。</p>
<ol>
<li><p>语法</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version [<span class="type">OPTIONS</span>]</span><br></pre></td></tr></table></figure>
<p>OPTIONS说明：</p>
<ul>
<li><strong>-f :</strong>指定返回值的模板文件。</li>
</ul>
</li>
<li><p>实例</p>
<p>显示 Docker 版本信息。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           <span class="number">20.10</span>.<span class="number">22</span></span><br><span class="line"> API version:       <span class="number">1.41</span></span><br><span class="line"> Go version:        go1.<span class="number">18.9</span></span><br><span class="line"> Git commit:        <span class="number">3</span>a2c30b</span><br><span class="line"> Built:             Thu Dec <span class="number">15</span> <span class="number">22</span>:<span class="number">30</span>:<span class="number">24</span> <span class="number">2022</span></span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          <span class="number">20.10</span>.<span class="number">22</span></span><br><span class="line">  API version:      <span class="number">1.41</span> (minimum version <span class="number">1.12</span>)</span><br><span class="line">  Go version:       go1.<span class="number">18.9</span></span><br><span class="line">  Git commit:       <span class="number">42</span>c8b31</span><br><span class="line">  Built:            Thu Dec <span class="number">15</span> <span class="number">22</span>:<span class="number">28</span>:<span class="number">33</span> <span class="number">2022</span></span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          <span class="number">1.6</span>.<span class="number">15</span></span><br><span class="line">  GitCommit:        <span class="number">5</span>b842e528e99d4d4c1686467debf2bd4b88ecd86</span><br><span class="line"> runc:</span><br><span class="line">  Version:          <span class="number">1.1</span>.<span class="number">4</span></span><br><span class="line">  GitCommit:        v1.<span class="number">1.4</span><span class="literal">-0-g5fd4c4d</span></span><br><span class="line"> docker<span class="literal">-init</span>:</span><br><span class="line">  Version:          <span class="number">0.19</span>.<span class="number">0</span></span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">DockerTest</span>]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="12-Docker在线资源及国内镜像"><a href="#12-Docker在线资源及国内镜像" class="headerlink" title="12. Docker在线资源及国内镜像"></a>12. Docker在线资源及国内镜像</h2><h3 id="12-1-Docker资源"><a href="#12-1-Docker资源" class="headerlink" title="12.1 Docker资源"></a>12.1 Docker资源</h3><ul>
<li>Docker 官方主页: <a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com</a></li>
<li>Docker 官方博客: <a target="_blank" rel="noopener" href="https://blog.docker.com/">https://blog.docker.com/</a></li>
<li>Docker 官方文档: <a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></li>
<li>Docker Store: <a target="_blank" rel="noopener" href="https://store.docker.com/">https://store.docker.com</a></li>
<li>Docker Cloud: <a target="_blank" rel="noopener" href="https://cloud.docker.com/">https://cloud.docker.com</a></li>
<li>Docker Hub: <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></li>
<li>Docker 的源代码仓库: <a target="_blank" rel="noopener" href="https://github.com/moby/moby">https://github.com/moby/moby</a></li>
<li>Docker 发布版本历史: <a target="_blank" rel="noopener" href="https://docs.docker.com/release-notes/">https://docs.docker.com/release-notes/</a></li>
<li>Docker 常见问题: <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/faq/">https://docs.docker.com/engine/faq/</a></li>
<li>Docker 远端应用 API: <a target="_blank" rel="noopener" href="https://docs.docker.com/develop/sdk/">https://docs.docker.com/develop/sdk/</a></li>
</ul>
<h3 id="12-2-Docker国内镜像"><a href="#12-2-Docker国内镜像" class="headerlink" title="12.2 Docker国内镜像"></a>12.2 Docker国内镜像</h3><ul>
<li>阿里云的加速器：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/60750.html">https://help.aliyun.com/document_detail/60750.html</a></li>
<li>网易加速器：<a target="_blank" rel="noopener" href="http://hub-mirror.c.163.com">http://hub-mirror.c.163.com</a></li>
<li>官方中国加速器：<a target="_blank" rel="noopener" href="https://registry.docker-cn.com">https://registry.docker-cn.com</a></li>
<li>ustc 的镜像：<a target="_blank" rel="noopener" href="https://docker.mirrors.ustc.edu.cn">https://docker.mirrors.ustc.edu.cn</a></li>
<li>daocloud：<a target="_blank" rel="noopener" href="https://www.daocloud.io/mirror#accelerator-doc（注册后使用）">https://www.daocloud.io/mirror#accelerator-doc（注册后使用）</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF/" rel="tag"># 服务端</a>
              <a href="/tags/docker/" rel="tag"># docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/26/Redis%E6%95%99%E7%A8%8B/" rel="prev" title="Redis教程">
      <i class="fa fa-chevron-left"></i> Redis教程
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81-Docker-%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">一、 Docker 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Docker%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">2.1.</span> <span class="nav-text">1. Docker是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8Docker%E7%9A%84%E7%90%86%E7%94%B1"><span class="nav-number">2.2.</span> <span class="nav-text">2. 使用Docker的理由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%BB%E7%BB%93"><span class="nav-number">2.2.1.</span> <span class="nav-text">对比传统虚拟机总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Docker-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">3.</span> <span class="nav-text">二、Docker 基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Docker-%E9%95%9C%E5%83%8F"><span class="nav-number">3.1.</span> <span class="nav-text">1. Docker 镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E8%BF%90%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">2. Docker容器的运用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Docker%E4%BB%93%E5%BA%93"><span class="nav-number">3.3.</span> <span class="nav-text">3. Docker仓库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97"><span class="nav-number">4.</span> <span class="nav-text">三、Docker安装指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8%E5%AE%98%E6%96%B9%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="nav-number">4.1.</span> <span class="nav-text">1. 使用官方安装脚本自动安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="nav-number">4.2.</span> <span class="nav-text">2. 手动安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC"><span class="nav-number">4.2.1.</span> <span class="nav-text">2.1 卸载旧版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AE%89%E8%A3%85-Docker-Engine-Community"><span class="nav-number">4.2.2.</span> <span class="nav-text">2.2 安装 Docker Engine-Community</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E8%AE%BE%E7%BD%AE%E4%BB%93%E5%BA%93"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">2.2.1 设置仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%AE%89%E8%A3%85-Docker-Engine-Community"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">2.2.2 安装 Docker Engine-Community</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Docker%E5%90%AF%E5%8A%A8"><span class="nav-number">4.3.</span> <span class="nav-text">3. Docker启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Docker%E5%8D%B8%E8%BD%BD"><span class="nav-number">4.4.</span> <span class="nav-text">4. Docker卸载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Docker%E4%BD%BF%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">四、Docker使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Docker-Hello-World"><span class="nav-number">5.1.</span> <span class="nav-text">1. Docker Hello World</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E8%BF%90%E8%A1%8C%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-number">5.1.1.</span> <span class="nav-text">1.1 运行交互式的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%EF%BC%88%E5%90%8E%E5%8F%B0%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="nav-number">5.1.2.</span> <span class="nav-text">1.2 启动容器（后台模式）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%81%9C%E6%AD%A2%E5%AE%B9%E5%99%A8"><span class="nav-number">5.1.3.</span> <span class="nav-text">1.3 停止容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Docker%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">2. Docker容器使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Docker-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">5.2.1.</span> <span class="nav-text">2.1 Docker 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.2 容器使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">2.2.1 获取镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">2.2.2 启动容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E5%90%AF%E5%8A%A8%E5%B7%B2%E5%81%9C%E6%AD%A2%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.2.3.</span> <span class="nav-text">2.2.3 启动已停止运行的容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C"><span class="nav-number">5.2.2.4.</span> <span class="nav-text">2.2.4 后台运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-%E5%81%9C%E6%AD%A2%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.2.5.</span> <span class="nav-text">2.2.5 停止一个容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-6-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.2.6.</span> <span class="nav-text">2.2.6 进入容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-7-%E5%AF%BC%E5%87%BA%E3%80%81%E5%AF%BC%E5%85%A5%E5%AE%B9%E5%99%A8%E5%92%8C%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.2.7.</span> <span class="nav-text">2.2.7 导出、导入容器和删除容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Docker-%E7%AE%80%E5%8D%95Web%E5%AE%9E%E4%BE%8B"><span class="nav-number">5.2.3.</span> <span class="nav-text">2.3 Docker 简单Web实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA-web-%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">2.3.1 运行一个 web 应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E6%9F%A5%E7%9C%8B-WEB-%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">2.3.2 查看 WEB 应用容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F"><span class="nav-number">5.2.3.3.</span> <span class="nav-text">2.3.3 网络端口的快捷方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-%E6%9F%A5%E7%9C%8BWeb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%BF%97"><span class="nav-number">5.2.3.4.</span> <span class="nav-text">2.3.4 查看Web应用程序日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-%E6%9F%A5%E7%9C%8BWeb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%AE%B9%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="nav-number">5.2.3.5.</span> <span class="nav-text">2.3.5 查看Web应用程序容器的进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-6-%E6%A3%80%E6%9F%A5Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.2.3.6.</span> <span class="nav-text">2.3.6 检查Web应用程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-7-%E5%81%9C%E6%AD%A2Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.2.3.7.</span> <span class="nav-text">2.3.7 停止Web应用程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-8-%E9%87%8D%E5%90%AFWeb%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.3.8.</span> <span class="nav-text">2.3.8 重启Web应用容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-9-%E7%A7%BB%E9%99%A4Web%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.3.9.</span> <span class="nav-text">2.3.9 移除Web应用容器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Docker%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8"><span class="nav-number">5.3.</span> <span class="nav-text">3. Docker镜像使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F%E5%88%97%E8%A1%A8"><span class="nav-number">5.3.1.</span> <span class="nav-text">3.1 列出镜像列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.2.</span> <span class="nav-text">3.2 获取一个新的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E6%9F%A5%E6%89%BE%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.3.</span> <span class="nav-text">3.3 查找镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E6%8B%96%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.4.</span> <span class="nav-text">3.4 拖取镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.5.</span> <span class="nav-text">3.5 删除镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.6.</span> <span class="nav-text">3.6 创建镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-1-%E6%9B%B4%E6%96%B0%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.6.1.</span> <span class="nav-text">3.6.1 更新镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-2-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">5.3.6.2.</span> <span class="nav-text">3.6.2 构建镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-3-%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E6%A0%87%E7%AD%BE"><span class="nav-number">5.3.6.3.</span> <span class="nav-text">3.6.3 设置镜像标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Docker%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5"><span class="nav-number">5.4.</span> <span class="nav-text">4. Docker容器连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="nav-number">5.4.1.</span> <span class="nav-text">4.1 网络端口映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Docker-%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94"><span class="nav-number">5.4.2.</span> <span class="nav-text">4.2 Docker 容器互联</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-%E5%AE%B9%E5%99%A8%E5%91%BD%E5%90%8D"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">4.2.1 容器命名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%96%B0%E5%BB%BA%E7%BD%91%E7%BB%9C"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">4.2.2 新建网络</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-%E8%BF%9E%E6%8E%A5%E5%AE%B9%E5%99%A8"><span class="nav-number">5.4.2.3.</span> <span class="nav-text">4.2.3 连接容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%85%8D%E7%BD%AE-DNS"><span class="nav-number">5.4.3.</span> <span class="nav-text">4.3 配置 DNS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Docker%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="nav-number">5.5.</span> <span class="nav-text">5. Docker仓库管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Docker-Hub"><span class="nav-number">5.5.1.</span> <span class="nav-text">5.1 Docker Hub</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%B3%A8%E5%86%8C"><span class="nav-number">5.5.2.</span> <span class="nav-text">5.2 注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA"><span class="nav-number">5.5.3.</span> <span class="nav-text">5.3 登录和退出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">5.5.4.</span> <span class="nav-text">5.4 拉取镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F"><span class="nav-number">5.5.5.</span> <span class="nav-text">5.5 推送镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Docker-Dockerfile"><span class="nav-number">5.6.</span> <span class="nav-text">6. Docker Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E4%BB%80%E4%B9%88%E6%98%AF-Dockerfile%EF%BC%9F"><span class="nav-number">5.6.1.</span> <span class="nav-text">6.1 什么是 Dockerfile？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E4%BD%BF%E7%94%A8-Dockerfile-%E5%AE%9A%E5%88%B6%E9%95%9C%E5%83%8F"><span class="nav-number">5.6.2.</span> <span class="nav-text">6.2 使用 Dockerfile 定制镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">5.6.3.</span> <span class="nav-text">6.3 开始构建镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%AF%E5%BE%84"><span class="nav-number">5.6.4.</span> <span class="nav-text">6.4 上下文路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="nav-number">5.6.5.</span> <span class="nav-text">6.5 指令详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-1-COPY"><span class="nav-number">5.6.5.1.</span> <span class="nav-text">6.5.1 COPY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-2-ADD"><span class="nav-number">5.6.5.2.</span> <span class="nav-text">6.5.2 ADD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-3-CMD"><span class="nav-number">5.6.5.3.</span> <span class="nav-text">6.5.3 CMD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-4-ENTRYPOINT"><span class="nav-number">5.6.5.4.</span> <span class="nav-text">6.5.4 ENTRYPOINT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-5-ENV"><span class="nav-number">5.6.5.5.</span> <span class="nav-text">6.5.5 ENV</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-6-ARG"><span class="nav-number">5.6.5.6.</span> <span class="nav-text">6.5.6 ARG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-7-VOLUME"><span class="nav-number">5.6.5.7.</span> <span class="nav-text">6.5.7 VOLUME</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-8-EXPOSE"><span class="nav-number">5.6.5.8.</span> <span class="nav-text">6.5.8 EXPOSE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-9-WORKDIR"><span class="nav-number">5.6.5.9.</span> <span class="nav-text">6.5.9 WORKDIR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-10-USER"><span class="nav-number">5.6.5.10.</span> <span class="nav-text">6.5.10 USER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-11-HEALTHCHECK"><span class="nav-number">5.6.5.11.</span> <span class="nav-text">6.5.11 HEALTHCHECK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-12-ONBUILD"><span class="nav-number">5.6.5.12.</span> <span class="nav-text">6.5.12 ONBUILD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-13-LABEL"><span class="nav-number">5.6.5.13.</span> <span class="nav-text">6.5.13 LABEL</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Docker-Compose"><span class="nav-number">5.7.</span> <span class="nav-text">7. Docker Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-0-YAML-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B"><span class="nav-number">5.7.1.</span> <span class="nav-text">7.0 YAML 入门教程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-0-1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">5.7.1.1.</span> <span class="nav-text">7.0.1 基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-0-2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.7.1.2.</span> <span class="nav-text">7.0.2 数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#7-0-2-1-YAML-%E5%AF%B9%E8%B1%A1"><span class="nav-number">5.7.1.2.1.</span> <span class="nav-text">7.0.2.1 YAML 对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-0-2-2-YAML-%E6%95%B0%E7%BB%84"><span class="nav-number">5.7.1.2.2.</span> <span class="nav-text">7.0.2.2 YAML 数组</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-0-2-3-%E5%A4%8D%E5%90%88%E7%BB%93%E6%9E%84"><span class="nav-number">5.7.1.2.3.</span> <span class="nav-text">7.0.2.3 复合结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-0-2-4-%E7%BA%AF%E9%87%8F"><span class="nav-number">5.7.1.2.4.</span> <span class="nav-text">7.0.2.4 纯量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-0-2-5-%E5%BC%95%E7%94%A8"><span class="nav-number">5.7.1.2.5.</span> <span class="nav-text">7.0.2.5 引用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Compose-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.7.2.</span> <span class="nav-text">7.1 Compose 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Compose-%E5%AE%89%E8%A3%85"><span class="nav-number">5.7.3.</span> <span class="nav-text">7.2 Compose 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E4%BD%BF%E7%94%A8"><span class="nav-number">5.7.4.</span> <span class="nav-text">7.3 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-1-%E5%87%86%E5%A4%87"><span class="nav-number">5.7.4.1.</span> <span class="nav-text">7.3.1 准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-2-%E5%88%9B%E5%BB%BA-Dockerfile-%E6%96%87%E4%BB%B6"><span class="nav-number">5.7.4.2.</span> <span class="nav-text">7.3.2 创建 Dockerfile 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-4-%E4%BD%BF%E7%94%A8-Compose-%E5%91%BD%E4%BB%A4%E6%9E%84%E5%BB%BA%E5%92%8C%E8%BF%90%E8%A1%8C%E6%82%A8%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">5.7.4.3.</span> <span class="nav-text">7.3.4 使用 Compose 命令构建和运行您的应用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-yml%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4%E5%8F%82%E8%80%83"><span class="nav-number">5.7.5.</span> <span class="nav-text">7.4 yml配置指令参考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-1-version"><span class="nav-number">5.7.5.1.</span> <span class="nav-text">7.4.1 version</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-2-build"><span class="nav-number">5.7.5.2.</span> <span class="nav-text">7.4.2 build</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-3-cap-add%EF%BC%8Ccap-drop"><span class="nav-number">5.7.5.3.</span> <span class="nav-text">7.4.3 cap_add，cap_drop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-4-cgroup-parent"><span class="nav-number">5.7.5.4.</span> <span class="nav-text">7.4.4 cgroup_parent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-5-command"><span class="nav-number">5.7.5.5.</span> <span class="nav-text">7.4.5 command</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-6-container-name"><span class="nav-number">5.7.5.6.</span> <span class="nav-text">7.4.6 container_name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-7-depends-on"><span class="nav-number">5.7.5.7.</span> <span class="nav-text">7.4.7 depends_on</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-8-deploy"><span class="nav-number">5.7.5.8.</span> <span class="nav-text">7.4.8 deploy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-9-devices"><span class="nav-number">5.7.5.9.</span> <span class="nav-text">7.4.9 devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-10-dns"><span class="nav-number">5.7.5.10.</span> <span class="nav-text">7.4.10 dns</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-11-dns-search"><span class="nav-number">5.7.5.11.</span> <span class="nav-text">7.4.11 dns_search</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-12-entrypoint"><span class="nav-number">5.7.5.12.</span> <span class="nav-text">7.4.12 entrypoint</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-13-env-file"><span class="nav-number">5.7.5.13.</span> <span class="nav-text">7.4.13 env_file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-14-environment"><span class="nav-number">5.7.5.14.</span> <span class="nav-text">7.4.14 environment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-15-expose"><span class="nav-number">5.7.5.15.</span> <span class="nav-text">7.4.15 expose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-16-extra-hosts"><span class="nav-number">5.7.5.16.</span> <span class="nav-text">7.4.16 extra_hosts</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-17-healthcheck"><span class="nav-number">5.7.5.17.</span> <span class="nav-text">7.4.17 healthcheck</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-18-image"><span class="nav-number">5.7.5.18.</span> <span class="nav-text">7.4.18 image</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-19-logging"><span class="nav-number">5.7.5.19.</span> <span class="nav-text">7.4.19 logging</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-20-network-mode"><span class="nav-number">5.7.5.20.</span> <span class="nav-text">7.4.20 network_mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-21-restart"><span class="nav-number">5.7.5.21.</span> <span class="nav-text">7.4.21 restart</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-22-secrets"><span class="nav-number">5.7.5.22.</span> <span class="nav-text">7.4.22 secrets</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-23-security-opt"><span class="nav-number">5.7.5.23.</span> <span class="nav-text">7.4.23 security_opt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-24-stop-grace-period"><span class="nav-number">5.7.5.24.</span> <span class="nav-text">7.4.24 stop_grace_period</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-25-stop-signal"><span class="nav-number">5.7.5.25.</span> <span class="nav-text">7.4.25 stop_signal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-26-sysctls"><span class="nav-number">5.7.5.26.</span> <span class="nav-text">7.4.26 sysctls</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-27-tmpfs"><span class="nav-number">5.7.5.27.</span> <span class="nav-text">7.4.27 tmpfs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-28-ulimits"><span class="nav-number">5.7.5.28.</span> <span class="nav-text">7.4.28 ulimits</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-29-volumes"><span class="nav-number">5.7.5.29.</span> <span class="nav-text">7.4.29 volumes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Docker-Machine"><span class="nav-number">5.8.</span> <span class="nav-text">8. Docker Machine</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.8.1.</span> <span class="nav-text">8.1 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E5%AE%89%E8%A3%85"><span class="nav-number">5.8.2.</span> <span class="nav-text">8.2 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-1-macOS%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4"><span class="nav-number">5.8.2.1.</span> <span class="nav-text">8.2.1 macOS安装命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-Linux-%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4"><span class="nav-number">5.8.2.2.</span> <span class="nav-text">8.2.2 Linux 安装命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-Windows-with-git-bash"><span class="nav-number">5.8.2.3.</span> <span class="nav-text">8.2.3 Windows with git bash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%EF%BC%9A"><span class="nav-number">5.8.2.4.</span> <span class="nav-text">8.2.4 查看是否安装成功：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-%E4%BD%BF%E7%94%A8"><span class="nav-number">5.8.3.</span> <span class="nav-text">8.3 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1%E5%88%97%E5%87%BA%E5%8F%AF%E7%94%A8%E7%9A%84%E6%9C%BA%E5%99%A8"><span class="nav-number">5.8.3.1.</span> <span class="nav-text">8.3.1列出可用的机器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-2-%E5%88%9B%E5%BB%BA%E6%9C%BA%E5%99%A8"><span class="nav-number">5.8.3.2.</span> <span class="nav-text">8.3.2 创建机器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3-%E6%9F%A5%E7%9C%8B%E6%9C%BA%E5%99%A8%E7%9A%84-ip"><span class="nav-number">5.8.3.3.</span> <span class="nav-text">8.3.3 查看机器的 ip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-%E5%81%9C%E6%AD%A2%E6%9C%BA%E5%99%A8"><span class="nav-number">5.8.3.4.</span> <span class="nav-text">8.3.4 停止机器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-5-%E5%90%AF%E5%8A%A8%E6%9C%BA%E5%99%A8"><span class="nav-number">5.8.3.5.</span> <span class="nav-text">8.3.5 启动机器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-6-%E8%BF%9B%E5%85%A5%E6%9C%BA%E5%99%A8"><span class="nav-number">5.8.3.6.</span> <span class="nav-text">8.3.6 进入机器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-7-docker-machine-%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="nav-number">5.8.3.7.</span> <span class="nav-text">8.3.7 docker-machine 命令参数说明</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Swarm%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86"><span class="nav-number">5.9.</span> <span class="nav-text">9. Swarm集群管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.9.1.</span> <span class="nav-text">9.1 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-%E5%8E%9F%E7%90%86"><span class="nav-number">5.9.2.</span> <span class="nav-text">9.2 原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-%E4%BD%BF%E7%94%A8"><span class="nav-number">5.9.3.</span> <span class="nav-text">9.3 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-1-%E5%88%9B%E5%BB%BA-swarm-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%88manager%EF%BC%89"><span class="nav-number">5.9.3.1.</span> <span class="nav-text">9.3.1 创建 swarm 集群管理节点（manager）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-2-%E5%88%9B%E5%BB%BA-swarm-%E9%9B%86%E7%BE%A4%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%EF%BC%88worker%EF%BC%89"><span class="nav-number">5.9.3.2.</span> <span class="nav-text">9.3.2 创建 swarm 集群工作节点（worker）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-3-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E4%BF%A1%E6%81%AF"><span class="nav-number">5.9.3.3.</span> <span class="nav-text">9.3.3 查看集群信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-4-%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD"><span class="nav-number">5.9.3.4.</span> <span class="nav-text">9.3.4 部署服务到集群中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-5-%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%83%85%E5%86%B5"><span class="nav-number">5.9.3.5.</span> <span class="nav-text">9.3.5 查看服务部署情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-6-%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.9.3.6.</span> <span class="nav-text">9.3.6 扩展集群服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-7-%E5%88%A0%E9%99%A4%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.9.3.7.</span> <span class="nav-text">9.3.7 删除服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-8-%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.9.3.8.</span> <span class="nav-text">9.3.8 滚动升级服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-9-%E5%81%9C%E6%AD%A2%E6%9F%90%E4%B8%AA%E8%8A%82%E7%82%B9%E6%8E%A5%E6%94%B6%E6%96%B0%E7%9A%84%E4%BB%BB%E5%8A%A1"><span class="nav-number">5.9.3.9.</span> <span class="nav-text">9.3.9 停止某个节点接收新的任务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Docker-%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="nav-number">5.10.</span> <span class="nav-text">10. Docker 安装软件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-Docker-%E5%AE%89%E8%A3%85-Centos"><span class="nav-number">5.10.1.</span> <span class="nav-text">10.1 Docker 安装 Centos</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-1-%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84-Ubuntu-%E7%89%88%E6%9C%AC"><span class="nav-number">5.10.1.1.</span> <span class="nav-text">10.1.1 查看可用的 Ubuntu 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-2-%E6%8B%89%E5%8F%96%E6%9C%80%E6%96%B0%E7%89%88%E7%9A%84-Ubuntu-%E9%95%9C%E5%83%8F"><span class="nav-number">5.10.1.2.</span> <span class="nav-text">10.1.2 拉取最新版的 Ubuntu 镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-3-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="nav-number">5.10.1.3.</span> <span class="nav-text">10.1.3 查看本地镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-4-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87-exec-%E5%91%BD%E4%BB%A4%E8%BF%9B%E5%85%A5-ubuntu-%E5%AE%B9%E5%99%A8"><span class="nav-number">5.10.1.4.</span> <span class="nav-text">10.1.4 运行容器，并且可以通过 exec 命令进入 ubuntu 容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-5%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="nav-number">5.10.1.5.</span> <span class="nav-text">10.1.5安装成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-Docker-%E5%AE%89%E8%A3%85CentOS"><span class="nav-number">5.10.2.</span> <span class="nav-text">10.2 Docker 安装CentOS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-1-%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84-CentOS-%E7%89%88%E6%9C%AC"><span class="nav-number">5.10.2.1.</span> <span class="nav-text">10.2.1 查看可用的 CentOS 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-2-%E6%8B%89%E5%8F%96%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84-CentOS-%E9%95%9C%E5%83%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E4%B8%BA%E4%BE%8B-centos7"><span class="nav-number">5.10.2.2.</span> <span class="nav-text">10.2.2 拉取指定版本的 CentOS 镜像，这里我们安装指定版本为例(centos7):</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-3-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="nav-number">5.10.2.3.</span> <span class="nav-text">10.2.3 查看本地镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-4-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87-exec-%E5%91%BD%E4%BB%A4%E8%BF%9B%E5%85%A5-CentOS-%E5%AE%B9%E5%99%A8%E3%80%82"><span class="nav-number">5.10.2.4.</span> <span class="nav-text">10.2.4 运行容器，并且可以通过 exec 命令进入 CentOS 容器。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-5-%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="nav-number">5.10.2.5.</span> <span class="nav-text">10.2.5 安装成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-Docker-%E5%AE%89%E8%A3%85-Nginx"><span class="nav-number">5.10.3.</span> <span class="nav-text">10.3 Docker 安装 Nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-1-%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84-Nginx-%E7%89%88%E6%9C%AC"><span class="nav-number">5.10.3.1.</span> <span class="nav-text">10.3.1 查看可用的 Nginx 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-2-%E5%8F%96%E6%9C%80%E6%96%B0%E7%89%88%E7%9A%84-Nginx-%E9%95%9C%E5%83%8F"><span class="nav-number">5.10.3.2.</span> <span class="nav-text">10.3.2 取最新版的 Nginx 镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-3-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%98%AF%E5%90%A6%E5%B7%B2%E5%AE%89%E8%A3%85%E4%BA%86-nginx%EF%BC%9A"><span class="nav-number">5.10.3.3.</span> <span class="nav-text">10.3.3 查看本地镜像是否已安装了 nginx：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-4-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-number">5.10.3.4.</span> <span class="nav-text">10.3.4 运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-5-%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="nav-number">5.10.3.5.</span> <span class="nav-text">10.3.5 安装成功</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-Docker-%E5%AE%89%E8%A3%85-Node-js"><span class="nav-number">5.10.4.</span> <span class="nav-text">10.4 Docker 安装 Node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-1-%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84-Node-%E7%89%88%E6%9C%AC"><span class="nav-number">5.10.4.1.</span> <span class="nav-text">10.4.1 查看可用的 Node 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-2-%E5%8F%96%E6%9C%80%E6%96%B0%E7%89%88%E7%9A%84-node-%E9%95%9C%E5%83%8F"><span class="nav-number">5.10.4.2.</span> <span class="nav-text">10.4.2 取最新版的 node 镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-3%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%98%AF%E5%90%A6%E5%B7%B2%E5%AE%89%E8%A3%85%E4%BA%86-node"><span class="nav-number">5.10.4.3.</span> <span class="nav-text">10.4.3查看本地镜像是否已安装了 node</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-4-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-number">5.10.4.4.</span> <span class="nav-text">10.4.4 运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-5-%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="nav-number">5.10.4.5.</span> <span class="nav-text">10.4.5 安装成功</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-Docker%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8"><span class="nav-number">5.11.</span> <span class="nav-text">11. Docker命令大全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E5%AE%B9%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86"><span class="nav-number">5.11.1.</span> <span class="nav-text">11.1 容器生命周期管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-1-run"><span class="nav-number">5.11.1.1.</span> <span class="nav-text">11.1.1 run</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-2-start-stop-restart"><span class="nav-number">5.11.1.2.</span> <span class="nav-text">11.1.2 start|stop|restart</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-3-kill"><span class="nav-number">5.11.1.3.</span> <span class="nav-text">11.1.3 kill</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-4-rm"><span class="nav-number">5.11.1.4.</span> <span class="nav-text">11.1.4 rm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-5-pause-unpause"><span class="nav-number">5.11.1.5.</span> <span class="nav-text">11.1.5 pause|unpause</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-6-create"><span class="nav-number">5.11.1.6.</span> <span class="nav-text">11.1.6 create</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-7-exec"><span class="nav-number">5.11.1.7.</span> <span class="nav-text">11.1.7 exec</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">5.11.2.</span> <span class="nav-text">11.2 容器操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-1-ps"><span class="nav-number">5.11.2.1.</span> <span class="nav-text">11.2.1 ps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-2-inspect"><span class="nav-number">5.11.2.2.</span> <span class="nav-text">11.2.2 inspect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-3-top"><span class="nav-number">5.11.2.3.</span> <span class="nav-text">11.2.3 top</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-4-attach-exec"><span class="nav-number">5.11.2.4.</span> <span class="nav-text">11.2.4 attach&#x2F;exec</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-5-events"><span class="nav-number">5.11.2.5.</span> <span class="nav-text">11.2.5 events</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-6-logs"><span class="nav-number">5.11.2.6.</span> <span class="nav-text">11.2.6 logs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-7-wait"><span class="nav-number">5.11.2.7.</span> <span class="nav-text">11.2.7 wait</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-8-export"><span class="nav-number">5.11.2.8.</span> <span class="nav-text">11.2.8 export</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-9-port"><span class="nav-number">5.11.2.9.</span> <span class="nav-text">11.2.9 port</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-10-stats"><span class="nav-number">5.11.2.10.</span> <span class="nav-text">11.2.10 stats</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-%E5%AE%B9%E5%99%A8rootfs%E5%91%BD%E4%BB%A4"><span class="nav-number">5.11.3.</span> <span class="nav-text">11.3 容器rootfs命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-3-1-commit"><span class="nav-number">5.11.3.1.</span> <span class="nav-text">11.3.1 commit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-3-2-cp"><span class="nav-number">5.11.3.2.</span> <span class="nav-text">11.3.2 cp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-3-3-diff"><span class="nav-number">5.11.3.3.</span> <span class="nav-text">11.3.3 diff</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-4-%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="nav-number">5.11.4.</span> <span class="nav-text">11.4 镜像仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-4-1-login"><span class="nav-number">5.11.4.1.</span> <span class="nav-text">11.4.1 login</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-4-2-pull"><span class="nav-number">5.11.4.2.</span> <span class="nav-text">11.4.2 pull</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-4-3-push"><span class="nav-number">5.11.4.3.</span> <span class="nav-text">11.4.3 push</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-4-4-search"><span class="nav-number">5.11.4.4.</span> <span class="nav-text">11.4.4 search</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86"><span class="nav-number">5.11.5.</span> <span class="nav-text">11.5 本地镜像管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-1-images"><span class="nav-number">5.11.5.1.</span> <span class="nav-text">11.5.1 images</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-2-rmi"><span class="nav-number">5.11.5.2.</span> <span class="nav-text">11.5.2 rmi</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-3-tag"><span class="nav-number">5.11.5.3.</span> <span class="nav-text">11.5.3 tag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-4-build"><span class="nav-number">5.11.5.4.</span> <span class="nav-text">11.5.4 build</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-5-history"><span class="nav-number">5.11.5.5.</span> <span class="nav-text">11.5.5 history</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-6-save"><span class="nav-number">5.11.5.6.</span> <span class="nav-text">11.5.6 save</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-7-load"><span class="nav-number">5.11.5.7.</span> <span class="nav-text">11.5.7 load</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-8-import"><span class="nav-number">5.11.5.8.</span> <span class="nav-text">11.5.8 import</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-info-version"><span class="nav-number">5.11.6.</span> <span class="nav-text">11.6 info|version</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-6-1-info"><span class="nav-number">5.11.6.1.</span> <span class="nav-text">11.6.1 info</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-6-2-version"><span class="nav-number">5.11.6.2.</span> <span class="nav-text">11.6.2 version</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-Docker%E5%9C%A8%E7%BA%BF%E8%B5%84%E6%BA%90%E5%8F%8A%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F"><span class="nav-number">5.12.</span> <span class="nav-text">12. Docker在线资源及国内镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-Docker%E8%B5%84%E6%BA%90"><span class="nav-number">5.12.1.</span> <span class="nav-text">12.1 Docker资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-Docker%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F"><span class="nav-number">5.12.2.</span> <span class="nav-text">12.2 Docker国内镜像</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yanpenggong"
      src="/images/cat.jpg">
  <p class="site-author-name" itemprop="name">yanpenggong</p>
  <div class="site-description" itemprop="description">涉猎的主要编程语言为 Python、C++、Matlab、R，领域涵盖爬虫、数据挖掘、深度学习、良率分析、目标检测、工业异常检测、服务研发和对象存储等。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yanpenggong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
